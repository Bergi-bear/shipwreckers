Index: .idea/misc.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"ProjectRootManager\" version=\"2\" languageLevel=\"JDK_13\" default=\"false\" project-jdk-name=\"Lua\" project-jdk-type=\"Lua SDK\">\r\n    <output url=\"file://$PROJECT_DIR$/out\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- .idea/misc.xml	(revision b71969cd35453eae92c2328cd13481063eda9654)
+++ .idea/misc.xml	(date 1602952639472)
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
-  <component name="ProjectRootManager" version="2" languageLevel="JDK_13" default="false" project-jdk-name="Lua" project-jdk-type="Lua SDK">
+  <component name="ProjectRootManager" version="2" languageLevel="JDK_13" default="false" project-jdk-name="sdk" project-jdk-type="Lua SDK">
     <output url="file://$PROJECT_DIR$/out" />
   </component>
 </project>
\ No newline at end of file
Index: map.w3x/war3map.lua
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>gg_rct_Zone0 = nil\r\ngg_rct_ZoneLaserGate0 = nil\r\ngg_rct_SingleTorrentZone = nil\r\ngg_rct_Combat0Zone = nil\r\ngg_rct_Zone02In = nil\r\ngg_rct_Zone02Out = nil\r\ngg_rct_Spawn00 = nil\r\ngg_rct_Zone03In = nil\r\ngg_rct_Zone03Out = nil\r\ngg_rct_Region_010 = nil\r\ngg_rct_Region_011 = nil\r\ngg_rct_Combat1Zone = nil\r\ngg_rct_TestFog = nil\r\ngg_rct_DeapZone1 = nil\r\ngg_rct_Zone04In = nil\r\ngg_rct_WaterTreem = nil\r\ngg_rct_BossZone1 = nil\r\ngg_rct_Boss1Gate = nil\r\ngg_rct_VisiblePoint0 = nil\r\ngg_rct_Boss1Gate1 = nil\r\ngg_rct_ActivateArrow1 = nil\r\ngg_rct_Sercret1 = nil\r\ngg_rct_Gate3 = nil\r\ngg_cam_CameraHATE = nil\r\ngg_snd_AAA = nil\r\ngg_snd_AAA1 = nil\r\ngg_snd_Load = nil\r\ngg_snd_CollectOB1 = nil\r\ngg_trg_ResArrowBotton = nil\r\ngg_trg_Button3IsDead = nil\r\ngg_trg_InitZone0 = nil\r\ngg_trg_Button0IsDead = nil\r\ngg_trg_Button12IsDead = nil\r\ngg_trg_ResLeft = nil\r\ngg_trg_ResRight = nil\r\ngg_trg_InCombatZone = nil\r\ngg_trg_Button0to1 = nil\r\ngg_trg_Visiblepoint = nil\r\ngg_trg_InitZone1BossOpenGate = nil\r\ngg_trg_Button10IsDead = nil\r\ngg_trg_EVENTMMB = nil\r\ngg_trg_NonAttack = nil\r\ngg_trg_sec1 = nil\r\ngg_trg_StartMainTheme = nil\r\ngg_unit_h002_0023 = nil\r\ngg_dest_B000_0131 = nil\r\ngg_dest_B000_0118 = nil\r\ngg_dest_DTfx_1224 = nil\r\ngg_dest_B006_0274 = nil\r\ngg_dest_B000_0275 = nil\r\ngg_dest_B000_0273 = nil\r\ngg_dest_B000_0906 = nil\r\ngg_dest_B000_0963 = nil\r\nfunction InitGlobals()\r\nend\r\n\r\nfunction InitSounds()\r\n    gg_snd_AAA = CreateSound(\"Units/Creeps/GoblinZeppelin/GoblinZeppelinWhat3\", false, true, true, 10, 10, \"DefaultEAXON\")\r\n    SetSoundParamsFromLabel(gg_snd_AAA, \"GoblinZeppelinWhat\")\r\n    SetSoundDuration(gg_snd_AAA, 2444)\r\n    SetSoundChannel(gg_snd_AAA, 0)\r\n    SetSoundVolume(gg_snd_AAA, 110)\r\n    SetSoundDistances(gg_snd_AAA, 0.0, 100000.0)\r\n    SetSoundDistanceCutoff(gg_snd_AAA, 3000.0)\r\n    gg_snd_AAA1 = CreateSound(\"Units/Creeps/GoblinZeppelin/GoblinZeppelinWhat4\", false, true, true, 10, 10, \"DefaultEAXON\")\r\n    SetSoundParamsFromLabel(gg_snd_AAA1, \"GoblinZeppelinWhat\")\r\n    SetSoundDuration(gg_snd_AAA1, 1497)\r\n    SetSoundChannel(gg_snd_AAA1, 0)\r\n    SetSoundVolume(gg_snd_AAA1, 110)\r\n    SetSoundDistances(gg_snd_AAA1, 0.0, 100000.0)\r\n    SetSoundDistanceCutoff(gg_snd_AAA1, 3000.0)\r\n    gg_snd_Load = CreateSound(\"Abilities/Spells/Other/LoadUnload/Loading.flac\", false, true, true, 1, 1, \"DefaultEAXON\")\r\n    SetSoundParamsFromLabel(gg_snd_Load, \"LoadUnload\")\r\n    SetSoundDuration(gg_snd_Load, 740)\r\n    SetSoundVolume(gg_snd_Load, 127)\r\n    gg_snd_CollectOB1 = CreateSound(\"OverBoardGame/Collect2.flac\", false, true, true, 10, 10, \"DefaultEAXON\")\r\n    SetSoundDuration(gg_snd_CollectOB1, 1601)\r\n    SetSoundChannel(gg_snd_CollectOB1, 0)\r\n    SetSoundVolume(gg_snd_CollectOB1, 127)\r\n    SetSoundPitch(gg_snd_CollectOB1, 1.0)\r\n    SetSoundDistances(gg_snd_CollectOB1, 300.0, 10000.0)\r\n    SetSoundDistanceCutoff(gg_snd_CollectOB1, 3000.0)\r\n    SetSoundConeAngles(gg_snd_CollectOB1, 0.0, 0.0, 127)\r\n    SetSoundConeOrientation(gg_snd_CollectOB1, 0.0, 0.0, 0.0)\r\nend\r\n\r\nfunction CreateAllDestructables()\r\n    local d\r\n    local t\r\n    local life\r\n    gg_dest_B000_0118 = BlzCreateDestructableWithSkin(FourCC(\"B000\"), -2432.0, -1600.0, 84.000, 1.000, 0, FourCC(\"B000\"))\r\n    gg_dest_B000_0963 = BlzCreateDestructableWithSkin(FourCC(\"B000\"), 3840.0, 2880.0, 84.000, 1.000, 0, FourCC(\"B000\"))\r\n    gg_dest_B000_0906 = BlzCreateDestructableWithSkin(FourCC(\"B000\"), 2944.0, 8256.0, 84.000, 1.000, 0, FourCC(\"B000\"))\r\n    gg_dest_B000_0275 = BlzCreateDestructableWithSkin(FourCC(\"B000\"), -1472.0, 0.0, 354.000, 1.000, 0, FourCC(\"B000\"))\r\n    gg_dest_B000_0273 = BlzCreateDestructableWithSkin(FourCC(\"B000\"), -3264.0, 128.0, 174.000, 1.000, 0, FourCC(\"B000\"))\r\n    gg_dest_B000_0131 = BlzCreateDestructableWithSkin(FourCC(\"B000\"), -1600.0, 3008.0, 84.000, 1.000, 0, FourCC(\"B000\"))\r\n    gg_dest_B006_0274 = BlzCreateDestructableZWithSkin(FourCC(\"B006\"), -2368.0, 640.0, -108.0, 270.000, 1.500, 0, FourCC(\"B006\"))\r\n    gg_dest_DTfx_1224 = BlzCreateDestructableZWithSkin(FourCC(\"DTfx\"), -3776.0, 7872.0, -139.9, 270.000, 1.000, 0, FourCC(\"DTfx\"))\r\nend\r\n\r\nfunction CreateUnitsForPlayer0()\r\n    local p = Player(0)\r\n    local u\r\n    local unitID\r\n    local t\r\n    local life\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -1236.2, 4326.5, 308.209, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -218.2, 5280.3, 308.209, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e005\"), 2412.5, 7463.1, 248.200, FourCC(\"e005\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e00C\"), 6987.8, 3603.6, 342.641, FourCC(\"e00C\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e00C\"), 7795.5, 3614.4, 342.641, FourCC(\"e00C\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e00C\"), 6176.1, 3612.6, 342.641, FourCC(\"e00C\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e00C\"), 8565.6, 3553.7, 342.641, FourCC(\"e00C\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e00C\"), 8487.1, 2276.0, 342.641, FourCC(\"e00C\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e00C\"), 7680.2, 2344.8, 342.641, FourCC(\"e00C\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e00C\"), 6905.4, 2385.8, 342.641, FourCC(\"e00C\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e00C\"), 6884.4, 2980.5, 342.641, FourCC(\"e00C\"))\r\nend\r\n\r\nfunction CreateBuildingsForPlayer9()\r\n    local p = Player(9)\r\n    local u\r\n    local unitID\r\n    local t\r\n    local life\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), -704.0, -1088.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), -576.0, -2624.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), 64.0, -3008.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), 64.0, -2496.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), 704.0, -3264.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), 704.0, -2624.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), -576.0, -3264.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), -1216.0, -3008.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), -3904.0, 2240.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), -4416.0, 2240.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), -4800.0, 2880.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), -4160.0, 2880.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), 4928.0, 3008.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), 4928.0, 2304.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), 8064.0, 2688.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), 7296.0, 3200.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), 8064.0, 3200.0, 270.000, FourCC(\"h001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h001\"), 7296.0, 2688.0, 270.000, FourCC(\"h001\"))\r\nend\r\n\r\nfunction CreateBuildingsForPlayer10()\r\n    local p = Player(10)\r\n    local u\r\n    local unitID\r\n    local t\r\n    local life\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"n003\"), -1984.0, 6080.0, 270.000, FourCC(\"n003\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"n003\"), -1984.0, 4352.0, 270.000, FourCC(\"n003\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"n003\"), 704.0, 4352.0, 270.000, FourCC(\"n003\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"n003\"), 704.0, 6080.0, 270.000, FourCC(\"n003\"))\r\n    gg_unit_h002_0023 = BlzCreateUnitWithSkin(p, FourCC(\"h002\"), 832.0, -1472.0, 270.000, FourCC(\"h002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h002\"), 1216.0, -832.0, 270.000, FourCC(\"h002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"n004\"), -2432.0, 7680.0, 270.000, FourCC(\"n004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h002\"), -6208.0, 6400.0, 270.000, FourCC(\"h002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h002\"), -6272.0, 5696.0, 270.000, FourCC(\"h002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h002\"), -6080.0, 5056.0, 270.000, FourCC(\"h002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h002\"), -5632.0, 6848.0, 270.000, FourCC(\"h002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h002\"), -4800.0, 6784.0, 270.000, FourCC(\"h002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"h002\"), -4352.0, 6464.0, 270.000, FourCC(\"h002\"))\r\nend\r\n\r\nfunction CreateUnitsForPlayer10()\r\n    local p = Player(10)\r\n    local u\r\n    local unitID\r\n    local t\r\n    local life\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"hbot\"), -2984.9, 101.9, 2.767, FourCC(\"hbot\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"o001\"), 2801.5, 2496.1, 177.920, FourCC(\"o001\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"hbot\"), -1729.2, 69.6, 171.573, FourCC(\"hbot\"))\r\nend\r\n\r\nfunction CreateNeutralPassiveBuildings()\r\n    local p = Player(PLAYER_NEUTRAL_PASSIVE)\r\n    local u\r\n    local unitID\r\n    local t\r\n    local life\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"o000\"), 1408.0, 5504.0, 270.000, FourCC(\"o000\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"o000\"), -1152.0, 3584.0, 270.000, FourCC(\"o000\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"o000\"), 384.0, -640.0, 270.000, FourCC(\"o000\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"o000\"), -1152.0, -704.0, 270.000, FourCC(\"o000\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"o000\"), -2368.0, -2880.0, 270.000, FourCC(\"o000\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"o000\"), -5952.0, 5504.0, 270.000, FourCC(\"o000\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"o000\"), -1088.0, 10560.0, 270.000, FourCC(\"o000\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"o000\"), 5696.0, 5248.0, 270.000, FourCC(\"o000\"))\r\nend\r\n\r\nfunction CreateNeutralPassive()\r\n    local p = Player(PLAYER_NEUTRAL_PASSIVE)\r\n    local u\r\n    local unitID\r\n    local t\r\n    local life\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -2985.8, 5702.8, 53.022, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -2833.6, 5698.4, 308.209, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -2213.9, 3535.3, 251.580, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 2913.7, 3607.7, 345.796, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -1541.1, -898.2, 251.580, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -1541.6, -678.4, 251.580, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -1638.8, -1032.0, 251.580, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -3182.4, 488.6, 251.580, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -3192.6, -177.9, 251.580, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -1565.6, 453.3, 251.580, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -1541.4, -131.3, 251.580, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), 2936.2, -3072.4, 245.969, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), 2866.6, -2823.1, 253.298, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), 2693.0, -3017.0, 18.886, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e003\"), -2708.5, 2585.8, 200.070, FourCC(\"e003\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -1750.7, 1487.5, 251.580, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -2543.9, -2240.3, 251.580, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), 855.1, 323.7, 18.886, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), 1125.6, 305.2, 18.886, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e003\"), 950.8, 203.7, 200.070, FourCC(\"e003\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), 1009.5, -3207.5, 18.886, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), 1202.0, -3198.8, 18.886, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), 1416.3, 4627.9, 308.210, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 2339.7, 3620.9, 357.748, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 2532.9, 3615.3, 3.283, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 2719.6, 3604.2, 345.796, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 2351.4, 3824.6, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 2516.9, 3808.2, 335.332, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 2718.1, 3804.9, 69.411, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), 524.7, 2255.7, 308.210, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e007\"), 2449.9, -1278.2, 272.570, FourCC(\"e007\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e007\"), 3940.2, 2463.8, 250.782, FourCC(\"e007\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e007\"), 3941.5, 2201.7, 218.624, FourCC(\"e007\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 2912.3, 3808.4, 69.411, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 2428.8, 3721.6, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 2620.7, 3716.0, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 2815.7, 3703.1, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1346.0, 6759.2, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -2962.1, 7154.5, 53.022, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1506.0, 7104.0, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1408.9, 7576.1, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1041.8, 8158.4, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1323.1, 8256.5, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1932.8, 8325.1, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 251.2, 7132.6, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1029.0, 9661.5, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 319.0, 9848.7, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1317.4, 10044.6, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1478.7, 9749.3, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1674.2, 9915.1, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1622.4, 8742.5, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 660.4, 8969.4, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1655.4, 8322.6, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 607.2, 7163.3, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 294.3, 6517.8, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 101.9, 6510.0, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), -732.8, 10679.5, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), -747.1, 10419.6, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1089.9, 10715.6, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 70.5, 10867.1, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), -321.2, 10904.9, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1939.3, 11116.9, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 41.7, 9088.0, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), -271.4, 8403.2, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 42.7, 8102.8, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), -254.8, 8082.0, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), 1.7, 7627.0, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), -265.0, 7396.4, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), -132.0, 7860.4, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), -237.6, 6883.0, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e004\"), -32.1, 7386.2, 108.625, FourCC(\"e004\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -1918.5, 7149.9, 53.022, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -1919.1, 8219.2, 53.022, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e002\"), -2946.7, 8245.2, 53.022, FourCC(\"e002\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e007\"), -3488.3, 8823.0, 218.624, FourCC(\"e007\"))\r\n    u = BlzCreateUnitWithSkin(p, FourCC(\"e003\"), 2277.5, 7422.6, 200.070, FourCC(\"e003\"))\r\nend\r\n\r\nfunction CreatePlayerBuildings()\r\n    CreateBuildingsForPlayer9()\r\n    CreateBuildingsForPlayer10()\r\nend\r\n\r\nfunction CreatePlayerUnits()\r\n    CreateUnitsForPlayer0()\r\n    CreateUnitsForPlayer10()\r\nend\r\n\r\nfunction CreateAllUnits()\r\n    CreateNeutralPassiveBuildings()\r\n    CreatePlayerBuildings()\r\n    CreateNeutralPassive()\r\n    CreatePlayerUnits()\r\nend\r\n\r\nfunction CreateRegions()\r\n    local we\r\n    gg_rct_Zone0 = Rect(-3104.0, -1536.0, -2784.0, -1408.0)\r\n    gg_rct_ZoneLaserGate0 = Rect(-2656.0, 544.0, -2112.0, 704.0)\r\n    gg_rct_SingleTorrentZone = Rect(-1856.0, 1312.0, -1600.0, 1600.0)\r\n    gg_rct_Combat0Zone = Rect(-1184.0, -160.0, 384.0, 1440.0)\r\n    gg_rct_Zone02In = Rect(-1344.0, 1280.0, -1216.0, 1824.0)\r\n    gg_rct_Zone02Out = Rect(-576.0, -384.0, -64.0, -256.0)\r\n    gg_rct_Spawn00 = Rect(-576.0, 32.0, -128.0, 224.0)\r\n    gg_rct_Zone03In = Rect(2464.0, 1632.0, 3136.0, 1920.0)\r\n    gg_rct_Zone03Out = Rect(-1088.0, 2208.0, -800.0, 2976.0)\r\n    gg_rct_Region_010 = Rect(-736.0, 3040.0, -416.0, 3296.0)\r\n    gg_rct_Region_011 = Rect(-3232.0, 2080.0, -2144.0, 2944.0)\r\n    we = AddWeatherEffect(gg_rct_Region_011, FourCC(\"LRaa\"))\r\n    EnableWeatherEffect(we, true)\r\n    gg_rct_Combat1Zone = Rect(-2080.0, 4160.0, 800.0, 6176.0)\r\n    gg_rct_TestFog = Rect(-448.0, 6464.0, 1856.0, 11232.0)\r\n    gg_rct_DeapZone1 = Rect(2048.0, 4000.0, 3072.0, 5440.0)\r\n    gg_rct_Zone04In = Rect(3136.0, 2400.0, 3584.0, 3040.0)\r\n    gg_rct_WaterTreem = Rect(1312.0, -4416.0, 5792.0, -4032.0)\r\n    gg_rct_BossZone1 = Rect(-3328.0, 6688.0, -1536.0, 8704.0)\r\n    gg_rct_Boss1Gate = Rect(-1600.0, 6720.0, -1216.0, 8512.0)\r\n    gg_rct_VisiblePoint0 = Rect(-1696.0, 2848.0, -1536.0, 2976.0)\r\n    gg_rct_Boss1Gate1 = Rect(-3040.0, 8576.0, -2400.0, 8928.0)\r\n    gg_rct_ActivateArrow1 = Rect(-3872.0, 7776.0, -3680.0, 7968.0)\r\n    gg_rct_Sercret1 = Rect(1856.0, 6400.0, 2624.0, 6656.0)\r\n    gg_rct_Gate3 = Rect(3072.0, 5792.0, 3360.0, 6656.0)\r\nend\r\n\r\nfunction CreateCameras()\r\n    gg_cam_CameraHATE = CreateCameraSetup()\r\n    CameraSetupSetField(gg_cam_CameraHATE, CAMERA_FIELD_ZOFFSET, 0.0, 0.0)\r\n    CameraSetupSetField(gg_cam_CameraHATE, CAMERA_FIELD_ROTATION, 90.0, 0.0)\r\n    CameraSetupSetField(gg_cam_CameraHATE, CAMERA_FIELD_ANGLE_OF_ATTACK, 304.0, 0.0)\r\n    CameraSetupSetField(gg_cam_CameraHATE, CAMERA_FIELD_TARGET_DISTANCE, 1650.0, 0.0)\r\n    CameraSetupSetField(gg_cam_CameraHATE, CAMERA_FIELD_ROLL, 0.0, 0.0)\r\n    CameraSetupSetField(gg_cam_CameraHATE, CAMERA_FIELD_FIELD_OF_VIEW, 70.0, 0.0)\r\n    CameraSetupSetField(gg_cam_CameraHATE, CAMERA_FIELD_FARZ, 5000.0, 0.0)\r\n    CameraSetupSetField(gg_cam_CameraHATE, CAMERA_FIELD_NEARZ, 16.0, 0.0)\r\n    CameraSetupSetField(gg_cam_CameraHATE, CAMERA_FIELD_LOCAL_PITCH, 0.0, 0.0)\r\n    CameraSetupSetField(gg_cam_CameraHATE, CAMERA_FIELD_LOCAL_YAW, 0.0, 0.0)\r\n    CameraSetupSetField(gg_cam_CameraHATE, CAMERA_FIELD_LOCAL_ROLL, 0.0, 0.0)\r\n    CameraSetupSetDestPosition(gg_cam_CameraHATE, 0.0, 0.0, 0.0)\r\nend\r\n\r\n--CUSTOM_CODE\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 24.02.2020 22:15\r\n---\r\n\r\nfunction CreateDeadShip(x,y)\r\n\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 21.02.2020 21:08\r\nReactionAI=1\r\nUnitAI={}\r\n\r\nfunction StartSheepAI(hero)\r\n\tif UnitAI[GetHandleId(hero)]==nil then\r\n\t--\tprint(\"Запущен первый прототип ИИ\")\r\n\telse\r\n\t\tprint(\"ОШИБКА, НЕВОЗМОЖНО ИЗМЕНИТЬ ТИП ИИ\")\r\n\tend\r\n\tUnitAI[GetHandleId(hero)]={\r\n\t\tIsMove=true,\r\n\t\tIsAttack=false,\r\n\t\tIsEscape=false,\r\n\t\tRandomTimeFactor=GetRandomReal(-.5,.5)\r\n\t}\r\n\tlocal data=UnitAI[GetHandleId(hero)]\r\n\tTimerStart(CreateTimer(), ReactionAI+data.RandomTimeFactor, true, function()--поиск врага 1 секунда по умлочанию\r\n\t\tlocal e=nil\r\n\t\tlocal x,y=GetUnitXY(hero)\r\n\t\tlocal enemy=nil\r\n\t\tGroupEnumUnitsInRange(perebor,x,y,1000,nil)\r\n\t\twhile true do\r\n\t\t\te = FirstOfGroup(perebor)\r\n\t\t\tif e == nil then break end\r\n\t\t\tif UnitAlive(e) and IsUnitEnemy(e,GetOwningPlayer(hero)) and IsUnitVisible(e,GetOwningPlayer(hero)) and data.IsEscape==false then\r\n\t\t\t\tenemy=e\r\n\t\t\t\tdata.IsAttack=true\r\n\t\t\t\t--print(\"Найден враг \"..GetUnitName())\r\n\t\t\tend\r\n\t\t\tGroupRemoveUnit(perebor,e)\r\n\t\tend\r\n\t\tif enemy~=nil then\r\n\t\t\tlocal xe,ye=GetUnitXY(enemy)\r\n\t\t\tif IsUnitInRange(hero,enemy,100) then\r\n\t\t\t\tif data.IsEscape==false then\r\n\t\t\t\t\tlocal escapeX,escapeY=MoveXY(xe,ye,500,GetUnitFacing(hero)-180)\r\n\t\t\t\t\t--print(\"Слишком близко!\")\r\n\t\t\t\t\tdata.IsEscape=true\r\n\t\t\t\t\tdata.IsAttack=false\r\n\t\t\t\t\tIssuePointOrder(hero,\"move\",escapeX,escapeY)\r\n\t\t\t\t\tTimerStart(CreateTimer(), 3, false, function()--3 секунды отсутпления\r\n\t\t\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t\t\t\tdata.IsEscape=false\r\n\t\t\t\t\t\tdata.IsAttack=true\r\n\t\t\t\t\t\t--print(\"снова в бой\")\r\n\t\t\t\t\tend)\r\n\t\t\t\tend\r\n\t\t\telse\r\n\t\t\t\tif data.IsEscape==false then\r\n\t\t\t\t\tif GetUnitCurrentOrder(hero)~=String2OrderIdBJ(\"move\") then\r\n\t\t\t\t\t\tIssuePointOrder(hero,\"move\",xe,ye)\r\n\t\t\t\t\tend\r\n\t\t\t\t\tSingleCannon(hero)\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\tend\r\n\t\tif UnitAlive(hero)==false then\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t--\tprint(\"умираю....\")\r\n\t\tend\r\n\tend)\r\nend\r\n-------------------башенки\r\nfunction StartTowerAI(hero)\r\n\tif UnitAI[GetHandleId(hero)]==nil then\r\n\t\t--\tprint(\"Запущен первый прототип ИИ\")\r\n\telse\r\n\t\tprint(\"ОШИБКА, НЕВОЗМОЖНО ИЗМЕНИТЬ ТИП ИИ\")\r\n\tend\r\n\tUnitAI[GetHandleId(hero)]={\r\n\t\tIsAttack=false,\r\n\t\tFocusUnit=nil,\r\n\t\tRandomTimeFactor=GetRandomReal(-.5,.5)\r\n\t}\r\n\tlocal data=UnitAI[GetHandleId(hero)]\r\n\tTimerStart(CreateTimer(), ReactionAI+data.RandomTimeFactor, true, function()--поиск врага 1 секунда по умлочанию\r\n\t\tlocal e=nil\r\n\t\tlocal x,y=GetUnitXY(hero)\r\n\t\tlocal enemy=nil\r\n\t\tGroupEnumUnitsInRange(perebor,x,y,2000,nil)\r\n\t\twhile true do\r\n\t\t\te = FirstOfGroup(perebor)\r\n\t\t\tif e == nil or enemy~=nil then break end\r\n\t\t\tif UnitAlive(e) and IsUnitEnemy(e,GetOwningPlayer(hero)) and IsUnitVisible(e,GetOwningPlayer(hero)) then\r\n\t\t\t\tenemy=e\r\n\t\t\t\tdata.IsAttack=true\r\n\t\t\t\t--print(\"Найден враг \"..GetUnitName())\r\n\t\t\tend\r\n\t\t\tGroupRemoveUnit(perebor,e)\r\n\t\tend\r\n\r\n\t\tif data.IsAttack and data.FocusUnit~=enemy then\r\n\t\t\tSetUnitLookAt(hero, 'bone_turret', enemy, 0, 0, 90)\r\n\t\t\tdata.FocusUnit=enemy\r\n\t\tend\r\n\r\n\t\tif enemy~=nil then\r\n\t\t\tif IsUnitInRange(hero,enemy,1800) then\r\n\t\t\t\tlocal xe,ye=GetUnitXY(enemy)\r\n\t\t\t\tlocal angle=AngleBetweenXY(xe,ye,x,y)/bj_DEGTORAD\r\n\t\t\t\tlocal dist=DistanceBetweenXY(x,y,xe,ye)\r\n\t\t\t\tCreateArtToss(hero,\"Abilities/Spells/Other/Volcano/VolcanoMissile.mdl\",angle-180,dist,3)\r\n\t\t\telse\r\n\t\t\t\tdata.IsAttack=false\r\n\t\t\t\tdata.FocusUnit=nil\r\n\t\t\tend\r\n\t\tend\r\n\t\tif UnitAlive(hero)==false then\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t--\tprint(\"умираю....\")\r\n\t\tend\r\n\tend)\r\nend\r\n\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 22.02.2020 21:14\r\nfunction ActivatedAllTower()\r\n\tlocal e--временный юнит\r\n\tlocal k=0\r\n\tlocal id=FourCC('h002')\r\n\tGroupEnumUnitsInRect(perebor,bj_mapInitialPlayableArea,nil)\r\n\twhile true do\r\n\t\te = FirstOfGroup(perebor)\r\n\t\tif e == nil then break end\r\n\t\tif UnitAlive(e) and GetUnitTypeId(e)==id then\r\n\t\t\tk=k+1\r\n\t\t\tStartTowerAI(e)\r\n\t\tend\r\n\t\tGroupRemoveUnit(perebor,e)\r\n\tend\r\n\t--print(\"Запущено башен: \"..k)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 24.02.2020 13:40\r\n\r\nfunction RegisterAllAmmoBoxes(hero)\r\n\tlocal gg_trg_RANGE = CreateTrigger()\r\n\tTriggerRegisterUnitInRangeSimple(gg_trg_RANGE, 150, hero)\r\n\r\n\tTriggerAddAction(gg_trg_RANGE, function()\r\n\t\tlocal AmmoBox=GetTriggerUnit()\r\n\t\t--hero - юнит к которому подошли\r\n\t\tTimerStart(CreateTimer(), 0.5, true, function()\r\n\t\t\tCallCollect(hero,AmmoBox)\r\n\t\t\tif not IsUnitInRange(hero,AmmoBox,300) then\r\n\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tend\r\n\t\t\tif not UnitAlive(AmmoBox) then\r\n\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tend\r\n\t\tend)\r\n\tend)\r\nend\r\n\r\nfunction CallCollect (hero,AmmoBox)\r\n\tlocal IsResurrected=false\r\n\tlocal IsKill=false\r\n\t--print(\"any\")\r\n\tif not AmmoBox then\r\n\r\n\tend\r\n\tif IsUnitZCollision(hero,GetUnitZ(AmmoBox)) then\r\n\t\tif  GetUnitTypeId(AmmoBox)==FourCC('e002') then-- простой ящик\r\n\t\t\t--print(\"мммм\")\r\n\t\t\tHeroUpdateWeaponCharges(hero,1,-100)\r\n\t\t\tHeroUpdateWeaponCharges(hero,2,-100)\r\n\t\t\tIsResurrected=true\r\n\t\t\tIsKill=true\r\n\t\telseif GetUnitTypeId(AmmoBox)==FourCC('e003') or GetUnitTypeId(AmmoBox)==FourCC('e006') then\r\n\t\t\tif Ammo[GetPlayerId(GetOwningPlayer(hero))].Available.Rocket==false then\r\n\t\t\t\tAmmo[GetPlayerId(GetOwningPlayer(hero))].Available.Rocket=true\r\n\t\t\tend\r\n\t\t\tHeroUpdateWeaponCharges(hero,3,-50)\r\n\t\t\tIsResurrected=false\r\n\t\t\tIsKill=true\r\n\t\telseif GetUnitTypeId(AmmoBox)==FourCC('e007') then\r\n\t\t\tif Ammo[GetPlayerId(GetOwningPlayer(hero))].Available.Fire==false then\r\n\t\t\t\tAmmo[GetPlayerId(GetOwningPlayer(hero))].Available.Fire=true\r\n\t\t\tend\r\n\t\t\tHeroUpdateWeaponCharges(hero,4,-300)\r\n\t\t\tIsResurrected=false\r\n\t\t\tIsKill=true\r\n\t\telseif GetUnitTypeId(AmmoBox)==FourCC('e008') then\r\n\t\t\tif Ammo[GetPlayerId(GetOwningPlayer(hero))].Available.Toss==false then\r\n\t\t\t\tAmmo[GetPlayerId(GetOwningPlayer(hero))].Available.Toss=true\r\n\t\t\tend\r\n\t\t\tHeroUpdateWeaponCharges(hero,5,-15)\r\n\t\t\tIsResurrected=false\r\n\t\t\tIsKill=true\r\n\t\telseif GetUnitTypeId(AmmoBox)==FourCC('e009') then\r\n\t\t\tif Ammo[GetPlayerId(GetOwningPlayer(hero))].Available.Barrel==false then\r\n\t\t\t\tAmmo[GetPlayerId(GetOwningPlayer(hero))].Available.Barrel=true\r\n\t\t\tend\r\n\t\t\tHeroUpdateWeaponCharges(hero,6,-10)\r\n\t\t\tIsResurrected=false\r\n\t\t\tIsKill=true\r\n\t\tend\r\n\r\n\t\tif UnitAlive(AmmoBox) and IsKill then\r\n\t\t\tlocal x,y=GetUnitXY(AmmoBox)\r\n\t\t\tlocal p=GetOwningPlayer(AmmoBox)\r\n\t\t\tlocal id=GetUnitTypeId(AmmoBox)\r\n\t\t\tKillUnit(AmmoBox)\r\n\t\t\tPlaySoundAtPointBJ( gg_snd_CollectOB1, 100, Location(GetUnitXY(hero)), 0 )\r\n\t\t\tif IsResurrected then\r\n\t\t\t\tTimerStart(CreateTimer(), 60, false, function()\r\n\t\t\t\t\tlocal new=CreateUnit(p,id,x,y,0)\r\n\t\t\t\t\tSetUnitAnimation(new,\"Birth\")\r\n\t\t\t\tend)\r\n\t\t\tend\r\n\t\tend\r\n\tend\r\nend\r\n\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 22.02.2020 18:00\r\n---\r\nfunction RegisterAnyCheckpointSave()\r\n\tSetMaxCheckpointSaves(3)\r\n\tlocal gg_trg_RANGE = CreateTrigger()\r\n\tlocal e\r\n\tlocal k=0\r\n\tlocal id=FourCC('o000')--верфь\r\n\tGroupEnumUnitsInRect(perebor,bj_mapInitialPlayableArea,nil)\r\n\twhile true do\r\n\t\te = FirstOfGroup(perebor)\r\n\t\tif e == nil then break end\r\n\t\tif UnitAlive(e) and GetUnitTypeId(e)==id then\r\n\t\t\tk=k+1\r\n\r\n\t\t\tTriggerRegisterUnitInRangeSimple(gg_trg_RANGE, 256, e)\r\n\t\tend\r\n\t\tGroupRemoveUnit(perebor,e)\r\n\tend\r\n\r\n\tTriggerAddAction(gg_trg_RANGE, function()\r\n\t\tlocal hero=GetTriggerUnit()\r\n\t\tlocal x,y=GetUnitXY(hero)\r\n\t\tlocal e\r\n\t\tlocal id=FourCC('o000')--верфь\r\n\t\tlocal data=HERO[UnitGetPid(hero)]\r\n\t\t--print(GetUnitName(hero)..\" 1\")\r\n\t\tHealUnit(hero,9999)\r\n\t\tGroupEnumUnitsInRange(perebor,x,y,500,nil)\r\n\t\twhile true do\r\n\t\t\te = FirstOfGroup(perebor)\r\n\t\t\tif e == nil then break end\r\n\t\t\tif UnitAlive(e) and GetUnitTypeId(e)==id and data.ChkPointID~=GetHandleId(e) then  --\r\n\t\t\t\tlocal pid=GetPlayerId(GetOwningPlayer(hero))\r\n\t\t\t\tSetUnitOwner(e,GetOwningPlayer(hero),true)\r\n\t\t\t\tSaveGameCheckpoint(\"Ship\",true)\r\n\t\t\t\tdata.ChkPointID=GetHandleId(e)\r\n\t\t\t\t--print(GetUnitName(hero))\r\n\t\t\t\tDefineStartLocation(0, x, y)\r\n\t\t\t\tSetPlayerStartLocation(GetOwningPlayer(hero),0)\r\n\r\n\t\t\t\t--добавляем, чуть чуть чуть боеприпасов для каждого разблокированного оружия\r\n\t\t\t\tif GetOwningPlayer(e)~=GetOwningPlayer(hero) then\r\n\t\t\t\t\tif Ammo[pid].Available.Single then\r\n\t\t\t\t\t\tHeroUpdateWeaponCharges(hero,1,-50)\r\n\t\t\t\t\tend\r\n\t\t\t\t\tif Ammo[pid].Available.Board then\r\n\t\t\t\t\t\tHeroUpdateWeaponCharges(hero,2,-50)\r\n\t\t\t\t\tend\r\n\t\t\t\t\tif Ammo[pid].Available.Rocket then\r\n\t\t\t\t\t\tHeroUpdateWeaponCharges(hero,3,-10)\r\n\t\t\t\t\tend\r\n\t\t\t\t\tif Ammo[pid].Available.Fire then\r\n\t\t\t\t\t\tHeroUpdateWeaponCharges(hero,4,-100)\r\n\t\t\t\t\tend\r\n\t\t\t\t\tif Ammo[pid].Available.Toss then\r\n\t\t\t\t\t\tHeroUpdateWeaponCharges(hero,5,-5)\r\n\t\t\t\t\tend\r\n\t\t\t\t\tif Ammo[pid].Available.Barrel then\r\n\t\t\t\t\t\tHeroUpdateWeaponCharges(hero,6,-5)\r\n\t\t\t\t\tend\r\n\t\t\t\t\tif Ammo[pid].Available.Light then\r\n\t\t\t\t\t\tHeroUpdateWeaponCharges(hero,7,-10)\r\n\t\t\t\t\tend\r\n\t\t\t\t\tif Ammo[pid].Available.Saw then\r\n\t\t\t\t\t\t--HeroUpdateWeaponCharges(hero,2,-10)\r\n\t\t\t\t\t\t--ничего, это оружие бесконечное\r\n\t\t\t\t\tend\r\n\t\t\t\t\tif Ammo[pid].Available.Oil then\r\n\t\t\t\t\t\tHeroUpdateWeaponCharges(hero,9,-10)\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\tGroupRemoveUnit(perebor,e)\r\n\t\tend\r\n\tend)\r\nend\r\n\r\nfunction HealUnit(hero,amount)\r\n\tlocal p=GetOwningPlayer(hero)\r\n\tlocal MaxHP=BlzGetUnitMaxHP(hero)\r\n\tlocal CurrentHP=GetUnitState(hero,UNIT_STATE_LIFE)\r\n\tlocal LoosingHP=MaxHP-CurrentHP\r\n\tlocal OverHeal=amount-LoosingHP\r\n\tlocal TotalHeal=amount\r\n\tif LoosingHP<=amount then TotalHeal=LoosingHP\tend\r\n\tSetUnitState(hero,UNIT_STATE_LIFE,CurrentHP+TotalHeal)\r\n\tif TotalHeal>1 then\r\n\t\tFlyTextTagLumberBounty(hero,\"+\"..R2I(TotalHeal),p)\r\n\tend\r\n\treturn OverHeal\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 09.02.2020 13:11\r\n---\r\nfunction CreateTorrent(x,y,size,zMax)\r\n\tlocal torrent=nil\r\n\tlocal z=GetTerrainZ(x,y)\r\n\tlocal IsWater=false\r\n\tif size==nil then size=1 end\r\n\tif zMax==nil then zMax=size*50 end\r\n\tif z<=-80 then\r\n\t\ttorrent=AddSpecialEffect(\"Torrent\",x,y)\r\n\t\tBlzSetSpecialEffectMatrixScale(torrent,size,size,size/10)\r\n\t\tDestroyEffect(torrent)\r\n\t\tIsWater=true\r\n\t\tif size>=3 then\r\n\t\t\tUnitFlyTorrentInRange(x,y,size*50,zMax)\r\n\t\tend\r\n\tend\r\n\treturn IsWater\r\nend\r\n\r\nfunction UnitFlyTorrentInRange(x,y,range,zMax)\r\n\tlocal e--временный юнит\r\n\tif zMax==nil then zMax=110 end\r\n\tGroupEnumUnitsInRange(perebor,x,y,range,nil)\r\n\twhile true do\r\n\t\te = FirstOfGroup(perebor)\r\n\t\tif e == nil then break end\r\n\t\tif UnitAlive(e) and GetUnitFlyHeight(e)<=10 then\r\n\t\t\tFlyUnitOnTorrent(e,zMax)\r\n\r\n\t\t\tSetUnitPathing(e,false)--отключени\r\n\r\n\t\t\tif IsUnitType(e,UNIT_TYPE_HERO) then\r\n\t\t\t\tlocal data=HERO[UnitGetPid(e)]\r\n\t\t\t\tdata.OnTorrent=true\r\n\t\t\t\tlocal distance=DistanceBetweenXY(x,y,GetUnitX(e),GetUnitY(e))\r\n\t\t\t\tlocal angle=AngleBetweenXY(x,y,GetUnitX(e),GetUnitY(e))/bj_DEGTORAD\r\n\t\t\t\tUnitAddVectorForce(e,angle,distance/16,distance*3)\r\n\t\t\t\t--print(distance..GetUnitName(e))\r\n\t\t\telse\r\n\t\t\t\tUnitCollisionOFF(e)\r\n\t\t\tend\r\n\t\tend\r\n\t\tGroupRemoveUnit(perebor,e)\r\n\tend\r\nend\r\n\r\nfunction UnitGetPid(hero)\r\n\treturn GetPlayerId(GetOwningPlayer(hero))\r\nend\r\n\r\n\r\nfunction FlyUnitOnTorrent(hero,MaxHeight)\r\n\tlocal i=0\r\n\tlocal speed=10\r\n\tTimerStart(CreateTimer(), TIMER_PERIOD, true, function()\r\n\t\tlocal x,y=GetUnitXY(hero)\r\n\t\t---local nx,ny=MoveXY(x,y,speed,angle)\r\n\t\tlocal f=ParabolaZ(MaxHeight, MaxHeight,i*speed)\r\n\t\tlocal z=GetUnitZ(hero)\r\n\t\tlocal zGround=GetTerrainZ(x,y)\r\n\t\tSetUnitZ(hero,f)\r\n\t\t--print(\"z=\"..z)\r\n\t\t--print(\"zGround=\"..zGround)\r\n\t\ti=i+1\r\n\t\tif  i>5 and z<=zGround+1 then--z<=-89 and\r\n\t\t\t--UnitRemoveAbility(hero,FourCC('Aeth'))\r\n\t\t\t--SetUnitPathing(hero,true)\r\n\t\t\tUnitRemoveAbility(hero,FourCC('B000'))\r\n\t\t\tif IsUnitType(hero,UNIT_TYPE_HERO) then\r\n\t\t\t\tlocal data=HERO[UnitGetPid(hero)]\r\n\t\t\t\t--IssueImmediateOrder(hero,\"stop\")\r\n\t\t\t\tdata.OnTorrent=false\r\n\t\t\t\tdata.OnWater=true\r\n\t\t\t\tSetUnitPathing(hero,true)\r\n\t\t\t\t--print(\"false\")\r\n\t\t\tend\r\n\t\t\t--print(\"end\")\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tCreateTorrent(x,y)\r\n\t\tend\r\n\t\tif i>=100 then\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tprint(\"ERROR\")\r\n\t\tend\r\n\tend)\r\nend\r\n\r\n\r\n\r\nfunction WaveEffect(eff)\r\n\tlocal i=0\r\n\tlocal wave=50\r\n\tlocal deep=BlzGetLocalSpecialEffectZ(eff)\r\n\r\n\tTimerStart(CreateTimer(), TIMER_PERIOD, true, function()\r\n\t\tlocal f=SinBJ(i*wave)\r\n\t\tBlzSetSpecialEffectZ(eff,f+deep)\r\n\t\ti=i+0.3\r\n\t\tif i>=wave then\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\tend\r\n\tend)\r\nend\r\n\r\nfunction ExplodeEffect(eff,size)\r\n\tlocal onGround=false\r\n\tlocal x,y=BlzGetLocalSpecialEffectX(eff),BlzGetLocalSpecialEffectY(eff)\r\n\tlocal explode=AddSpecialEffect(\"Abilities/Spells/Other/TinkerRocket/TinkerRocketMissile.mdl\",x,y)\r\n\tBlzSetSpecialEffectScale(explode,size)\r\n\tDestroyEffect(explode)\r\n\tonGround=CreateTorrent(x,y,size)\r\n\tRemoveEffect(eff)\r\n\treturn onGround\r\nend\r\n\r\nfunction EffectAddExplodedTimer(eff,time,hero)\r\n\tlocal sec=time\r\n\tlocal x,y=BlzGetLocalSpecialEffectX(eff),BlzGetLocalSpecialEffectY(eff)\r\n\tTimerStart(CreateTimer(), 1, true, function()\r\n\t\tif sec>0 then\r\n\t\t\tFlyTextTagMissXY(x,y,sec,GetOwningPlayer(hero))\r\n\t\tend\r\n\t\tsec=sec-1\r\n\t\tif sec<0 then\r\n\t\t\tExplodeEffect(eff,3)\r\n\t\t\tUnitDamageArea(hero,500,x,y,300)\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\tend\r\n\tend)\r\nend\r\n\r\nfunction RemoveEffect (eff)\r\n\tBlzSetSpecialEffectPosition(eff,4000,4000,-200)\r\n\tDestroyEffect(eff)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 06.02.2020 18:00\r\n---\r\n---\r\n---\r\n---\r\n--BlzLoadTOCFile(\"Main.toc\")\r\n--HealthPlayer1 = HealthBarAdd(udg_Pala)\r\n--BlzFrameSetAbsPoint(HealthPlayer1, FRAMEPOINT_TOPRIGHT, 0.8, 0.57)\r\n\r\nfunction HealthBarAdd(u)\r\n\tlocal bar = BlzCreateSimpleFrame(\"MyFakeBar\", BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0), 0)\r\n\tBlzFrameSetVisible(bar,true)\r\n\tBlzFrameSetTexture(bar, \"Replaceabletextures\\\\Teamcolor\\\\Teamcolor00.blp\", 0, true)\r\n\tBlzFrameSetTexture(BlzGetFrameByName(\"MyFakeBarBorder\",0),\"MyBarBorder.blp\", 0, true)\r\n\tBlzFrameSetText(BlzGetFrameByName(\"MyFakeBarTitle\",0), GetHeroProperName(u))\r\n\tlocal lefttext = BlzGetFrameByName(\"MyFakeBarLeftText\",0)\r\n\tlocal righttext = BlzGetFrameByName(\"MyFakeBarRightText\",0)\r\n\tlocal function on_timer()\r\n\t\tBlzFrameSetValue(bar, GetUnitLifePercent(u))\r\n\t\tBlzFrameSetText(lefttext, R2I(GetWidgetLife(u)))\r\n\t\tBlzFrameSetText(righttext, R2I(BlzGetUnitMaxHP(u)))\r\n\tend\r\n\tTimerStart(CreateTimer(),0.5,true, on_timer)\r\n\treturn bar\r\nend\r\n\r\n\r\n\r\nFrameSelecter={}\r\nVisualCharges={}\r\nMiniMap={}\r\n\r\ndo --Инициализация\r\n\tTimerStart(CreateTimer(), 1, false, function()\r\n\t\t--создаёт триггер отлова клавишь\r\n\t\tif not BlzLoadTOCFile(\"Main.toc\") then\r\n\t\t\tprint(\"errloadtoc\")\r\n\t\tend\r\n\t\tTimerStart(CreateTimer(), 1, false, function()\r\n\t\t\t--CreateWeaponFrameGlue()\r\n\t\tend)\r\n\tend)\r\nend\r\n\r\n\r\nfunction CreateWeaponFrameGlue()\r\n\tprint(\"стартуем рисовать Убер кнопки\")\r\n\tlocal NextPoint=0.039\r\n\tlocal SelfFrame = BlzCreateFrame(\"GlueWText\", BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0), 0, 0)\r\n\tlocal IconFrame = BlzFrameGetChild(SelfFrame, 0)\r\n\tlocal texture=nil\r\n\tif not texture then\r\n\t\ttexture=\"ReplaceableTextures\\\\CommandButtons\\\\BTNSelectHeroOn\"\r\n\tend\r\n\t--BlzFrameSetTexture(IconFrame, texture, 0, true)\r\n\tBlzFrameSetText(BlzFrameGetChild(SelfFrame, 2), \"Test\")\r\n\tBlzFrameSetAllPoints(IconFrame, SelfFrame)\r\n\tBlzFrameSetSize(IconFrame,NextPoint,NextPoint)\r\n\tBlzFrameSetAbsPoint(IconFrame,FRAMEPOINT_CENTER,0.4,0.3)\r\n\r\n\r\n\tprint(\"создаём события..\")\r\n\tlocal  ClickTrig = CreateTrigger()\r\n\tBlzFrameSetEnable(BlzGetTriggerFrame(), false)\r\n\tBlzFrameSetEnable(BlzGetTriggerFrame(), true)\r\n\tBlzTriggerRegisterFrameEvent(ClickTrig, SelfFrame, FRAMEEVENT_CONTROL_CLICK)\r\n\tprint(\"гRRRRRRAAAAAAA\") --Работает\r\n\tTriggerAddAction(ClickTrig, function ()\r\n\t\tprint(\"Нажата кнопка \") --Вот тут уже не работает\r\n\t\tBlzFrameSetEnable(BlzGetTriggerFrame(), false)\r\n\t\tBlzFrameSetEnable(BlzGetTriggerFrame(), true)\r\n\tend)\r\n\r\n\tlocal  TrigMOUSE_ENTER = CreateTrigger()\r\n\tBlzTriggerRegisterFrameEvent( TrigMOUSE_ENTER, SelfFrame, FRAMEEVENT_MOUSE_ENTER)\r\n\tTriggerAddAction( TrigMOUSE_ENTER, function ()\r\n\t\tprint(\"показать подсказку\")\r\n\r\n\tend)\r\n\tlocal  TrigMOUSE_LEAVE = CreateTrigger()\r\n\tBlzTriggerRegisterFrameEvent( TrigMOUSE_LEAVE, SelfFrame, FRAMEEVENT_MOUSE_LEAVE)\r\n\tTriggerAddAction( TrigMOUSE_LEAVE, function ()\r\n\t\t--data.MouseOnFrame=false\r\n\t\t--HideAllToolTips(mainData)\r\n\t\tprint(\"убрать подсказку\")\r\n\tend)\r\n\tprint(\"endglue..\") --работает\r\nend\r\n\r\n\r\n\r\nfunction CreateWeaponFrame() --Отключено\r\n\tlocal texture={\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNDwarvenLongRifle.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNHumanMissileUpThree.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNClusterRockets.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNFireBolt.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNFireRocks.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNBarrel.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNChainLightning.blp\",\r\n\t\t\"ReplaceableTextures\\\\PassiveButtons\\\\PASBTNUpgradeMoonGlaive.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNUnstableConcoction.blp\",\r\n\t}\r\n\tlocal weaponName= {\r\n\t\t\"[1] Носовое ордие\",\r\n\t\t\"[2] Бортовые пушки\",\r\n\t\t\"[3] Ракетница\",\r\n\t\t\"[4] Огнемёт\",\r\n\t\t\"[5] Вертикальный залп\",\r\n\t\t\"[6] Бочка\",\r\n\t\t\"[7] Молнии\",\r\n\t\t\"[8] Пилы\",\r\n\t\t\"[9] Нефтяное пятно\"\r\n\t}\r\n\tlocal description={\r\n\t\t\"Одиночный выстрел [RMB]\",\r\n\t\t\"Несколько выстрелов с борта [RMB] [LMB]\",\r\n\t\t\"Самоновадящаяся ракета [RMB] на цель\",\r\n\t\t\"Огнемёт из бортовых орудий. Удерживайте [RMB] [LMB] \",\r\n\t\t\"Стреляет в указанную точку навесом [RMB]\",\r\n\t\t\"Спускает на воду бочку [RMB]\",\r\n\t\t\"Бьёт молнией в указанную цель [RMB]\",\r\n\t\t\"Урон касанием, перемещает пилу по корпусу [RMB]\",\r\n\t\t\"Оставляет позади себя нефтяное пятно, можно поджечь [RMB]\"\r\n\t}\r\n\r\n\r\n\t--NewButton()\r\n\tlocal next=0.039\r\n\tlocal qerf=0\r\n\tfor i = 0, 8 do\r\n\t\tlocal face = BlzCreateFrameByType(\"BACKDROP\", \"Face\", BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0), \"\", 0)\r\n\t\tlocal faceHover = BlzCreateFrameByType(\"FRAME\", \"FaceFrame\", face,\"\", 0)\r\n\t\tlocal tooltip = BlzCreateFrame(\"BoxedText\", face, 0, 0)\r\n\t\tlocal charges= BlzCreateFrameByType(\"BACKDROP\", \"Face\", BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0), \"\", 0)\r\n\t\tlocal new_FrameChargesText = BlzCreateFrameByType(\"TEXT\", \"ButtonChargesText\", charges, \"\", 0)\r\n\r\n\t\t--[[]local TextNumber = BlzCreateFrameByType(\"TEXT\", \"ButtonChargesText\", face, \"\", 0)\r\n\t\tBlzFrameSetPoint(TextNumber, FRAMEPOINT_CENTER, face, FRAMEPOINT_CENTER, 0.,0.)\r\n\t\tBlzFrameSetText(TextNumber, i+1)]]\r\n\r\n\t\tlocal hot=BlzCreateFrameByType(\"BACKDROP\", \"Face\", face, \"\", 0)\r\n\t\tBlzFrameSetTexture(hot, \"DDSSymbols\\\\\"..(i+1)..\".dds\", 0, true)\r\n\t\tBlzFrameSetSize(hot, 0.02, 0.02)\r\n\t\tBlzFrameSetPoint(hot, FRAMEPOINT_CENTER, face, FRAMEPOINT_CENTER, 0.,0.)\r\n\r\n\t\tBlzFrameSetPoint(new_FrameChargesText, FRAMEPOINT_CENTER, charges, FRAMEPOINT_CENTER, 0.,0.)\r\n\t\tBlzFrameSetText(new_FrameChargesText, \"0\")\r\n\t\tBlzFrameSetAllPoints(faceHover, face)\r\n\t\tBlzFrameSetTooltip(faceHover, tooltip)\r\n\t\tBlzFrameSetTexture(face, texture[i+1],0, true)\r\n\t\tBlzFrameSetTexture(charges, \"ChargesTexture.blp\", 0, true)\r\n\t\tBlzFrameSetSize(face, 0.04, 0.04)\r\n\t\tBlzFrameSetSize(charges, 0.04, 0.012)\r\n\t\tBlzFrameSetAbsPoint(face, FRAMEPOINT_TOPLEFT, next+next+next*i, next*1.3)\r\n\t\tBlzFrameSetAbsPoint(charges, FRAMEPOINT_TOPLEFT, next+next+next*i, next*1.6)\r\n\t\tBlzFrameSetAbsPoint(tooltip, FRAMEPOINT_TOP, next+next+next*i, next*3)\r\n\t\tBlzFrameSetSize(tooltip, 0.15, 0.08)\r\n\t\tBlzFrameSetText(BlzGetFrameByName(\"BoxedTextValue\",0), description[i+1])\r\n\t\tBlzFrameSetText(BlzGetFrameByName(\"BoxedTextTitle\",0), weaponName[i+1])\r\n\t\t--if i==0 then\r\n\t\tlocal buttonsprite = BlzCreateFrameByType(\"SPRITE\", \"justAName\", face, \"WarCraftIIILogo\", 0)\r\n\t\tBlzFrameSetPoint(buttonsprite, FRAMEPOINT_BOTTOMLEFT, face, FRAMEPOINT_BOTTOMLEFT, 0.02, 0.02)\r\n\t\tBlzFrameSetSize(buttonsprite, 1., 1.)\r\n\t\tBlzFrameSetScale(buttonsprite, 1.)\r\n\t\tBlzFrameSetModel(buttonsprite, \"selecter1.mdx\", 0)\r\n\t\tFrameSelecter[i+1]=buttonsprite\r\n\t\tVisualCharges[i+1]=new_FrameChargesText\r\n\t\t--ТАЛАНТЫ\r\n\r\n\t\tfor k=1,3 do\r\n\t\t\tlocal TalantBut=BlzCreateFrameByType(\"BACKDROP\", \"Face\", BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0), \"\", 0)\r\n\t\t\tBlzFrameSetTexture(TalantBut, texture[i+1], 0, true)\r\n\t\t\tBlzFrameSetSize(TalantBut, 0.013, 0.013)\r\n\t\t\t--print(k)\r\n\t\t\tBlzFrameSetAbsPoint(TalantBut, FRAMEPOINT_TOPLEFT, next*1.75+next*i+next*k*.3, 0.013)\r\n\t\tend\r\n\r\n\t\t--\r\n\t\tqerf=next+next+next*i\r\n\t\tif i>= 1 then\r\n\t\t\tBlzFrameSetVisible(buttonsprite,false)\r\n\t\tend\r\n\r\n\t\tlocal t = CreateTrigger()\r\n\t\tBlzTriggerRegisterFrameEvent(t, tooltip, FRAMEEVENT_CONTROL_CLICK)\r\n\t\tBlzTriggerRegisterFrameEvent(t, faceHover, FRAMEEVENT_CONTROL_CLICK)\r\n\t\tBlzTriggerRegisterFrameEvent(t, face, FRAMEEVENT_CONTROL_CLICK)\r\n\t\tBlzTriggerRegisterFrameEvent(t, buttonsprite, FRAMEEVENT_CONTROL_CLICK)\r\n\t\tBlzTriggerRegisterFrameEvent(t, charges, FRAMEEVENT_CONTROL_CLICK)\r\n\t\tTriggerAddAction(t,function()\r\n\t\t\tprint(\"click \"..i) -- вот тут не работает\r\n\t\tend)\r\n\tend\r\n\t--Создаём кнопки QERF\r\n\t--[[local gold=BlzCreateFrameByType(\"TEXT\", \"ButtonChargesText\", BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0), \"\", 0)\r\n\tBlzFrameSetAbsPoint(gold, FRAMEPOINT_CENTER,  0.4,0.3)\r\n\tBlzFrameSetText(gold, \"Недостаточно золота\")]]\r\n\r\n\tfor i=1,4 do\r\n\t\tlocal SkillButton=BlzCreateFrameByType(\"BACKDROP\", \"Face\", BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0), \"\", 0)\r\n\t\tBlzFrameSetTexture(SkillButton, \"ChargesTexture.blp\", 0, true)\r\n\t\tBlzFrameSetSize(SkillButton, 0.04, 0.04)\r\n\t\tBlzFrameSetAbsPoint(SkillButton, FRAMEPOINT_TOPLEFT, qerf+next*i, next*1.3)\r\n\r\n\t\tlocal hot=BlzCreateFrameByType(\"BACKDROP\", \"Face\", SkillButton, \"\", 0)\r\n\t\tif i==1 then\r\n\t\t\tBlzFrameSetTexture(hot, \"DDSSymbols\\\\q.dds\", 0, true)\r\n\t\telseif i==2 then\r\n\t\t\tBlzFrameSetTexture(hot, \"DDSSymbols\\\\e.dds\", 0, true)\r\n\t\telseif i==3 then\r\n\t\t\tBlzFrameSetTexture(hot, \"DDSSymbols\\\\r.dds\", 0, true)\r\n\t\telseif i==4 then\r\n\t\t\tBlzFrameSetTexture(hot, \"DDSSymbols\\\\f.dds\", 0, true)\r\n\t\tend\r\n\t\tBlzFrameSetSize(hot, 0.03, 0.03)\r\n\t\tBlzFrameSetPoint(hot, FRAMEPOINT_CENTER, SkillButton, FRAMEPOINT_CENTER, 0.,0.)\r\n\t\tlocal t = CreateTrigger()\r\n\t\tBlzTriggerRegisterFrameEvent(t, hot, FRAMEEVENT_CONTROL_CLICK)\r\n\t\tTriggerAddAction(t,function()\r\n\t\t\tprint(\"click \"..i) -- вот тут не работает\r\n\t\tend)\r\n\r\n\tend\r\n\r\nend\r\n\r\nfunction SwitchWeaponVisual(pid,index)\r\n\tif GetLocalPlayer()==Player(pid) then\r\n\t\tfor i=1, #FrameSelecter do\r\n\t\t\tBlzFrameSetVisible(FrameSelecter[i],false)\r\n\t\tend\r\n\t\tBlzFrameSetVisible(FrameSelecter[index],true)\r\n\tend\r\nend\r\n\r\nfunction HeroUpdateWeaponCharges(hero,index,amount)\r\n\tlocal pid=GetPlayerId(GetOwningPlayer(hero))\r\n\tlocal data=Ammo[pid]\r\n\tlocal count=0\r\n\tlocal HasAmmo=true\r\n\t--слабонервным не смотреть\r\n\tif index==1 then\r\n\t\tdata.Count.Single=data.Count.Single-amount\r\n\t\tcount=data.Count.Single\r\n\telseif index==2 then\r\n\t\tdata.Count.Board=data.Count.Board-amount\r\n\t\tcount=data.Count.Board\r\n\telseif index==3 then\r\n\t\tdata.Count.Rocket=data.Count.Rocket-amount\r\n\t\tcount=data.Count.Rocket\r\n\telseif index==4 then\r\n\t\tdata.Count.Fire=data.Count.Fire-amount\r\n\t\tcount=data.Count.Fire\r\n\telseif index==5 then\r\n\t\tdata.Count.Toss=data.Count.Toss-amount\r\n\t\tcount=data.Count.Toss\r\n\telseif index==6 then\r\n\t\tdata.Count.Barrel=data.Count.Barrel-amount\r\n\t\tcount=data.Count.Barrel\r\n\telseif index==7 then\r\n\t\tdata.Count.Light=data.Count.Light-amount\r\n\t\tcount=data.Count.Light\r\n\telseif index==8 then\r\n\t\tdata.Count.Saw=data.Count.Saw-amount\r\n\t\tcount=data.Count.Saw\r\n\telseif index==9 then\r\n\t\tdata.Count.Oil=data.Count.Oil-amount\r\n\t\tcount=data.Count.Oil\r\n\tend\r\n\r\n\tif count+amount<amount then\r\n\t\tHasAmmo=false\r\n\t\tif index==1 then\r\n\t\t\tcount=data.Count.Single==0\r\n\t\telseif index==2 then\r\n\t\t\tcount=data.Count.Board==0\r\n\t\telseif index==3 then\r\n\t\t\tcount=data.Count.Rocket==0\r\n\t\telseif index==4 then\r\n\t\t\tcount=data.Count.Fire==0\r\n\t\telseif index==5 then\r\n\t\t\tcount=data.Count.Toss==0\r\n\t\telseif index==6 then\r\n\t\t\tcount=data.Count.Barrel==0\r\n\t\telseif index==7 then\r\n\t\t\tcount=data.Count.Light==0\r\n\t\telseif index==8 then\r\n\t\t\tcount=data.Count.Saw==0\r\n\t\telseif index==9 then\r\n\t\t\tcount=data.Count.Oil==0\r\n\t\tend\r\n\t\t--print(count..\" мало патронов\")\r\n\tend\r\n\t--print(count)\r\n\tif GetLocalPlayer()==Player(pid) then\r\n\tBlzFrameSetText(VisualCharges[index], count )\r\n\tend\r\n\treturn HasAmmo\r\nend\r\n\r\n\r\n\r\n\r\nButtonList={}\r\nfunction NewButton(button_type, texture, size_x, size_y, relative_frame, frame_point_from, frame_point_to, offset_x, offset_y, parent_frame)\r\n\tlocal new_Frame = BlzCreateFrame('ScriptDialogButton', parent_frame, 0, 0)\r\n\tlocal new_FrameImage = BlzCreateFrameByType(\"BACKDROP\", \"ButtonIcon\", new_Frame, \"\", 0)\r\n\tlocal new_FrameCharges = BlzCreateFrameByType(\"BACKDROP\", \"ButtonCharges\", new_Frame, \"\", 0)\r\n\tlocal new_FrameChargesText = BlzCreateFrameByType(\"TEXT\", \"ButtonChargesText\", new_FrameCharges, \"\", 0)\r\n\r\n\r\n\tButtonList[GetHandleId(new_Frame)] = {\r\n\t\tbutton_type = button_type,\r\n\t\titem = nil,\r\n\t\tbutton = new_Frame,\r\n\t\timage = new_FrameImage,\r\n\t\toriginal_texture = texture,\r\n\t\tcharges_frame = new_FrameCharges,\r\n\t\tcharges_text_frame = new_FrameChargesText,\r\n\t\tsprite = nil\r\n\t}\r\n\r\n\t--FrameRegisterNoFocus(new_Frame)\r\n\t--FrameRegisterClick(new_Frame, texture)\r\n\r\n\t--BlzTriggerRegisterFrameEvent(ClickTrigger, new_Frame, FRAMEEVENT_CONTROL_CLICK)\r\n\t--BlzTriggerRegisterFrameEvent(EnterTrigger, new_Frame, FRAMEEVENT_MOUSE_ENTER)\r\n\t--BlzTriggerRegisterFrameEvent(LeaveTrigger, new_Frame, FRAMEEVENT_MOUSE_LEAVE)\r\n\r\n\r\n\tBlzFrameSetPoint(new_FrameCharges, FRAMEPOINT_BOTTOMRIGHT, new_FrameImage, FRAMEPOINT_BOTTOMRIGHT, -0.002, 0.002)\r\n\tBlzFrameSetSize(new_FrameCharges, 0.012, 0.012)\r\n\tBlzFrameSetTexture(new_FrameCharges, \"ChargesTexture.blp\", 0, true)\r\n\tBlzFrameSetPoint(new_FrameChargesText, FRAMEPOINT_CENTER, new_FrameCharges, FRAMEPOINT_CENTER, 0.,0.)\r\n\tBlzFrameSetVisible(new_FrameCharges, false)\r\n\tBlzFrameSetText(new_FrameChargesText, \"0\")\r\n\r\n\tBlzFrameSetPoint(new_Frame, frame_point_from, relative_frame, frame_point_to, offset_x, offset_y)\r\n\tBlzFrameSetSize(new_Frame, size_x, size_y)\r\n\tBlzFrameSetTexture(new_FrameImage, texture, 0, true)\r\n\tBlzFrameSetAllPoints(new_FrameImage, new_Frame)\r\n\r\n\treturn new_Frame\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 05.02.2020 22:34\r\n---\r\n\r\nfunction hideEverything()\r\n\tBlzFrameSetVisible(BlzGetFrameByName(\"ConsoleUIBackdrop\", 0), false)\r\n\tfor i = 1,11 do\r\n\t\tBlzFrameSetVisible(BlzGetFrameByName(\"CommandButton_\"..i, 0), false)\r\n\tend\r\n\tBlzFrameSetSize(BlzGetFrameByName(\"CommandButton_0\", 0),0,0)--сколлапсировал в точку\r\n\tlocal GAME_UI     = BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0)\r\n\tlocal WORLD_FRAME = BlzGetOriginFrame(ORIGIN_FRAME_WORLD_FRAME, 0)\r\n\tBlzHideOriginFrames(true)--скрыть всё\r\n\tBlzFrameSetAllPoints(WORLD_FRAME, GAME_UI)\r\n\t--BlzFrameSetVisible(BlzGetFrameByName(\"CinematicPortrait\", 0), false)\r\n\t--скрываем по одиночке\r\n\tBlzFrameSetVisible(BlzGetOriginFrame(ORIGIN_FRAME_PORTRAIT, 0), true)\r\n\tlocal Portrait = BlzGetOriginFrame(ORIGIN_FRAME_PORTRAIT, 0)\r\n\tBlzFrameClearAllPoints(Portrait)\r\n\tBlzFrameSetAbsPoint(Portrait, FRAMEPOINT_LEFT, 0.1, 0.6 - 0.02)\r\n\tBlzFrameSetSize(Portrait, 0.03, 0.03)\r\n\r\n\tlocal map=BlzGetOriginFrame(ORIGIN_FRAME_MINIMAP, 0)\r\n\tBlzFrameClearAllPoints(map)\r\n\tBlzFrameSetVisible(map, true)\r\n\tBlzFrameSetSize(map, 0.35, 0.35)\r\n\tBlzFrameSetAbsPoint(map,FRAMEPOINT_CENTER,0.3,0.4)\r\n\tBlzFrameSetVisible(map, false)\r\n\tMiniMap[0]=map\r\n\tMiniMap[1]=map\r\n\tMiniMap[2]=map\r\n\tMiniMap[3]=map\r\n\r\nend\r\n\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 08.02.2020 21:25\r\n---\r\nDummyID=FourCC('e000')\r\nfunction CastArea(caster,id,x,y,range, xPoz,yPoz)\r\n\tlocal dx,dy=x,y\r\n\tif xPoz~=nil then\r\n\t\tprint(\"позиция\")\r\n\t\tdx,dy=xPoz,yPoz\r\n\tend\r\n\tlocal dummy=CreateUnit(GetOwningPlayer(caster), DummyID, dx, dy, 0)--\r\n\tif UnitAddAbility(dummy,id) then\r\n\telse\r\n\t\tprint(\"ошибка добавления способности\")\r\n\tend\r\n\t---для одиночек\r\n\r\n\tif range==0 or range==nil then\r\n\t\t--IssuePointOrder(dummy,\"blizzard\",x,y)-- на точку\r\n\t\tCast(dummy,x,y)\r\n\t\t--IssuePointOrder(dummy,\"acidbomb\",x,y)-- на точку\r\n\tend\r\n\tlocal e--временный юнит\r\n\tGroupEnumUnitsInRange(perebor,x,y,range,null)\r\n\twhile true do\r\n\t\te = FirstOfGroup(perebor)\r\n\t\t--print(\"перебор юнитов в радиусе \"..range..\" \"..GetUnitName(e))\r\n\t\tif e == nil then break end\r\n\t\tif UnitAlive(e) and e~=dummy then -- and GetUnitCurrentOrder(unit)~=\"attack\" then\r\n\t\t\t--print(GetUnitName(e)..\" в переборе\")\r\n\t\t\t--IssueTargetOrder(dummy,\"antimagicshell\",e)-- на юнита\r\n\t\t\t--IssueTargetOrder(dummy,\"acidbomb\",e)-- на юнита\r\n\t\t\tCast(dummy,0,0,e)\r\n\t\tend\r\n\t\tGroupRemoveUnit(perebor,e)\r\n\tend\r\n\tUnitApplyTimedLife(dummy,FourCC('e000'),3)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 06.02.2020 12:47\r\n---\r\nfunction CreateAndForceBullet(hero, angle, speed, effectmodel, xs, ys)\r\n\tlocal xhero, yhero = GetUnitX(hero), GetUnitY(hero)\r\n\tlocal zhero = GetUnitZ(hero) + 60\r\n\tlocal bullet = AddSpecialEffect(effectmodel, xs, ys)\r\n\t--local bam=nil--AddSpecialEffect(\"Abilities/Weapons/SteamTank/SteamTankImpact.mdl\",xs,ys)\r\n\t--local cloud=nil--AddSpecialEffect(\"Abilities/Weapons/SteamTank/SteamTankImpact.mdl\",xs,ys)\r\n\t--local data=HERO[GetPlayerId(GetOwningPlayer(hero))]\r\n\tlocal CollisionEnemy = false\r\n\tlocal CollisisonDestr = false\r\n\t--print(\"Скорость корабля\"..data.CurrentSpeed)\r\n\tBlzSetSpecialEffectScale(bam, 0.1)\r\n\tBlzSetSpecialEffectScale(cloud, 0.02)\r\n\tDestroyEffect(bam)\r\n\tDestroyEffect(cloud)\r\n\tBlzSetSpecialEffectZ(bullet, zhero)\r\n\t--print(zhero)\r\n\tTimerStart(CreateTimer(), TIMER_PERIOD, true, function()\r\n\t\tlocal x, y, z = BlzGetLocalSpecialEffectX(bullet), BlzGetLocalSpecialEffectY(bullet), BlzGetLocalSpecialEffectZ(bullet)\r\n\t\tlocal zGround = GetTerrainZ(MoveX(x, speed * 2, angle), MoveY(y, speed * 2, angle))\r\n\t\tBlzSetSpecialEffectPosition(bullet, MoveX(x, speed, angle), MoveY(y, speed, angle), z - 2)\r\n\t\tBlzSetSpecialEffectPosition(cloud, MoveX(x, speed / 3, angle), MoveY(y, speed / 3, angle), z - 2)\r\n\t\tSetFogStateRadius(GetOwningPlayer(hero), FOG_OF_WAR_VISIBLE, x, y, 300, true)-- Небольгая подсветка\r\n\r\n\t\t--local xbam,ybam=BlzGetLocalSpecialEffectX(bam),BlzGetLocalSpecialEffectY(bam)\r\n\t\t--BlzSetSpecialEffectPosition(bam,MoveX(xbam,2*data.CurrentSpeed,GetUnitFacing(hero)),MoveY(ybam,2*data.CurrentSpeed,GetUnitFacing(hero)),z-50)\r\n\t\tlocal ZBullet = BlzGetLocalSpecialEffectZ(bullet)\r\n\t\t--print(\"zGround =\"..zGround..\"z= \"..z)\r\n\t\t--BlzSetSpecialEffectPosition(bam,MoveX(GetUnitX(hero),120,GetUnitFacing(hero)),MoveY(GetUnitY(hero),120,GetUnitFacing(hero)),z)\r\n\t\tCollisionEnemy = UnitDamageArea(hero, 100, x, y, 100, ZBullet)\r\n\t\tCollisisonDestr = PointContentDestructable(x, y, 100, false)\r\n\t\tif z <= -90 or zGround + z >= -70 + z or CollisionEnemy or CollisisonDestr then\r\n\t\t\tPointContentDestructable(x, y, 100, true)\r\n\t\t\tif z <= -90 then\r\n\t\t\t\tCreateTorrent(x, y)\r\n\t\t\t\tBlzSetSpecialEffectPosition(bullet, 4000, 4000, 0)\r\n\t\t\tend\r\n\t\t\t--print(\"Условие урона прошло\")\r\n\t\t\tUnitDamageArea(hero, 100, x, y, 200, ZBullet)\r\n\t\t\tDestroyEffect(bullet)\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\tend\r\n\tend)\r\nend\r\n\r\nfunction SingleCannon(hero, angle, modelEff)\r\n\tif not angle then\r\n\t\tangle = GetUnitFacing(hero)\r\n\tend\r\n\tlocal x = MoveX(GetUnitX(hero), 110, angle)\r\n\tlocal y = MoveY(GetUnitY(hero), 110, angle)\r\n\tif not modelEff then\r\n\t\tmodelEff = \"Abilities/Weapons/BoatMissile/BoatMissile.mdl\"\r\n\tend\r\n\tCreateAndForceBullet(hero, angle, 30, modelEff, x, y)\r\nend\r\n\r\n---@param board real\r\nfunction BoardCannon(hero, board, cannon)\r\n\t-- left -90 right+90\r\n\tlocal facing = GetUnitFacing(hero)\r\n\tlocal angle = facing + board\r\n\tlocal x = MoveX(GetUnitX(hero), 60, angle)\r\n\tlocal y = MoveY(GetUnitY(hero), 60, angle)\r\n\tlocal inverse = -1\r\n\tif board == -90 then\r\n\t\tinverse = 1\r\n\tend\r\n\tlocal x1 = MoveX(x, 30, facing)\r\n\tlocal y1 = MoveY(y, 30, facing)\r\n\tlocal x2 = MoveX(x, -30, facing)\r\n\tlocal y2 = MoveY(y, -30, facing)\r\n\tlocal x3 = MoveX(x, -60, facing)\r\n\tlocal y3 = MoveY(y, -60, facing)\r\n\tlocal x4 = MoveX(x, -90, facing)\r\n\tlocal y4 = MoveY(y, -90, facing)\r\n\tif cannon >= 1 then\r\n\t\tCreateAndForceBullet(hero, angle, 30, \"Abilities/Weapons/BoatMissile/BoatMissile.mdl\", x, y)--Центр\r\n\tend\r\n\tif cannon >= 2 then\r\n\t\tCreateAndForceBullet(hero, angle + 5 * inverse, 30, \"Abilities/Weapons/BoatMissile/BoatMissile.mdl\", x1, y1)--Спереди\r\n\tend\r\n\tif cannon >= 3 then\r\n\t\tCreateAndForceBullet(hero, angle - 5 * inverse, 30, \"Abilities/Weapons/BoatMissile/BoatMissile.mdl\", x2, y2)--Сзади 1\r\n\tend\r\n\tif cannon >= 4 then\r\n\t\tCreateAndForceBullet(hero, angle - 10 * inverse, 30, \"Abilities/Weapons/BoatMissile/BoatMissile.mdl\", x3, y3)--Сзади 2\r\n\tend\r\n\tif cannon >= 5 then\r\n\t\tCreateAndForceBullet(hero, angle - 15 * inverse, 30, \"Abilities/Weapons/BoatMissile/BoatMissile.mdl\", x4, y4)--Сзади 3\r\n\tend\r\nend\r\n\r\nfunction CreateFire(hero, board)\r\n\tlocal data = HERO[GetPlayerId(GetOwningPlayer(hero))]\r\n\tlocal facing = GetUnitFacing(hero)\r\n\t--board=board+90\r\n\tlocal angle = facing + board\r\n\tlocal x = MoveX(GetUnitX(hero), 60, angle)\r\n\tlocal y = MoveY(GetUnitY(hero), 60, angle)\r\n\r\n\t--local fire=AddSpecialEffect(\"FireGun.mdl\",x,y)\r\n\tlocal fire = AddSpecialEffect(\"Flame Thrower.mdl\", x, y)\r\n\tlocal inverse = 1\r\n\tif board == 1 then\r\n\t\tinverse = -1\r\n\tend\r\n\tBlzSetSpecialEffectMatrixScale(fire, 1, 1, 1)\r\n\r\n\tTimerStart(CreateTimer(), TIMER_PERIOD, true, function()\r\n\t\t--local xf,yf,zf=BlzGetLocalSpecialEffectX(fire),BlzGetLocalSpecialEffectY(fire),BlzGetLocalSpecialEffectZ(fire)\r\n\t\tlocal xhero, yhero = GetUnitX(hero), GetUnitY(hero)\r\n\t\t--local nx,ny=MoveX(xhero,80,GetUnitFacing(hero)-board),MoveY(yhero,80,GetUnitFacing(hero)-board)\r\n\t\tlocal nx, ny = MoveXY(xhero, yhero, 10, GetUnitFacing(hero) - board)\r\n\t\tlocal z = GetUnitZ(hero)\r\n\t\tBlzSetSpecialEffectPosition(fire, nx, ny, z - 140 + 89)\r\n\t\tBlzPlaySpecialEffect(fire, ANIM_TYPE_BIRTH)\r\n\t\t--HeroUpdateWeaponCharges(hero,4,1)\r\n\r\n\t\t--print(\"z Огня=\"..BlzGetLocalSpecialEffectZ(fire))\r\n\r\n\t\tif board == 0 then\r\n\t\t\tBlzSetSpecialEffectYaw(fire, math.rad(GetUnitFacing(hero) + board - 5 - 90))\r\n\t\t\tUnitDamageLine(hero, 10, nx, ny, 80, 80 * 6, GetUnitFacing(hero) + board - 5 - 90, GetUnitZ(hero) + 50)\r\n\t\telse\r\n\t\t\tlocal problem = GetUnitFacing(hero) + board - 5 + 90\r\n\t\t\t--print(\"проблемный угол=\"..problem)\r\n\t\t\tBlzSetSpecialEffectYaw(fire, math.rad(problem))\r\n\t\t\tUnitDamageLine(hero, 10, nx, ny, 80, 80 * 6, GetUnitFacing(hero) + board - 5 + 90, GetUnitZ(hero) + 50)\r\n\t\tend\r\n\t\tif (data.ReleaseRMB == false and board == 0) then\r\n\t\t\t--print(\"отключен вручную\")\r\n\t\t\tDestroyEffect(fire)\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tBlzPlaySpecialEffect(fire, ANIM_TYPE_DEATH)\r\n\t\tend\r\n\t\tif (data.ReleaseLMB == false and board == 1) then\r\n\t\t\tDestroyEffect(fire)\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tBlzPlaySpecialEffect(fire, ANIM_TYPE_DEATH)\r\n\t\tend\r\n\t\tif Ammo[GetPlayerId(GetOwningPlayer(hero))].Count.Fire <= 0 then\r\n\t\t\t--print(\"закончились заряды\")\r\n\t\t\tDestroyEffect(fire)\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tBlzPlaySpecialEffect(fire, ANIM_TYPE_DEATH)\r\n\t\tend\r\n\t\tHeroUpdateWeaponCharges(hero, 4, 1)\r\n\tend)\r\nend\r\n\r\nfunction CreateBarrel(hero, angle, dist)\r\n\tlocal x, y = GetUnitXY(hero)\r\n\tlocal id = GetPlayerId(GetOwningPlayer(hero))\r\n\tlocal barrel = AddSpecialEffect(\"Barrel_Unit.mdl\", x, y)\r\n\tif angle == nil then\r\n\t\tangle = AngleBetweenXY(x, y, GetPlayerMouseX[id], GetPlayerMouseY[id]) / bj_DEGTORAD\r\n\tend\r\n\tif dist == nil then\r\n\t\tdist = DistanceBetweenXY(x, y, GetPlayerMouseX[id], GetPlayerMouseY[id])\r\n\tend\r\n\tif dist >= 200 then\r\n\t\tdist = 200\r\n\tend\r\n\tif dist <= 100 then\r\n\t\tdist = 100\r\n\tend\r\n\tBlzSetSpecialEffectYaw(barrel, math.rad(angle))\r\n\tBlzPlaySpecialEffect(barrel, ANIM_TYPE_WALK)\r\n\tBlzSetSpecialEffectZ(barrel, GetUnitZ(hero))\r\n\tJumpEffect(barrel, dist / 20, 150, angle, dist, hero, 1)\r\nend\r\n\r\nfunction CreateArtToss(hero, effectmodel, angle, dist, flag)\r\n\tlocal x, y = GetUnitXY(hero)\r\n\tlocal id = GetPlayerId(GetOwningPlayer(hero))\r\n\tlocal art = AddSpecialEffect(effectmodel, x, y)\r\n\tif angle == nil then\r\n\t\tangle = AngleBetweenXY(x, y, GetPlayerMouseX[id], GetPlayerMouseY[id]) / bj_DEGTORAD\r\n\tend\r\n\tif dist == nil then\r\n\t\tdist = DistanceBetweenXY(x, y, GetPlayerMouseX[id], GetPlayerMouseY[id])\r\n\tend\r\n\tif dist >= 1200 then\r\n\t\tdist = 1200\r\n\tend\r\n\tif dist <= 200 then\r\n\t\tdist = 200\r\n\tend\r\n\tlocal speed = dist / 50\r\n\tBlzSetSpecialEffectYaw(art, math.rad(angle))\r\n\t---BlzPlaySpecialEffect(barrel,ANIM_TYPE_WALK)\r\n\tif flag == nil then\r\n\t\tJumpEffect(art, speed, 700, angle, dist, hero, 2)\r\n\telseif flag == 3 then\r\n\t\t--Стрельба простых пушек\r\n\t\tJumpEffect(art, speed * 2, 200, angle, dist * .7, hero, flag, GetUnitZ(hero) + 150)--осколочный мелкий\r\n\telse\r\n\t\tJumpEffect(art, speed, 300, angle, dist, hero, flag)--любой другой\r\n\tend\r\nend\r\n\r\nfunction JumpEffect(eff, speed, maxHeight, angle, distance, hero, flag, ZStart)\r\n\tlocal i = 0\r\n\tif ZStart == nil then\r\n\t\tZStart = GetUnitZ(hero)\r\n\tend\r\n\tTimerStart(CreateTimer(), TIMER_PERIOD, true, function()\r\n\t\tlocal x, y = BlzGetLocalSpecialEffectX(eff), BlzGetLocalSpecialEffectY(eff)\r\n\t\tlocal nx, ny = MoveXY(x, y, speed, angle)\r\n\t\tlocal f = ParabolaZ(maxHeight, distance, i * speed) + ZStart\r\n\t\tlocal z = BlzGetLocalSpecialEffectZ(eff)\r\n\t\tlocal zGround = GetTerrainZ(nx, ny)\r\n\t\tBlzSetSpecialEffectPosition(eff, nx, ny, f)\r\n\t\ti = i + 1\r\n\t\tif i == 10 then\r\n\t\t\tif flag == 4 then\r\n\t\t\t\tEffectAddRegistrationCollision(eff, hero, 150, 0, 1)\r\n\t\t\tend\r\n\t\tend\r\n\r\n\t\tif z <= zGround and i > 5 then\r\n\t\t\tif flag == nil then\r\n\t\t\t\t-- без флага\r\n\r\n\t\t\tend\r\n\r\n\t\t\tif flag == 1 then\r\n\t\t\t\t-- бочка со взрывчаткой и таймером\r\n\t\t\t\tBlzPlaySpecialEffect(eff, ANIM_TYPE_STAND)\r\n\t\t\t\tif CreateTorrent(nx, ny) then\r\n\t\t\t\t\tWaveEffect(eff)\r\n\t\t\t\t\tEffectAddExplodedTimer(eff, 3, hero)\r\n\t\t\t\telse\r\n\t\t\t\t\t--BlzSetSpecialEffectZ(eff,z+30)\r\n\t\t\t\t\tExplodeEffect(eff, 3)\r\n\t\t\t\t\tUnitDamageArea(hero, 500, nx, ny, 250)\r\n\t\t\t\tend\r\n\t\t\telseif flag == 2 then\r\n\t\t\t\t-- навесной разделяющийся\r\n\t\t\t\tCreateTorrent(nx, ny)\r\n\t\t\t\tif ExplodeEffect(eff, 3) == false then\r\n\t\t\t\t\t-- взрыв не на воде\r\n\t\t\t\t\t--print(\"разделяемся\")\r\n\t\t\t\t\tfor i = 1, 7 do\r\n\t\t\t\t\t\tlocal cluster = AddSpecialEffect(\"Abilities/Spells/Other/Volcano/VolcanoMissile.mdl\", nx, ny)\r\n\t\t\t\t\t\tBlzSetSpecialEffectZ(cluster, z)\r\n\t\t\t\t\t\tBlzSetSpecialEffectScale(cluster, 0.4)\r\n\t\t\t\t\t\tJumpEffect(cluster, 10, GetRandomInt(50, 150), GetRandomInt(0, 359), GetRandomInt(50, 200), hero, 3)\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\t\tDestroyEffect(eff)\r\n\t\t\t\tUnitDamageArea(hero, 300, nx, ny, 150)\r\n\t\t\telseif flag == 3 then\r\n\t\t\t\t-- осколки\r\n\t\t\t\tCreateTorrent(nx, ny)\r\n\t\t\t\tDestroyEffect(eff)\r\n\t\t\t\tUnitDamageArea(hero, 100, nx, ny, 200, z)\r\n\t\t\telseif flag == 4 then\r\n\t\t\t\t-- выпрыгнул гоблин\r\n\t\t\t\tif CreateTorrent(nx, ny, 0.1) then\r\n\t\t\t\t\tBlzSetSpecialEffectZ(eff, -90)\r\n\r\n\t\t\t\telse\r\n\t\t\t\t\tDestroyEffect(eff)\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\tend\r\n\tend)\r\nend\r\n\r\nfunction EffectAddRegistrationCollision(eff, hero, range, duration, flag)\r\n\tlocal sec = duration\r\n\tlocal infinity = false\r\n\tif duration == nil or duration == 0 then\r\n\t\tinfinity = true\r\n\tend\r\n\tTimerStart(CreateTimer(), 0.1, true, function()\r\n\t\tlocal x, y, z = BlzGetLocalSpecialEffectX(eff), BlzGetLocalSpecialEffectY(eff), BlzGetLocalSpecialEffectZ(eff)\r\n\t\tlocal e = nil\r\n\t\tGroupEnumUnitsInRange(perebor, x, y, range, nil)\r\n\t\twhile true do\r\n\t\t\te = FirstOfGroup(perebor)\r\n\t\t\tif e == nil then\r\n\t\t\t\tbreak\r\n\t\t\tend\r\n\t\t\tif UnitAlive(e) and IsUnitZCollision(e, z) then\r\n\t\t\t\t--print(\"Эффет столкнулся с \"..GetUnitName(e))\r\n\t\t\t\tif flag == 1 then\r\n\t\t\t\t\t-- орк в уточке\r\n\t\t\t\t\tif IsUnitType(hero, UNIT_TYPE_HERO) then\r\n\t\t\t\t\t\tRemoveEffect(eff)\r\n\t\t\t\t\t\tPlaySoundAtPointBJ(gg_snd_Load, 100, Location(x, y), 0)\r\n\t\t\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t\t\t\tHealUnit(hero, 100)\r\n\t\t\t\t\t\t--print(\"Лечение подбор орка для\"..GetUnitName(hero))\r\n\t\t\t\t\tend\r\n\t\t\t\telseif flag == 2 then\r\n\t\t\t\t\t-- глубоководная мина\r\n\t\t\t\t\tif IsUnitEnemy(e, GetOwningPlayer(hero)) then\r\n\t\t\t\t\t\tUnitDamageArea(hero, 100, x, y, 200, z)\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\tGroupRemoveUnit(perebor, e)\r\n\t\tend\r\n\t\tsec = sec - 1\r\n\t\tif sec < 0 and infinity == false then\r\n\t\t\tDestroyEffect(eff)\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\tend\r\n\tend)\r\nend\r\n\r\nfunction CreateLightingCharges(hero)\r\n\tlocal data = HERO[GetPlayerId(GetOwningPlayer(hero))]\r\n\t--print(\"1\")\r\n\tTimerStart(CreateTimer(), 0.7, true, function()\r\n\t\tif data.ReleaseRMB then\r\n\t\t\tHeroUpdateWeaponCharges(hero, 7, -1)\r\n\t\t\tFindEnemyForLighting(hero, 500)\r\n\t\telse\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\tend\r\n\tend)\r\nend\r\n\r\nfunction FindEnemyForLighting(hero, range)\r\n\tlocal e = nil\r\n\tlocal x, y = GetUnitXY(hero)\r\n\r\n\tGroupEnumUnitsInRange(perebor, x, y, range, nil)\r\n\t--print(\"2\")\r\n\twhile true do\r\n\t\te = FirstOfGroup(perebor)\r\n\t\tif e == nil then\r\n\t\t\tbreak\r\n\t\tend\r\n\t\tif UnitAlive(e) and IsUnitEnemy(e, GetOwningPlayer(hero)) and IsUnitVisible(e, GetOwningPlayer(hero)) then\r\n\t\t\t--print(\"найден враг\")\r\n\t\t\tif HeroUpdateWeaponCharges(hero, 7, 1) then\r\n\t\t\t\tlocal dummy = CreateUnit(GetOwningPlayer(hero), DummyID, GetUnitX(hero), GetUnitY(hero), 0)\r\n\t\t\t\tSetUnitZ(dummy, GetUnitZ(hero) + 90)\r\n\t\t\t\tUnitAddAbility(dummy, FourCC('A00B'))-- молния\r\n\t\t\t\tUnitApplyTimedLife(dummy, DummyID, 1)\r\n\t\t\t\tif not Cast(dummy, 0, 0, e) then\r\n\t\t\t\t\tHeroUpdateWeaponCharges(hero, 7, -1)\r\n\t\t\t\tend\r\n\t\t\telse\r\n\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tend\r\n\t\tend\r\n\t\tGroupRemoveUnit(perebor, e)\r\n\tend\r\nend\r\n\r\nfunction SawActivated(hero)\r\n\tlocal data = HERO[GetPlayerId(GetOwningPlayer(hero))]\r\n\tlocal saw = AddSpecialEffect(SawDiskModel, GetUnitXY(hero))\r\n\tlocal id = UnitGetPid(hero)\r\n\tBlzSetSpecialEffectScale(saw, 0.7)\r\n\t--HeroUpdateWeaponCharges(hero,8,-1)\r\n\t--print(\"пила активирована\")\r\n\tlocal CurAngle = GetUnitFacing(hero)\r\n\tTimerStart(CreateTimer(), TIMER_PERIOD, true, function()\r\n\t\tlocal x, y = GetUnitXY(hero)\r\n\t\tlocal angle = AngleBetweenXY(x, y, GetPlayerMouseX[id], GetPlayerMouseY[id]) / bj_DEGTORAD\r\n\t\tif data.ReleaseRMB then\r\n\t\t\tCurAngle=lerpTheta(CurAngle,angle,TIMER_PERIOD*8) --та самая строчка\r\n\t\tend\r\n\t\tlocal nx, ny = MoveXY(x, y, 130, CurAngle)\r\n\r\n\t\tif UnitDamageArea(hero, 30, nx, ny, 150, GetUnitZ(hero) + 50, \"Abilities/Weapons/AncestralGuardianMissile/AncestralGuardianMissile.mdl\") then\r\n\r\n\t\tend\r\n\r\n\t\tBlzSetSpecialEffectPosition(saw, nx, ny, GetUnitZ(hero) + 20)\r\n\t\tif data.WeaponIndex ~= 8 then\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tDestroyEffect(saw)\r\n\t\tend\r\n\tend)\r\nend\r\n\r\n\r\n\r\nfunction repeatN(t, m)\r\n\treturn math.clamp(t - math.floor(t / m) * m, 0, m)\r\nend\r\n\r\n\r\nfunction lerpTheta(a, b, t)\r\n\tlocal dt = repeatN(b - a, 360)\r\n\tif dt>180 then\tdt=dt-360 end\r\n\treturn math.lerp(a, a + dt, t)\r\nend\r\n\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 08.02.2020 12:24\r\n\r\n\r\n\r\nfunction InitDamage()\r\n\tlocal DamageTrigger = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tTriggerRegisterPlayerUnitEvent(DamageTrigger, Player(i), EVENT_PLAYER_UNIT_DAMAGING) -- До вычета брони\r\n\t\tTriggerRegisterPlayerUnitEvent(DamageTrigger, Player(i), EVENT_PLAYER_UNIT_DAMAGED) -- После вычета брони\r\n\tend\r\n\tTriggerAddAction(DamageTrigger, function()\r\n\t\tlocal damage     = GetEventDamage() -- число урона\r\n\t\tlocal damageType = BlzGetEventDamageType()\r\n\t\tif damage < 1 then return end\r\n\r\n\t\tlocal eventId         = GetHandleId(GetTriggerEventId())\r\n\t\tlocal isEventDamaging = eventId == GetHandleId(EVENT_PLAYER_UNIT_DAMAGING)\r\n\t\tlocal isEventDamaged  = eventId == GetHandleId(EVENT_PLAYER_UNIT_DAMAGED)\r\n\r\n\t\tlocal target          = GetTriggerUnit() -- тот кто получил урон\r\n\t\tlocal targetHandleId  = GetHandleId(target)\r\n\t\tlocal caster          = GetEventDamageSource() -- тот кто нанёс урон\r\n\t\tlocal casterOwner     = GetOwningPlayer(caster)\r\n\r\n\t\tif isEventDamaged then\r\n\t\t\tif GetUnitTypeId(target)==DummyID  then--попадание в даммика эффект ракеты\r\n\t\t\t\tlocal x,y=GetUnitX(target),GetUnitY(target)\r\n\t\t\t\tShowUnit(target, false)\r\n\t\t\t\tCreateTorrent(x,y)\r\n\t\t\t\tUnitDamageArea(target,0,GetUnitX(target),GetUnitY(target),150)\r\n\t\t\tend\r\n\t\t\tif damage>=200 then\r\n\t\t\t\tlocal angle=GetRandomReal(0,360)\r\n\t\t\t\tlocal dist=200\r\n\t\t\t\tCreateArtToss(target,\"GoblinRubberDuck.mdl\",angle,dist,4)\r\n\t\t\t\tlocal r=GetRandomInt(1,2)\r\n\t\t\t\tif r==1 then\r\n\t\t\t\t\tPlaySoundAtPointBJ( gg_snd_AAA, 100, Location(GetUnitX(target),GetUnitY(target)), 0 )\r\n\t\t\t\telse\r\n\t\t\t\t\tPlaySoundAtPointBJ( gg_snd_AAA1, 100, Location(GetUnitX(target),GetUnitY(target)), 0 )\r\n\t\t\t\tend\r\n\t\t\t\t--JumpEffect\r\n\t\t\tend\r\n\t\tend\r\n\tend)\r\nend\r\n\r\n\r\n\r\n\r\nperebor=CreateGroup()\r\nfunction UnitDamageArea(u,damage,x,y,range,ZDamageSource,EffectModel)\r\n\tlocal OnlyCHK=false\r\n\tlocal isdamage=false\r\n\tlocal e=nil\r\n\tif ZDamageSource==nil then ZDamageSource=GetUnitZ(u)+60 end\r\n\t--print(\"Поиск целей в на высоте \"..ZDamageSource)\r\n\tGroupEnumUnitsInRange(perebor,x,y,range,nil)\r\n\twhile true do\r\n\t\te = FirstOfGroup(perebor)\r\n\t\tif e == nil then break end\r\n\t\tif UnitAlive(e) and IsUnitEnemy(e,GetOwningPlayer(u))  and IsUnitZCollision(e,ZDamageSource) then\r\n\t\t\tUnitDamageTarget( u, e, damage, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_NORMAL, WEAPON_TYPE_WHOKNOWS )\r\n\t\t\tisdamage=true\r\n\t\t\tif EffectModel~=nil then\r\n\t\t\t\t--print(\"эффеет\")\r\n\t\t\t\tlocal DE=AddSpecialEffect(EffectModel,GetUnitX(e),GetUnitY(e))\r\n\t\t\t\tBlzSetSpecialEffectZ(DE,ZDamageSource)\r\n\t\t\t\tDestroyEffect(DE)\r\n\t\t\tend\r\n\t\tend\r\n\t\tGroupRemoveUnit(perebor,e)\r\n\tend\r\n\tif PointContentDestructable(x,y,range,true,1+damage/10) then\tisdamage=true\tend\r\n\treturn isdamage\r\nend\r\n\r\nfunction IsUnitZCollision(hero,ZDamageSource)\r\n\tlocal zcollision=false\r\n\tlocal z=GetUnitZ(hero)\r\n\r\n\tif  ZDamageSource+60>=z and ZDamageSource-60<=z then\r\n\t\tzcollision=true\r\n\telse\r\n\t\t--print(\"Высота снаряда=\"..ZDamageSource..\"Высота юнита=\"..z)\r\n\tend\r\n\treturn zcollision\r\nend\r\n\r\n\r\nfunction UnitDamageLine(u,damage,x,y,range,distance,angle,z)\r\n\tlocal isdamage=false\r\n\tlocal nx,ny\r\n\tfor i=0,distance/range do\r\n\t\tnx=MoveX(x,i*range,angle)\r\n\t\tny=MoveY(y,i*range,angle)\r\n\t\tUnitDamageArea(u,damage,nx,ny,range,z)\r\n\tend\r\n\treturn isdamage\r\nend\r\n\r\nfunction UnitRocketArea(hero,x,y,range)\r\n\tlocal find=false\r\n\tlocal e--временный юнит\r\n\tlocal targ=nil\r\n\t--print(\"стреляем\")\r\n\tGroupEnumUnitsInRange(perebor,x,y,range,nil)\r\n\twhile true do\r\n\t\te = FirstOfGroup(perebor)\r\n\t\tif e == nil or find==true then break end\r\n\t\tif UnitAlive(e) and IsUnitEnemy(e,GetOwningPlayer(hero)) then\r\n\t\t\ttarg=e\r\n\t\tend\r\n\t\tGroupRemoveUnit(perebor,e)\r\n\tend\r\n\tlocal dummy=CreateUnit(GetOwningPlayer(hero), DummyID, GetUnitX(hero), GetUnitY(hero), 0)\r\n\tSetUnitZ(dummy,GetUnitZ(hero))\r\n\tUnitAddAbility(dummy,FourCC('A003'))\r\n\tUnitApplyTimedLife(dummy,DummyID,1)\r\n\tif targ~=nil then\r\n\t\t--print(\"цель определена- \"..GetUnitName(targ))\r\n\t\tCast(dummy,0,0,targ)\r\n\telse\r\n\t\ttarg=CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), DummyID, x, y, 0)\r\n\r\n\t\tUnitRemoveAbility(targ,FourCC('Aloc'))\r\n\t\tif Cast(dummy,0,0,targ)==false then\r\n\t\t\t--print(\"выстрел в пустоту\")\r\n\t\t\tHeroUpdateWeaponCharges(hero,3,-1)\r\n\t\tend\r\n\t\tUnitApplyTimedLife(targ,DummyID,3)\r\n\t\t--print(\"Нет врагов, летим в воду\")\r\n\tend\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 16.01.2020 23:40\r\n---\r\nGetPlayerMouseX={}\r\nGetPlayerMouseY={}\r\nfunction InitMouseMoveTrigger()\r\n\tlocal MouseMoveTrigger = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tif GetPlayerSlotState(player) == PLAYER_SLOT_STATE_PLAYING and GetPlayerController(player) == MAP_CONTROL_USER then\r\n\t\t\tTriggerRegisterPlayerEvent(MouseMoveTrigger, player, EVENT_PLAYER_MOUSE_MOVE)\r\n\t\tend\r\n\tend\r\n\t\tTriggerAddAction(MouseMoveTrigger, function()\r\n\t\t\t--print(\"ismove\")\r\n\t\t\tlocal id=GetPlayerId(GetTriggerPlayer())\r\n\t\t\tGetPlayerMouseX[id]=BlzGetTriggerPlayerMouseX()\r\n\t\t\tGetPlayerMouseY[id]=BlzGetTriggerPlayerMouseY()\r\n\t\tend)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 10.01.2020 22:05\r\n--\r\n---Глобалки\r\nTIMER_PERIOD = 0.03125\r\nHERO={}\r\nAmmo={}\r\ndo\r\n\tlocal InitGlobalsOrigin = InitGlobals -- записываем InitGlobals в переменную\r\n\tfunction InitGlobals()\r\n\t\t\tInitGlobalsOrigin() -- вызываем оригинальную InitGlobals из переменной\r\n\t\t\tTimerStart(CreateTimer(), 0.1, false, function()\r\n\t\t\tInitGameCore()\r\n\t\t\thideEverything()\r\n\t\t\tInitMouseMoveTrigger()\r\n\t\t\tInitDamage()\r\n\t\t\tInitUnitDeath()\r\n\t\t\tInitZone0()\r\n\t\t\tRegisterAnyCheckpointSave()\r\n\t\t\tStartMainTheme()\r\n\t\tend)\r\n\tend\r\nend\r\n\r\nfunction InitGameCore()\r\n\t--создаём героев\r\n\t--BlzEnableSelections(false,false)\r\n\tEnableDragSelect(false,false)\r\n\t--EnablePreSelect(false,false)--выделение\r\n\tfor i=0,0 do -- Для 1 игрока\r\n\t\tHERO[i]={\r\n\t\t\tReleaseW=false,\r\n\t\t\tReleaseS=false,\r\n\t\t\tReleaseA=false,\r\n\t\t\tReleaseD=false,\r\n\t\t\tAcceleration=0,\r\n\t\t\tReleaseSpace=false,\r\n\t\t\tReleaseLMB=false,\r\n\t\t\tReleaseRMB=false,\r\n\t\t\tSpeedBase=14,\r\n\t\t\tUnitHero=CreateUnit(Player(0), FourCC('H000'), GetPlayerStartLocationX(Player(0)), GetPlayerStartLocationY(Player(0)), 0),\r\n\t\t\tCurrentSpeed=0,\r\n\t\t\tWeaponIndex=1,\r\n\t\t\tAngleForce=0, --типа какой-то уго для отталкивания\r\n\t\t\tIsDisabled=false,\r\n\t\t\tOnTorrent=false,\r\n\t\t\tAlive=true,\r\n\t\t\tIsAttackReadyR={true,true,true,true,true,true,true,true,true}, --9\r\n\t\t\tIsAttackReadyL={true,true,true,true,true,true,true,true,true},\r\n\t\t\tAttackCD=0.5,\r\n\t\t\tAttackCDWeapon={0.5,\r\n\t\t\t          1,\r\n\t\t\t          2,\r\n\t\t\t          3,\r\n\t\t\t          4,\r\n\t\t\t          5,\r\n\t\t\t          6,\r\n\t\t\t          2,\r\n\t\t\t          1,\r\n\t\t\t},\r\n\t\t\tXPos=0,\r\n\t\t\tYPos=0,\r\n\t\t\tpid=i,\r\n\t\t\tOnWater=false,\r\n\t\t\tForcesCount=0,\r\n\t\t\tForceRemain={},\r\n\t\t\tForceAngle={},\r\n\t\t\tForceSpeed={},\r\n\t\t\tIsForce={},\r\n\t\t\tChkPointID=0,\r\n\t\t\tSelfFrame={}, -- массив фреймов Оружия\r\n\t\t\t--Camera=CreateUnit(Player(0), FourCC('e001'), GetPlayerStartLocationX(Player(0)), GetPlayerStartLocationY(Player(0)), 0)\r\n\t\t}\r\n\tend\r\n\tAmmo[0]={\r\n\t\tAvailable ={\r\n\t\t\tSingle=true,\r\n\t\t\tBoard=true,\r\n\t\t\tRocket=false,\r\n\t\t\tFire=true,\r\n\t\t\tToss=true,\r\n\t\t\tBarrel=true,\r\n\t\t\tLight=true,\r\n\t\t\tSaw=true,\r\n\t\t\tOil=false\r\n\t\t},\r\n\t\tCount={\r\n\t\t\tSingle=500,\r\n\t\t\tBoard=500,\r\n\t\t\tRocket=500,\r\n\t\t\tFire=500,\r\n\t\t\tToss=500,\r\n\t\t\tBarrel=500,\r\n\t\t\tLight=500,\r\n\t\t\tSaw=500,\r\n\t\t\tOil=0\r\n\t\t}\r\n\t}\r\n\tBlzLoadTOCFile(\"Main.toc\")\r\n\tBlzLoadTOCFile(\"MySimpleButton.toc\")\r\n\tBlzLoadTOCFile(\"BoxedText.toc\")\r\n\tlocal HealthPlayer1 = HealthBarAdd(HERO[0].UnitHero)\r\n\tBlzFrameSetAbsPoint(HealthPlayer1, FRAMEPOINT_LEFT, 0.04, 0.58)\r\n\tSelectUnitForPlayerSingle(HERO[0].UnitHero,GetOwningPlayer(HERO[0].UnitHero))\r\n\tRegisterAllAmmoBoxes(HERO[0].UnitHero)\r\n\t--CreateWeaponFrame()\r\n\t--CreateWeaponFrame()\r\n\t--CreateWeaponFrameGlue()\r\n\t--return\r\n\t--CreateWeaponFrameGlue2()\r\n\tfor i=1,9 do\r\n\t\tHeroUpdateWeaponCharges(HERO[0].UnitHero,i,0)\r\n\tend\r\n\r\n\r\n--триггеры\r\n\t-----------------------------------------------------------------OSKEY_1\r\n\tlocal TrigWeaponSwitch1 = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigWeaponSwitch1,Player(i),OSKEY_1,0,true)\r\n\tend\r\n\tTriggerAddAction(TrigWeaponSwitch1, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tif Ammo[pid].Available.Single then\r\n\t\t\tdata.WeaponIndex=1\r\n\t\t\tSwitchWeaponVisual(pid,data.WeaponIndex)\r\n\t\tend\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_2\r\n\tlocal TrigWeaponSwitch2 = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigWeaponSwitch2,Player(i),OSKEY_2,0,true)\r\n\tend\r\n\tTriggerAddAction(TrigWeaponSwitch2, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tif Ammo[pid].Available.Board then\r\n\t\t\tdata.WeaponIndex=2\r\n\t\t\tSwitchWeaponVisual(pid,data.WeaponIndex)\r\n\t\tend\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_3\r\n\tlocal TrigWeaponSwitch3 = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigWeaponSwitch3,Player(i),OSKEY_3,0,true)\r\n\tend\r\n\tTriggerAddAction(TrigWeaponSwitch3, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tif Ammo[pid].Available.Rocket then\r\n\t\t\tdata.WeaponIndex=3\r\n\t\t\tSwitchWeaponVisual(pid,data.WeaponIndex)\r\n\t\tend\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_4\r\n\tlocal TrigWeaponSwitch4 = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigWeaponSwitch4,Player(i),OSKEY_4,0,true)\r\n\tend\r\n\tTriggerAddAction(TrigWeaponSwitch4, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tif Ammo[pid].Available.Fire then\r\n\t\t\tdata.WeaponIndex=4\r\n\t\t\tSwitchWeaponVisual(pid,data.WeaponIndex)\r\n\t\tend\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_5\r\n\tlocal TrigWeaponSwitch5 = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigWeaponSwitch5,Player(i),OSKEY_5,0,true)\r\n\tend\r\n\tTriggerAddAction(TrigWeaponSwitch5, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tif Ammo[pid].Available.Toss then\r\n\t\t\tdata.WeaponIndex=5\r\n\t\t\tSwitchWeaponVisual(pid,data.WeaponIndex)\r\n\t\tend\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_6\r\n\tlocal TrigWeaponSwitch6 = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigWeaponSwitch6,Player(i),OSKEY_6,0,true)\r\n\tend\r\n\tTriggerAddAction(TrigWeaponSwitch6, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tif Ammo[pid].Available.Barrel then\r\n\t\t\tdata.WeaponIndex=6\r\n\t\t\tSwitchWeaponVisual(pid,data.WeaponIndex)\r\n\t\tend\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_7\r\n\tlocal TrigWeaponSwitch7 = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigWeaponSwitch7,Player(i),OSKEY_7,0,true)\r\n\tend\r\n\tTriggerAddAction(TrigWeaponSwitch7, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tif Ammo[pid].Available.Light then\r\n\t\t\tdata.WeaponIndex=7\r\n\t\t\tSwitchWeaponVisual(pid,data.WeaponIndex)\r\n\t\tend\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_8\r\n\tlocal TrigWeaponSwitch8 = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigWeaponSwitch8,Player(i),OSKEY_8,0,true)\r\n\tend\r\n\tTriggerAddAction(TrigWeaponSwitch8, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tif Ammo[pid].Available.Saw and  data.WeaponIndex~=8 then\r\n\t\t\tdata.WeaponIndex=8\r\n\t\t\tSwitchWeaponVisual(pid,data.WeaponIndex)\r\n\t\t\tSawActivated(data.UnitHero)\r\n\t\tend\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_9\r\n\tlocal TrigWeaponSwitch9 = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigWeaponSwitch9,Player(i),OSKEY_9,0,true)\r\n\tend\r\n\tTriggerAddAction(TrigWeaponSwitch9, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tif Ammo[pid].Available.Oil then\r\n\t\t\tdata.WeaponIndex=9\r\n\t\t\tSwitchWeaponVisual(pid,data.WeaponIndex)\r\n\t\tend\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_W\r\n\tlocal gg_trg_EventUpW = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(gg_trg_EventUpW,Player(i),OSKEY_W,0,true)\r\n\tend\r\n\tTriggerAddAction(gg_trg_EventUpW, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tdata.ReleaseW=true\r\n\tend)\r\n\tlocal TrigDepressW = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigDepressW,Player(i),OSKEY_W,0,false)\r\n\tend\r\n\tTriggerAddAction(TrigDepressW, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tdata.ReleaseW=false\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_S\r\n\tlocal gg_trg_EventUpS = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(gg_trg_EventUpS,Player(i),OSKEY_S,0,true)\r\n\tend\r\n\tTriggerAddAction(gg_trg_EventUpS, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tdata.ReleaseS=true\r\n\tend)\r\n\tlocal TrigDepressS = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigDepressS,Player(i),OSKEY_S,0,false)\r\n\tend\r\n\tTriggerAddAction(TrigDepressS, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tdata.ReleaseS=false\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_D\r\n\tlocal TrigPressD = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigPressD,Player(i),OSKEY_D,0,true)\r\n\tend\r\n\tTriggerAddAction(TrigPressD, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\t--BlzStartUnitAbilityCooldown(data.UnitHero,FourCC('A002'),5)\r\n\t\tif not data.ReleaseD then\r\n\t\t\tBlzSetUnitFacingEx(data.UnitHero,GetUnitFacing(data.UnitHero)-5)\r\n\t\t\tdata.ReleaseD=true\r\n\t\tend\r\n\tend)\r\n\tlocal TrigDePressD = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigDePressD,Player(i),OSKEY_D,0,false)\r\n\tend\r\n\tTriggerAddAction(TrigDePressD, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tdata.ReleaseD=false\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_A\r\n\tlocal TrigPressA = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigPressA,Player(i),OSKEY_A,0,true)\r\n\tend\r\n\tTriggerAddAction(TrigPressA, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tif not data.ReleaseA then\r\n\t\t\tdata.ReleaseA=true\r\n\t\t\tBlzSetUnitFacingEx(data.UnitHero,GetUnitFacing(data.UnitHero)+5)\r\n\t\tend\r\n\tend)\r\n\tlocal TrigDePressA = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigDePressA,Player(i),OSKEY_A,0,false)\r\n\tend\r\n\tTriggerAddAction(TrigDePressA, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tdata.ReleaseA=false\r\n\tend)\r\n\t-----------------------------------------------------------------OSKEY_Space\r\n\tlocal gg_trg_EventUpSpace = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(gg_trg_EventUpSpace,Player(i),OSKEY_SPACE,0,true)\r\n\tend\r\n\tTriggerAddAction(gg_trg_EventUpSpace, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tBlzFrameSetVisible(MiniMap[data.pid], true)\r\n\t\tdata.ReleaseSpace=true\r\n\tend)\r\n\tlocal TrigDepressSpace = CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tBlzTriggerRegisterPlayerKeyEvent(TrigDepressSpace,Player(i),OSKEY_SPACE,0,false)\r\n\tend\r\n\tTriggerAddAction(TrigDepressSpace, function()\r\n\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\tlocal data=HERO[pid]\r\n\t\tdata.ReleaseSpace=false\r\n\tend)\r\n\t-----------------------------------------------------------------LMB\r\n\tlocal TrigPressLMB=CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tTriggerRegisterPlayerEvent(TrigPressLMB, Player(i), EVENT_PLAYER_MOUSE_DOWN)\r\n\tend\r\n\tTriggerAddAction(TrigPressLMB, function()\r\n\t\t--print(\"any\")\r\n\t\tif BlzGetTriggerPlayerMouseButton() == MOUSE_BUTTON_TYPE_LEFT then\r\n\t\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\t\tlocal data=HERO[pid]\r\n\t\t\tdata.ReleaseLMB=true\r\n\t\t\tlocal hero=data.UnitHero\r\n\t\t\tif \tdata.Alive and data.IsAttackReadyL[data.WeaponIndex] then\r\n\t\t\t\tdata.IsAttackReadyL[data.WeaponIndex]=false\r\n\r\n\t\t\t\tif data.WeaponIndex==2 and HeroUpdateWeaponCharges(hero,data.WeaponIndex,4) then\r\n\t\t\t\t\tBoardCannon(hero,90,GetRandomInt(5,5))\r\n\t\t\t\t\tdata.AttackCD=data.AttackCDWeapon[data.WeaponIndex]\r\n\t\t\t\t\tStarFrameCooldown(data.SelfFrame[data.WeaponIndex],data.AttackCD,data.WeaponIndex)\r\n\t\t\t\tend\r\n\t\t\t\tif data.WeaponIndex==4 and HeroUpdateWeaponCharges(hero,data.WeaponIndex,1) then\r\n\t\t\t\t\tCreateFire(hero,1)\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\tend\r\n\tend)\r\n\tlocal TrigDePressLMB=CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tTriggerRegisterPlayerEvent(TrigDePressLMB, Player(i), EVENT_PLAYER_MOUSE_UP)\r\n\tend\r\n\r\n\tTriggerAddAction(TrigDePressLMB, function()\r\n\t\t--print(\"any\")\r\n\t\tif BlzGetTriggerPlayerMouseButton() == MOUSE_BUTTON_TYPE_LEFT then\r\n\t\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\t\tlocal data=HERO[pid]\r\n\t\t\tdata.ReleaseLMB=false\r\n\t\tend\r\n\tend)\r\n\t-----------------------------------------------------------------RMB\r\n\tlocal TrigPressRMB=CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tTriggerRegisterPlayerEvent(TrigPressRMB, Player(i), EVENT_PLAYER_MOUSE_DOWN)\r\n\tend\r\n\tTriggerAddAction(TrigPressRMB, function()\r\n\t\t--print(\"any\")\r\n\t\tif BlzGetTriggerPlayerMouseButton() == MOUSE_BUTTON_TYPE_RIGHT then\r\n\t\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\t\tlocal data=HERO[pid]\r\n\t\t\tdata.ReleaseRMB=true\r\n\t\t\tlocal hero=data.UnitHero\r\n\t\t\tif \tdata.Alive and data.IsAttackReadyR[data.WeaponIndex]  then\r\n\t\t\t\tdata.IsAttackReadyR[data.WeaponIndex]=false\r\n\t\t\t\tdata.AttackCD=data.AttackCDWeapon[data.WeaponIndex]\r\n\t\t\t\tStarFrameCooldown(data.SelfFrame[data.WeaponIndex],data.AttackCD,data.WeaponIndex)\r\n\r\n\t\t\t\tif data.WeaponIndex==1 and HeroUpdateWeaponCharges(hero,data.WeaponIndex,1) then\r\n\t\t\t\t\tSingleCannon(hero)\r\n\t\t\t\t\t--print(\"перезарядка стрельбы?\")\r\n\t\t\t\t\t--StarFrameCooldown(data.SelfFrame[data.WeaponIndex],data.AttackCD)\r\n\t\t\t\tend\r\n\t\t\t\tif data.WeaponIndex==2 and HeroUpdateWeaponCharges(hero,data.WeaponIndex,4) then\r\n\t\t\t\t\tBoardCannon(hero,-90,GetRandomInt(5,5))\r\n\t\t\t\tend\r\n\t\t\t\tif data.WeaponIndex==3 and HeroUpdateWeaponCharges(hero,data.WeaponIndex,1) then\r\n\t\t\t\t\tUnitRocketArea(hero,GetPlayerMouseX[pid],GetPlayerMouseY[pid],200)\r\n\t\t\t\tend\r\n\t\t\t\tif data.WeaponIndex==4 and HeroUpdateWeaponCharges(hero,data.WeaponIndex,1) then\r\n\t\t\t\t\tCreateFire(hero,0)\r\n\t\t\t\tend\r\n\t\t\t\tif data.WeaponIndex==5 and HeroUpdateWeaponCharges(hero,data.WeaponIndex,1) then\r\n\t\t\t\t\tCreateArtToss(hero,\"Abilities/Spells/Other/Volcano/VolcanoMissile.mdl\")\r\n\t\t\t\tend\r\n\t\t\t\tif data.WeaponIndex==6 and HeroUpdateWeaponCharges(hero,data.WeaponIndex,1) then\r\n\t\t\t\t\tCreateBarrel(hero)\r\n\t\t\t\t\t--StarFrameCooldown(data.SelfFrame[data.WeaponIndex],5)\r\n\t\t\t\tend\r\n\t\t\t\tif data.WeaponIndex==7 and HeroUpdateWeaponCharges(hero,data.WeaponIndex,1) then\r\n\t\t\t\t\tCreateLightingCharges(hero)\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\tend\r\n\tend)\r\n\tlocal TrigDePressRMB=CreateTrigger()\r\n\tfor i = 0, bj_MAX_PLAYER_SLOTS - 1 do\r\n\t\tlocal player = Player(i)\r\n\t\tTriggerRegisterPlayerEvent(TrigDePressRMB, Player(i), EVENT_PLAYER_MOUSE_UP)\r\n\tend\r\n\tTriggerAddAction(TrigDePressRMB, function()\r\n\t\t--print(\"any\")\r\n\t\tif BlzGetTriggerPlayerMouseButton() == MOUSE_BUTTON_TYPE_RIGHT then\r\n\t\t\tlocal pid=GetPlayerId(GetTriggerPlayer())\r\n\t\t\tlocal data=HERO[pid]\r\n\t\t\tdata.ReleaseRMB=false\r\n\t\tend\r\n\tend)\r\n\r\n\t-----------------------------------------------------------------Lock\r\n\tTimerStart(CreateTimer(), 0.01, true, function()\r\n\t\tlocal data=HERO[0]\r\n\t\tlocal hero=data.UnitHero\r\n\t\tForceUIKeyBJ(GetOwningPlayer(hero),\"M\")\r\n\t\t--IssueImmediateOrder(hero,\"stop\")\r\n\tend)\r\n\tlocal acdr=0\r\n\tlocal acdl=0\r\n\tTimerStart(CreateTimer(), TIMER_PERIOD, true, function()-- глобальный таймер\r\n\t\tfor _, data in pairs(HERO) do\r\n\t\t\tlocal hero= data.UnitHero\r\n\t\t\tlocal p=GetOwningPlayer(hero)\r\n\t\t\tlocal turnrate=0\r\n\t\t\tlocal Vector3 = wGeometry.Vector3\r\n\t\t\tSetCameraQuickPosition(GetUnitX(hero),GetUnitY(hero))\r\n\t\t\tSetCameraTargetControllerNoZForPlayer(p,hero, 10,10,true) -- не дергается\r\n\r\n\t\t\t--[[if data.IsAttackReadyR==false then\r\n\t\t\t\tacdr=acdr+TIMER_PERIOD\r\n\t\t\t\tif acdr>=data.AttackCD then\r\n\t\t\t\t\tdata.IsAttackReadyR=true\r\n\t\t\t\t\tacdr=0\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\tif data.IsAttackReadyL==false then\r\n\t\t\t\tacdl=acdl+TIMER_PERIOD\r\n\t\t\t\tif acdl>=data.AttackCD then\r\n\t\t\t\t\tdata.IsAttackReadyL=true\r\n\t\t\t\t\tacdl=0\r\n\t\t\t\tend\r\n\t\t\tend]]\r\n\r\n\t\t\tif data.ReleaseSpace then\r\n\t\t\t\t---print(\"показываем миникарту\")\r\n\t\t\t\tBlzFrameSetVisible(MiniMap[data.pid], true)\r\n\t\t\telse\r\n\t\t\t\tBlzFrameSetVisible(MiniMap[data.pid], false)\r\n\t\t\tend\r\n\r\n\t\t\tUnitCheckPathingInRound(hero,60)--Фунция выталкивания --временно отрубил\r\n\r\n\t\t\tif data.ReleaseLMB then\r\n\r\n\t\t\tend\r\n\t\t\t----------------------------------------------------W\r\n\t\t\tif UnitAlive(hero) then\r\n\t\t\t\tif data.ReleaseW then\r\n\t\t\t\t\tif data.Acceleration<=data.SpeedBase then\r\n\t\t\t\t\t\tdata.Acceleration=data.Acceleration+1\r\n\t\t\t\t\tend\r\n\t\t\t\telse\r\n\t\t\t\t\tif data.Acceleration>0 then\r\n\t\t\t\t\t\tdata.Acceleration=data.Acceleration-1\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\t----------------------------------------------------S\r\n\t\t\tif data.ReleaseS then\r\n\t\t\tend\r\n\r\n\t\t\tif data.ReleaseD and data.OnTorrent==false  then\r\n\t\t\t\tturnrate=data.Acceleration<=5 and 5 or (5-data.Acceleration/3)+3\r\n\t\t\t\tBlzSetUnitFacingEx(hero,GetUnitFacing(hero)-turnrate)\r\n\t\t\tend\r\n\t\t\tif data.ReleaseA and data.OnTorrent==false then\r\n\t\t\t\tturnrate=data.Acceleration<=5 and 5 or (5-data.Acceleration/3)+3\r\n\t\t\t\tBlzSetUnitFacingEx(hero,GetUnitFacing(hero)+turnrate)\r\n\t\t\tend\r\n\r\n\t\t\tdata.CurrentSpeed=data.Acceleration\r\n\r\n\t\t\t--if data.CurrentSpeed>0 and data.Alive and data.OnTorrent==false then--\r\n\t\t\t--print(\"текущая скорость = \"..data.CurrentSpeed)\r\n\t\t\t--[[local x,y=GetUnitX(hero),GetUnitY(hero)\r\n\t\t\tlocal angle=GetUnitFacing(hero)\r\n\t\t\tdata.AngleForce=angle\r\n\t\t\tlocal zhero=GetUnitZ(hero) --GetTerrainZ(x,y)\r\n\t\t\tlocal newX3,newY3=MoveX(x,180,angle),MoveY(y,180,angle)\r\n\t\t\tlocal newX2,newY2=MoveX(x,60,angle),MoveY(y,60,angle)\r\n\t\t\tlocal z3=GetTerrainZ(newX3,newY3)\r\n\t\t\tlocal z2=GetTerrainZ(newX2,newY2)\r\n\t\t\tlocal Perepad=zhero-z2\r\n\t\t\tlocal newX,newY=MoveX(x,data.CurrentSpeed,angle),MoveY(y,data.CurrentSpeed,angle)\r\n\r\n\t\t\tif Perepad<1  then\r\n\t\t\t\tSetUnitPositionSmooth(hero,newX,newY)\r\n\t\t\telse\r\n\t\t\t\tif Perepad>110 then\r\n\t\t\t\t\tSetUnitX(hero,newX)\r\n\t\t\t\t\tSetUnitY(hero,newY)\r\n\t\t\t\telse\r\n\t\t\t\t\tSetUnitPositionSmooth(hero,newX,newY)\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\t]]\r\n\t\t\t------\r\n\t\t\tlocal k=data.ForcesCount\r\n\t\t\tlocal WASDMoving = Vector3:copyFromUnit(hero)\r\n\t\t\tlocal angle=GetUnitFacing(hero)\r\n\t\t\tlocal newPos=WASDMoving\r\n\t\t\tif data.CurrentSpeed>0 and data.Alive and not data.OnTorrent and not data.IsDisabled then--движение при нажатиии кнопок\r\n\r\n\t\t\t\tnewPos=WASDMoving+WASDMoving:yawPitchOffset( data.CurrentSpeed, angle * ( math.pi / 180 ), 0.0 )\r\n\t\t\telse\r\n\r\n\t\t\tend\r\n\r\n\r\n\t\t\tif RectContainsCoords(gg_rct_WaterTreem,GetUnitXY(hero)) then\r\n\t\t\t\tnewPos=newPos+Vector3:new(10, 0, 0)\r\n\t\t\t\t--print(\"поток\")\r\n\t\t\tend\r\n\t\t\tlocal f=0\r\n\t\t\tfor i=1,k do\r\n\t\t\t\tif data.ForceRemain[i]>0 then\r\n\t\t\t\t\t--print(\"Внешняя сила=\"..data.ForceRemain[i])\r\n\t\t\t\t\tf=f+1\r\n\t\t\t\t\tnewPos=newPos+newPos:yawPitchOffset( data.ForceSpeed[i], data.ForceAngle[i] * ( math.pi / 180 ), 0.0 )\r\n\t\t\t\t\t--newPos=Vector3:copyFromUnit(hero)+Vector3:new(data.ForceSpeed[i], data.ForceAngle[i] * ( math.pi / 180 ), 0)\r\n\t\t\t\t\tdata.ForceRemain[i]=data.ForceRemain[i]-data.ForceSpeed[i]\r\n\t\t\t\telse\r\n\t\t\t\t\tif data.IsForce[i] then\r\n\t\t\t\t\t\tdata.IsForce[i]=false\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\tif f==0 then\r\n\t\t\t\tdata.ForcesCount=0\r\n\t\t\t\tdata.IsDisabled=false\r\n\t\t\t\tSetUnitPathing(hero,true)\r\n\t\t\t\t--print(\"нет больше сил\")\r\n\t\t\tend\r\n\r\n\r\n\t\t\t--print(\"1\")\r\n\t\t\t--local tempZ=PerepadZ(hero) --вырван угол data.ForceAngle[i] * ( math.pi / 180 )\r\n\t\t\t--data.AngleForce=angle\r\n\t\t\t--local NexX,NexY=\r\n\t\t\tlocal NexZ=0\r\n\t\t\tif data.ForcesCount==0 then\r\n\t\t\t\tNexZ=GetTerrainZ(MoveXY(GetUnitX(hero),GetUnitY(hero),200,GetUnitFacing(hero)))\r\n\t\t\telse\r\n\t\t\t\tNexZ=GetTerrainZ(MoveXY(GetUnitX(hero),GetUnitY(hero),200,data.AngleForce))\r\n\t\t\tend\r\n\t\t--print(\"Z=\"..NexZ)\r\n\t\tif NexZ<=50 then\r\n\t\tSetUnitPositionSmooth(hero,newPos.x,newPos.y)\r\n\t\telse\r\n\t\t\t--print(\"Высоко не перелететь\")\r\n\t\tend\r\n\t\t\tdata.XPos=GetUnitX(hero)\r\n\t\t\tdata.YPos=GetUnitY(hero)\r\n\r\n\t\tend\r\n\tend)\r\nend\r\n\r\nfunction PerepadZ(hero)\r\n\t--print(\"2\")\r\n\tlocal perepad=0\r\n\tlocal zhero=GetUnitZ(hero)\r\n\tlocal z2=GetTerrainZ(GetUnitXY(hero))\r\n\tperepad=zhero-z2\r\n\treturn math.abs(perepad)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 09.02.2020 13:24\r\n\r\nfunction UnitCheckPathingInRound(hero,range)\r\n\tlocal data=HERO[GetPlayerId(GetOwningPlayer(hero))]\r\n\tlocal x,y=GetUnitX(hero),GetUnitY(hero)\r\n\tlocal nx,ny=nil,nil\r\n\tlocal a=10\r\n\tlocal z=nil\r\n\tlocal k=0\r\n\tlocal total=0\r\n\tlocal med=0\r\n\tlocal min=350\r\n\tlocal max=0\r\n\tlocal current=0\r\n\tlocal dif=0\r\n\tlocal perepad=0\r\n\tif data.IsDisabled==false then\r\n\t\tfor i=0,35 do\r\n\t\t\tnx=MoveX(x,range,a*i)\r\n\t\t\tny=MoveY(y,range,a*i)\r\n\t\t\tz=GetTerrainZ(nx,ny)\r\n\t\t\tperepad=GetUnitZ(hero)-GetTerrainZ(x,y)\r\n\t\t\t--print(\"perepad=\"..perepad)\r\n\t\t\t--if perepad<=2 then\r\n\t\t\tif z>-80 and data.OnTorrent==false then\r\n\t\t\t\tk=k+1\r\n\t\t\t\ttotal=total+a*i\r\n\t\t\t\tcurrent=a*i\r\n\t\t\t\tif current>=max then max=current end\r\n\t\t\t\tif current<=min then min=current end\r\n\t\t\t\t--print(\"a=\"..a*i)\r\n\t\t\t\tif UnitAlive(hero)  and k>=10 then\r\n\t\t\t\t\tDestroyEffect(AddSpecialEffect(\"Abilities/Weapons/AncestralGuardianMissile/AncestralGuardianMissile.mdl\",nx,ny))\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\tend\r\n\t\tif k>0 then\r\n\t\t\tdif=max-min\r\n\t\t\tif dif>=90 then\r\n\t\t\t\t--print(\"dif=\"..dif..\"при минимуме=\"..min)\r\n\t\t\t\tfor _=min,0,-10 do\r\n\t\t\t\t\ttotal=total+360\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\tmed=total/k\r\n\t\t\tif k>=10 then\r\n\t\t\t\t--print(\"selfdamage\")\r\n\t\t\t\tUnitDamageTarget( hero, hero, 5*(k-7), true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_NORMAL, WEAPON_TYPE_WHOKNOWS )\r\n\t\t\tend\r\n\t\t\tif k>=30 then\r\n\t\t\t\tKillUnit(hero)\r\n\t\t\tend\r\n\r\n\t\t\tif dif>=90 then med=med-180  end\r\n\r\n\t\t\tif  UnitAlive(hero) and k>=10 then\r\n\t\t\t\tdata.IsDisabled=true\r\n\t\t\t\tprint(\"force =\"..k)\r\n\t\t\t\tSetUnitPathing(hero,false)--отключение\r\n\t\t\t\tUnitAddVectorForce(hero,med-180,10+k,80+5*k)\r\n\t\t\tend\r\n\t\tend\r\n\tend\r\nend\r\n\r\n\r\n\r\n\r\nfunction PointContentUnit(x,y,range,condconten)\r\n\tlocal content=false\r\n\tlocal e--временный юнит\r\n\tlocal ContentUnit=nil\r\n\tif condconten==nil then condconten=true end\r\n\tif range==nil then range=80 end\r\n\tGroupEnumUnitsInRange(perebor,x,y,range,nil)\r\n\twhile true do\r\n\t\te = FirstOfGroup(perebor)\r\n\t\tif e == nil then break end\r\n\t\tif UnitAlive(e) and condconten and content==false  then\r\n\t\t\tcontent=true\r\n\t\t\tContentUnit=e\r\n\t\tend\r\n\t\tGroupRemoveUnit(perebor,e)\r\n\tend\r\n\treturn content,ContentUnit\r\nend\r\n\r\nGlobalRect=Rect(0,0,0,0)\r\nfunction PointContentDestructable (x,y,range,iskill,damage)\r\n\tlocal content=false\r\n\tif range==nil then range=80 end\r\n\tif iskill==nil then iskill=false end\r\n\tSetRect(GlobalRect, x - range, y - range, x + range, y +range)\r\n\tEnumDestructablesInRect(GlobalRect,nil,function ()\r\n\t\tlocal d=GetEnumDestructable()\r\n\t\tif GetDestructableLife(d)>0 then\r\n\t\t\tcontent=true\r\n\t\t\tif iskill then\r\n\t\t\t\tSetDestructableLife(d,GetDestructableLife(d)-damage)\r\n\t\t\t\tif GetDestructableLife(d)>=1 then\r\n\t\t\t\t\tSetDestructableAnimation(d,\"Stand Hit\")\r\n\t\t\t\tend\r\n\t\t\t\t--KillDestructable(d)\r\n\t\t\tend\r\n\t\tend\r\n\tend)\r\n\treturn content\r\nend\r\nfunction UnitAddForce(hero,angle,speed,distance)\r\n\tlocal currentdistance=0\r\n\tlocal data=HERO[GetPlayerId(GetOwningPlayer(hero))]\r\n\tTimerStart(CreateTimer(), TIMER_PERIOD, true, function()\r\n\t\tcurrentdistance=currentdistance+speed\r\n\t\t--print(currentdistance)\r\n\t\tlocal x,y=GetUnitX(hero),GetUnitY(hero)\r\n\t\tlocal newX,newY=MoveX(x,speed,angle),MoveY(y,speed,angle)\r\n\t\tlocal dx=math.abs(x-newX)\r\n\t\tif dx>=50 then\r\n\t\t\tprint(\"телепорт баг в адд форсе\")\r\n\t\telse\r\n\t\t\t--print(dx)\r\n\t\t\tSetUnitX(hero,newX)\r\n\t\t\tSetUnitY(hero,newY)\r\n\t\tend\r\n\r\n\t\tif currentdistance>=distance  or (data.OnWater and data.OnTorrent==false) then --or data.OnTorrent==false--or not UnitAlive(hero)\r\n\t\t\tdata.IsDisabled=false\r\n\t\t\tdata.OnWater=false\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t--print(\"stop cur=\"..currentdistance..\" dist=\"..distance)\r\n\t\tend\r\n\tend)\r\nend\r\n\r\n\r\n---------ВЕКТОРА\r\n---\r\nfunction UnitAddVectorForce(hero,Angle,Speed,Distance)\r\n\tlocal data=nil\r\n\tlocal k=0\r\n\tlocal h=0\r\n\tif IsUnitType(hero,UNIT_TYPE_HERO) then\r\n\t\th=UnitGetPid(hero)\r\n\r\n\telse\r\n\t\th=GetHandleId(hero)\r\n\t\tprint(\"НЕГЕРОЙ толкаемый\")\r\n\tend\r\n\tif not HERO[h] then\r\n\t\t--print(\"первый толчек для \"..GetUnitName(hero))\r\n\t\tHERO[h]={\r\n\t\t\tForcesCount=0,\r\n\t\t\tForceRemain={},\r\n\t\t\tForceAngle={},\r\n\t\t\tForceSpeed={},\r\n\t\t\tIsForce={}\r\n\t\t}\r\n\t\t--data=HERO[GetHandleId(hero)]\r\n\t\t--MovingSystem(hero)\r\n\tend\r\n\tdata=HERO[h]\r\n\tdata.ForcesCount=data.ForcesCount+1\r\n\tk=data.ForcesCount\r\n\tdata.ForceRemain[k]=Distance\r\n\tdata.ForceSpeed[k]=Speed\r\n\tdata.ForceAngle[k]=Angle\r\n\tdata.IsForce[k]=true\r\n\tdata.AngleForce=Angle\r\n\t--print(\"параметры заданы\"..GetUnitName(hero)..k)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 23.01.2020 20:11\r\nfunction InitUnitDeath()\r\n\tlocal gg_trg_DEADGUI = CreateTrigger()\r\n\tTriggerRegisterAnyUnitEventBJ(gg_trg_DEADGUI, EVENT_PLAYER_UNIT_DEATH)--меня полностью устраивает это событие\r\n\tTriggerAddAction(gg_trg_DEADGUI, function()\r\n\t\tlocal DeadUnit=GetTriggerUnit()--умерший\r\n\r\n\t\tlocal killer=GetKillingUnit()--убийца\r\n\t\tif IsUnitType(DeadUnit,UNIT_TYPE_HERO) then --герои\r\n\t\t\tTimerStart(CreateTimer(), 1, false, function()--юнит жив ещё 1 секунду\r\n\t\t\t\tlocal PD=GetOwningPlayer(DeadUnit)\r\n\t\t\t\tlocal pid=GetPlayerId(PD)\r\n\t\t\t\tlocal data=HERO[pid]\r\n\t\t\t\tdata.Alive=false\r\n\t\t\tend)\r\n\r\n\t\t\tTimerStart(CreateTimer(), 5, false, function()\r\n\t\t\t\tlocal PD=GetOwningPlayer(DeadUnit)\r\n\t\t\t\tlocal pid=GetPlayerId(PD)\r\n\t\t\t\tlocal data=HERO[pid]\r\n\t\t\t\tdata.Alive=true\r\n\t\t\t\tReviveHero(DeadUnit,GetPlayerStartLocationX(PD),GetPlayerStartLocationY(PD),true)\r\n\t\t\t\tSelectUnitForPlayerSingle(DeadUnit,PD)\r\n\t\t\tend)\r\n\t\tend\r\n\t\tif IsUnitInGroup(DeadUnit,OrcSkeletonPoolG) then--зомбки орки с первой зоны\r\n\t\t\tOrcSkeletonPool[4]=OrcSkeletonPool[4]-1\r\n\t\t\tlocal hObelisk=GetUnitUserData(DeadUnit)\r\n\t\t\tfor i=1,4 do\r\n\t\t\t\tif hObelisk==GetHandleId(OrcSkeletonPool[5+i]) then\r\n\t\t\t\t\tlocal obelisk=OrcSkeletonPool[5+i]\r\n\t\t\t\t\tSetUnitUserData(obelisk,GetUnitUserData(obelisk)-1)\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\tend\r\n\t\tif GetUnitTypeId(DeadUnit)==FourCC('h001') then\r\n\t\t\tShowUnit(DeadUnit,false)\r\n\t\t\tDestroyEffect(AddSpecialEffect(\"Abilities\\\\Spells\\\\Undead\\\\AnimateDead\\\\AnimateDeadTarget.mdl\",GetUnitXY(DeadUnit)))\r\n\t\tend\r\n\tend)\r\nend\r\n\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 03.01.2020 12:16\r\n\r\nTargetOrders={\"innerfire\",\"slow\",\"heal\",\"controlmagic\",\"invisibility\",\"magicleash\",\"spellsteal\",\"polymorph\",\"repair\",\"thunderbolt\",\"banish\",\"holybolt\",\"load\",\"unstableconcoctoin\",\"spirintlink\",\r\n\"bloodlust\",\"ensnare\",\"devour\",\"purge\",\"lightingshield\",\"healingwave\",\"hex\",\"chainlightning\",\"antimagicshell\",\"unholyfrenzy\",\"possession\",\"web\",\"absorbmana\",\"curse\",\"restoration\",\"cripple\",\"frostarmor\",\r\n\"deathpact\",\"sleep\",\"darkritual\",\"faeriefire\",\"renew\",\"autodispel\",\"cyclone\",\"entanglingroots\",\"flamingarrows\",\"manaburn\",\"shadowstrike\",\"creepthunderbolt\",\"mindrot\",\"deathcoil\",\r\n\"parasite\",\"charm\",\"creepdevour\",\"forkedlighting\",\"cripple\",\"blackarrow\",\"acidbomb\",\"doom\",\"soulburn\",\"transmute\",\"rejuvination\"}\r\n\r\nPointOrders={\"flare\",\"dispel\",\"cloudoffog\",\"flamestrike\",\"blizzard\",\"healingward\",\"stasistrap\",\"evileye\",\"farsight\",\"eathquake\",\"ward\",\"serpentward\",\"shockwave\",\"inferno\",\"impale\",\"deathanddecay\",\"carrionswarm\",\r\n\"detonate\",\"forceofnature\",\"blink\",\"selfdestruct\",\"silence\",\"rainoffire\",\"breathofirre\",\"volcano\",\"stampede\",\"healingspray\",\"clusterrockets\",\"summonfactory\",\"drunkenhaze\"}\r\n\r\nImmediateOrders={\"defend\",\"magicdefense\",\"militia\",\"townbellon\",\"avatar\",\"divineshield\",\"resurrection\",\"massteleport\",\"waterelemental\",\"thunderclap\",\"summonphoenix\",\"etherealform\",\"berserk\",\r\n\"battlestations\",\"corporealform\",\"whirlwind\",\"stomp\",\"spiritwolf\",\"locustswarm\",\"mirrorimage\",\"voodoo\",\"windwalk\",\"raisedead\",\"recharge\",\"replenish\",\"borrow\",\"stoneform\",\"cannibalize\",\"sphinksform\",\"replenishlife\",\r\n\"replenishmana\",\"carrionscarabs\",\"animatedead\",\"coupletarget\",\"manaflareon\",\"vengeance\",\"ravenform\",\"bearform\",\"taunt\",\"roar\",\"ambush\", \"fanofknives\",\"starfall\",\"metamorphosis\",\"immolation\",\r\n\"tranquility\",\"monsoon\",\"frenzy\",\"howlofterror\",\"manashield\",\"battleroar\",\"elementalfury\",\"wateryminion\",\"slimemonster\",\"robogoblin\",\"tornado\",\"chemicalrage\"}\r\n---@param u unit\r\n---@param x real\r\n---@param y real\r\n---@param target unit\r\nfunction Cast(u,x,y,target)\r\n\tlocal IsCast=false\r\n\tif UnitAlive(u) then\r\n\t\tAllPoint(u,x,y)\r\n\t\tif AllTarget(u,target) then\r\n\t\t\tIsCast=true\r\n\t\tend\r\n\t\tAllImmediate(u)\r\n\tend\r\n\treturn IsCast\r\nend\r\n\r\nfunction AllImmediate(u)\r\n\tfor i = 1,#ImmediateOrders do\r\n\t--print(ImmediateOrders[i]..\" is immediate\")\r\n\t\tIssueImmediateOrder(u,ImmediateOrders[i])\r\n\tend\r\nend\r\n\r\nfunction AllPoint(u,x,y)\r\n\tfor i = 1,#PointOrders do\r\n\t--\tprint(PointOrders[i]..\" is point\")\r\n\t\tIssuePointOrder(u,PointOrders[i],x,y)\r\n\tend\r\nend\r\n\r\nfunction AllTarget(u,target)\r\n\tlocal IsCast=false\r\n\tfor i = 1,#TargetOrders do\r\n\t\t--print(TargetOrders[i]..\" is target\")\r\n\t\tif IssueTargetOrder(u,TargetOrders[i],target) then\r\n\t\t\tIsCast=true\r\n\t\tend\r\n\tend\r\n\treturn IsCast\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 24.06.2020 13:08\r\n---\r\nfunction CreateCooldownIndicator(SelfFrame,posX,PosY)\r\n\tlocal cd= BlzCreateFrameByType(\"BACKDROP\", \"Face\", SelfFrame, \"\", 0)\r\n\tBlzFrameSetTexture(cd, \"DDS512\"..\"\\\\0000000\", 0, true)\r\n\tBlzFrameSetAlpha(cd,128)\r\n\tBlzFrameSetSize(cd, 0.039, 0.039)\r\n\tBlzFrameSetAbsPoint(cd, FRAMEPOINT_CENTER,posX,PosY)\r\n\tBlzFrameSetVisible(cd,false)\r\n\treturn cd\r\nend\r\n\r\nfunction StarFrameCooldown(SelfFrame,cd,WeaponIndex)\r\n\tif cd<=0 then return end\r\n\tlocal frameCount=1024\r\n\tlocal PercentAmount=(0.05*frameCount)/cd\r\n\tlocal Full=0\r\n\tlocal FrameCDText=BlzFrameGetChild(SelfFrame, 1)\r\n\tlocal FrameCDIndicator=BlzFrameGetChild(SelfFrame, 5)\r\n\tlocal CurrentCDTime=cd\r\n\r\n\tTimerStart(CreateTimer(), 0.05, true, function()\r\n\t\tFull=Full+PercentAmount\r\n\t\tCurrentCDTime=CurrentCDTime-0.05\r\n\t\tlocal textShowed=string.format(\"%02.1f\",CurrentCDTime)\r\n\t\tif CurrentCDTime>=10 then\r\n\t\t\ttextShowed=R2I(CurrentCDTime)\r\n\t\tend\r\n\t\tBlzFrameSetText(FrameCDText,textShowed)\r\n\t\tBlzFrameSetTexture(FrameCDIndicator, \"DDS512\"..\"\\\\000\"..Zero4(R2I(Full+PercentAmount)), 0, true)\r\n\t\tBlzFrameSetVisible(FrameCDIndicator,true)\r\n\t\tif Full>frameCount-1 then\r\n\t\t\t--print(\"кулдаун окончен\")\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tBlzFrameSetText(FrameCDText ,\"\")\r\n\t\t\tBlzFrameSetVisible(FrameCDIndicator,false)\r\n\t\t\tif not HERO[0].IsAttackReadyR[WeaponIndex] then\r\n\t\t\t\tHERO[0].IsAttackReadyR[WeaponIndex]=true\r\n\t\t\tend\r\n\t\t\tif not HERO[0].IsAttackReadyL[WeaponIndex] then\r\n\t\t\t\tHERO[0].IsAttackReadyL[WeaponIndex]=true\r\n\t\t\tend\r\n\t\t\t--EndFrameCD(data)\r\n\t\tend\r\n\tend)\r\nend\r\n\r\nfunction Zero4(s)\r\n\tlocal ns=\"\"\r\n\tif string.len(s)==1 then\r\n\t\tns=\"000\"..s\r\n\telseif string.len(s)==2 then\r\n\t\tns=\"00\"..s\r\n\telseif string.len(s)==3 then\r\n\t\tns=\"0\"..s\r\n\telse\r\n\t\tns=s\r\n\tend\r\n\treturn ns\r\nend\r\n\r\nfunction PauseFrameCD(data,isPaused)  --true - пауза, false - продолжить\r\n\tif isPaused then\r\n\t\tdata.OnPaused=true\r\n\telse\r\n\t\tdata.OnPaused=false\r\n\tend\r\nend\r\n\r\nfunction EndFrameCD(data)\r\n\tDestroyTimer(data.Timer)\r\n\tBlzFrameSetText(data.SelfFrame, \"\")\r\n\tdata.Timer=nil\r\n\tBlzDestroyFrame(data.CdIndicatorFrame)\r\n\tdata.Full=0\r\n\tdata.OnCD=false\r\n\tif data.Number==6 then\r\n\t\tBlzFrameSetVisible(data.ReadyIndicator,true)\r\n\tend\r\nend\r\n\r\nfunction AddSpeedToFrameCD(data,sec)\r\n\tdata.CurrentCDTime=data.CurrentCDTime-sec\r\n\t--10=2\r\n\t--20=1\r\n\tlocal k=1\r\n\tif data.CurrentCD==20 then\r\n\t\tk=1\r\n\tend\r\n\tif data.CurrentCD==10 then\r\n\t\tk=2\r\n\tend\r\n\tdata.Full=data.Full+(k*sec*data.CurrentCD*data.PercentAmount)\r\n\t--print(data.Full)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 10.01.2020 23:44\r\n---\r\n---@param x real\r\n---@param y real\r\n---@return boolean\r\nfunction InMapXY(x, y)\r\n\treturn x > GetRectMinX(bj_mapInitialPlayableArea) and x < GetRectMaxX(bj_mapInitialPlayableArea) and y > GetRectMinY(bj_mapInitialPlayableArea) and y < GetRectMaxY(bj_mapInitialPlayableArea)\r\nend\r\n\r\n---@param x real\r\n---@param distance real\r\n---@param angle real radian\r\n---@return real\r\nfunction GetPolarOffsetX(x, distance, angle)\r\n\treturn x + distance * math.cos(angle)\r\nend\r\n\r\n---@param y real\r\n---@param distance real\r\n---@param angle real radian\r\n---@return real\r\nfunction GetPolarOffsetY(y, distance, angle)\r\n\treturn y + distance * math.sin(angle)\r\nend\r\n\r\n---@param x real\r\n---@param distance real\r\n---@param angle real degrees\r\n---@return real\r\nfunction MoveX(x, distance, angle)\r\n\treturn x + distance * math.cos(angle * bj_DEGTORAD)\r\nend\r\n\r\n---@param y real\r\n---@param distance real\r\n---@param angle real degrees\r\n---@return real\r\nfunction MoveY(y, distance, angle)\r\n\treturn y + distance * math.sin(angle * bj_DEGTORAD)\r\nend\r\n\r\n\r\nlocal GetTerrainZ_location = Location(0, 0)\r\n---@param x real\r\n---@param y real\r\n---@return real\r\nfunction GetTerrainZ(x, y)\r\n\tMoveLocation(GetTerrainZ_location, x, y)\r\n\treturn GetLocationZ(GetTerrainZ_location)\r\nend\r\n\r\n---@param target unit\r\n---@return real\r\nfunction GetUnitZ(target)\r\n\tMoveLocation(GetTerrainZ_location, GetUnitX(target), GetUnitY(target))\r\n\treturn GetLocationZ(GetTerrainZ_location) + GetUnitFlyHeight(target)\r\nend\r\n\r\n---@param target unit\r\n---@param z real\r\nfunction SetUnitZ(target, z)\r\n\tUnitAddAbility(target, FourCC('Aave'))\r\n\tUnitRemoveAbility(target, FourCC('Aave'))\r\n\tMoveLocation(GetTerrainZ_location, GetUnitX(target), GetUnitY(target))\r\n\tSetUnitFlyHeight(target, z - GetLocationZ(GetTerrainZ_location), 0)\r\nend\r\n\r\n---@param h real максимальная высота в прыжке на середине расстояния (x = d / 2)\r\n---@param d real общее расстояние до цели\r\n---@param x real расстояние от исходной цели до точки, где следует взять высоту по параболе\r\n---@return real\r\nfunction ParabolaZ (h, d, x)\r\n\treturn (4 * h / d) * (d - x) * (x / d)\r\nend\r\n\r\n---@param zs real начальная высота высота одного края дуги\r\n---@param ze real конечная высота высота другого края дуги\r\n---@param h real максимальная высота на середине расстояния (x = d / 2)\r\n---@param d real общее расстояние до цели\r\n---@param x real расстояние от исходной цели до точки\r\n---@return real\r\nfunction GetParabolaZ(zs, ze, h, d, x)\r\n\treturn (2 * (zs + ze - 2 * h) * (x / d - 1) + (ze - zs)) * (x / d) + zs\r\nend\r\n\r\n---@param xa real\r\n---@param ya real\r\n---@param xb real\r\n---@param yb real\r\n---@return real\r\nfunction DistanceBetweenXY(xa, ya, xb, yb)\r\n\tlocal dx = xb - xa\r\n\tlocal dy = yb - ya\r\n\treturn math.sqrt(dx * dx + dy * dy)\r\nend\r\n\r\n---@param xa real\r\n---@param ya real\r\n---@param za real\r\n---@param xb real\r\n---@param yb real\r\n---@param zb real\r\n---@return real\r\nfunction DistanceBetweenXYZ(xa, ya, za, xb, yb, zb)\r\n\tlocal dx = xb - xa\r\n\tlocal dy = yb - ya\r\n\tlocal dz = zb - za\r\n\treturn math.sqrt(dx * dx + dy * dy + dz * dz)\r\nend\r\n\r\n---@param xa real\r\n---@param ya real\r\n---@param xb real\r\n---@param yb real\r\n---@return real radian\r\nfunction AngleBetweenXY(xa, ya, xb, yb)\r\n\treturn math.atan(yb - ya, xb - xa)\r\nend\r\n\r\n---@param a real radian\r\n---@param b real radian\r\n---@return real radian\r\nfunction AngleDifference(a, b)\r\n\tlocal c---@type real\r\n\tlocal d---@type real\r\n\tif a > b then\r\n\t\tc = a - b\r\n\t\td = b - a + 2 * math.pi\r\n\telse\r\n\t\tc = b - a\r\n\t\td = a - b + 2 * math.pi\r\n\tend\r\n\treturn c > d and d or c\r\nend\r\n\r\n--@author https://xgm.guru/p/wc3/warden-math\r\n---@param a real degrees\r\n---@param b real degrees\r\n---@return real degrees\r\nfunction AngleDifferenceDeg(a, b)\r\n\ta, b = math.abs(a, 360), math.abs(b, 360)\r\n\tlocal x---@type real\r\n\tif (a > b) then\r\n\t\ta, b = b, a\r\n\tend\r\n\tx = b - 360\r\n\tif (b - a > a - x) then\r\n\t\tb = x\r\n\tend\r\n\treturn math.abs(a - b)\r\nend\r\n\r\n-- Находит длину перпендикуляра от отрезка, заданного xa, ya, xb, yb к точке, заданной xc, yc\r\n--@author https://xgm.guru/p/wc3/perpendicular\r\n---@param xa real\r\n---@param ya real\r\n---@param xb real\r\n---@param yb real\r\n---@param xc real\r\n---@param yc real\r\n---@return real\r\nfunction Perpendicular (xa, ya, xb, yb, xc, yc)\r\n\treturn math.sqrt((xa - xc) * (xa - xc) + (ya - yc) * (ya - yc)) * math.sin(math.atan(yc - ya, xc - xa) - math.atan(yb - ya, xb - xa))\r\nend\r\n\r\n--@Hate https://xgm.guru/p/wc3/241479\r\n---@param source unit\r\n---@param x real\r\n---@param y real\r\nfunction SetUnitPositionSmooth(source, x, y)\r\n\tlocal last_x = GetUnitX(source)\r\n\tlocal last_y = GetUnitY(source)\r\n\tlocal bx\r\n\tlocal by\r\n\t--print(\"Смус выполнена\")\r\n\tSetUnitPosition(source, x, y)\r\n\tif (RAbsBJ(GetUnitX(source) - x) > 0.5) or (RAbsBJ(GetUnitY(source) - y) > 0.5) then\r\n\t\tSetUnitPosition(source, x, last_y)\r\n\t\tbx = RAbsBJ(GetUnitX(source) - x) <= 0.5\r\n\t\tSetUnitPosition(source, last_x, y)\r\n\t\tby = RAbsBJ(GetUnitY(source) - y) <= 0.5\r\n\r\n\t\t---\r\n\t\tlocal dx=math.abs(x-last_x)\r\n\t\tif dx>=100 then\r\n\t\t\tprint(\"Телепорт бак в функции Smooth\"..dx )\r\n\t\tend\r\n\t\t---\r\n\t\tif bx then\r\n\t\t\tSetUnitPosition(source, x, last_y)\r\n\t\telseif by then\r\n\t\t\tSetUnitPosition(source, last_x, y)\r\n\t\telse\r\n\t\t\tSetUnitPosition(source, last_x, last_y)\r\n\t\tend\r\n\tend\r\nend\r\n\r\nfunction GetUnitXY(unit)\r\n\treturn GetUnitX(unit),GetUnitY(unit)\r\nend\r\n\r\nfunction MoveXY(x,y, distance, angle)\r\n\treturn x + distance * math.cos(angle * bj_DEGTORAD),y + distance * math.sin(angle * bj_DEGTORAD)\r\nend\r\n\r\nfunction UnitCollisionOFF(unit)\r\n\tUnitAddAbility(unit,FourCC('A000'))\r\n\tIssueImmediateOrder(unit,\"windwalk\")\r\nend\r\n\r\nfunction math.clamp (inb, low, high) --\r\n    return math.min( math.max(inb, low ), high )\r\nend\r\n\r\nfunction math.lerp(a, b, t)\r\n\treturn a + (b - a) * t\r\nend\r\n\r\n\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 27.05.2020 23:15\r\n---\r\nlocal realTimerStart = TimerStart\r\nTimerStart = function(timer, duration, repeating, callback)\r\n\tlocal pcallback = function()\r\n\t\tif callback == nil then return end\r\n\t\tlocal status, err = pcall(callback)\r\n\t\tif not status then\r\n\t\t\tprint(err)\r\n\t\tend\r\n\tend\r\n\trealTimerStart(timer, duration, repeating, pcallback)\r\nend\r\n\r\nlocal realTriggerAddAction = TriggerAddAction\r\nTriggerAddAction = function(trig, callback)\r\n\tlocal pcallback = function()\r\n\t\tlocal status, err = pcall(callback)\r\n\t\tif not status then\r\n\t\t\tprint(err)\r\n\t\tend\r\n\tend\r\n\trealTriggerAddAction(trig, pcallback)\r\nend\r\n---@param text string\r\n---@param textSize real\r\n---@param x real\r\n---@param y real\r\n---@param z real\r\n---@param red integer\r\n---@param green integer\r\n---@param blue integer\r\n---@param alpha integer\r\n---@param xvel real\r\n---@param yvel real\r\n---@param fadepoint real\r\n---@param lifespan real\r\n---@param player player\r\n---@return texttag\r\nfunction FlyTextTag(text, textSize, x, y, z, red, green, blue, alpha, xvel, yvel, fadepoint, lifespan, player)\r\n\tlocal t = CreateTextTag()\r\n\tSetTextTagText(t, text, textSize)\r\n\tSetTextTagPos(t, x, y, z)\r\n\tSetTextTagColor(t, red, green, blue, alpha)\r\n\tSetTextTagVelocity(t, xvel, yvel)\r\n\tSetTextTagFadepoint(t, fadepoint)\r\n\tSetTextTagLifespan(t, lifespan)\r\n\tSetTextTagPermanent(t, false)\r\n\tif player ~= nil then\r\n\t\tSetTextTagVisibility(t, player == GetLocalPlayer())\r\n\tend\r\n\treturn t\r\nend\r\n\r\n---@param target widget\r\n---@param text string\r\n---@param player player\r\n---@return texttag\r\nfunction FlyTextTagGoldBounty(target, text, player)\r\n\treturn FlyTextTag(text, 0.024, GetWidgetX(target) - 16, GetWidgetY(target), 0, 255, 220, 0, 255, 0, 0.03, 2, 3, player)\r\nend\r\n\r\n---@param target widget\r\n---@param text string\r\n---@param player player\r\n---@return texttag\r\nfunction FlyTextTagLumberBounty(target, text, player)\r\n\treturn FlyTextTag(text, 0.024, GetWidgetX(target) - 16, GetWidgetY(target), 0, 0, 200, 80, 255, 0, 0.03, 2, 3, player)\r\nend\r\n\r\n---@param target widget\r\n---@param text string\r\n---@param player player\r\n---@return texttag\r\nfunction FlyTextTagMiss(target, text, player)\r\n\treturn FlyTextTag(text, 0.024, GetWidgetX(target), GetWidgetY(target), 0, 255, 0, 0, 255, 0, 0.03, 1, 3, player)\r\nend\r\n\r\n---@param target widget\r\n---@param text string\r\n---@param player player\r\n---@return texttag\r\nfunction FlyTextTagCriticalStrike(target, text, player)\r\n\treturn FlyTextTag(text, 0.024, GetWidgetX(target), GetWidgetY(target), 0, 255, 0, 0, 255, 0, 0.04, 2, 5, player)\r\nend\r\n\r\n---@param target widget\r\n---@param text string\r\n---@param player player\r\n---@return texttag\r\nfunction FlyTextTagManaBurn(target, text, player)\r\n\treturn FlyTextTag(text, 0.024, GetWidgetX(target), GetWidgetY(target), 0, 82, 82, 255, 255, 0, 0.04, 2, 5, player)\r\nend\r\n\r\n---@param target widget\r\n---@param text string\r\n---@param player player\r\n---@return texttag\r\nfunction FlyTextTagShadowStrike(target, text, player)\r\n\treturn FlyTextTag(text, 0.024, GetWidgetX(target), GetWidgetY(target), 0, 160, 255, 0, 255, 0, 0.04, 2, 5, player)\r\nend\r\n\r\nfunction FlyTextTagMissXY(x,y, text, player)\r\n\treturn FlyTextTag(text, 0.024, x, y, 150, 255, 0, 0, 255, 0, 0.03, 1, 3, player)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 11.03.2020 22:30\r\nfunction FindUnitOfType(id,flag,x,y)\r\n\t--flag nil - вся карта\r\n\t--flag any - радиус\r\n\tlocal unit=nil\r\n\tlocal e--временный юнит\r\n\tlocal k=0\r\n\t--print(\"ищем\")\r\n\tif not flag then\r\n\t\tGroupEnumUnitsInRect(perebor,bj_mapInitialPlayableArea,nil)\r\n\t\twhile true do\r\n\t\t\te = FirstOfGroup(perebor)\r\n\r\n\t\t\tif e == nil then break end\r\n\t\t\tif UnitAlive(e) and GetUnitTypeId(e)==id then\r\n\t\t\t\tk=k+1\r\n\t\t\t\tunit=e\r\n\t\t\tend\r\n\t\t\tGroupRemoveUnit(perebor,e)\r\n\t\tend\r\n\telse\r\n\t\tGroupEnumUnitsInRange(perebor,x,y,flag,nil)\r\n\t\twhile true do\r\n\t\t\te = FirstOfGroup(perebor)\r\n\r\n\t\t\tif e == nil then break end\r\n\t\t\tif UnitAlive(e) and GetUnitTypeId(e)==id then\r\n\t\t\t\tk=k+1\r\n\t\t\t\tunit=e\r\n\t\t\tend\r\n\t\t\tGroupRemoveUnit(perebor,e)\r\n\t\tend\r\n\tend\r\n\r\n\r\n\tif k>1 then\r\n\t\tprint(\"Ошибка получено \"..k..\" юнитов\")\r\n\tend\r\n\tif unit==nil then\r\n\t\tprint(\"Не найдено живых юнитов данного типа\")\r\n\tend\r\n\treturn unit\r\nend\r\n\r\ndo --Инициализация\r\n\tTimerStart(CreateTimer(), 1, false, function()\r\n\t\t--создаёт триггер отлова клавишь\r\n\t\tif not BlzLoadTOCFile(\"Main.toc\") then\r\n\t\t\tprint(\"errloadtoc\")\r\n\t\tend\r\n\t\tTimerStart(CreateTimer(), 1, false, function()\r\n\r\n\t\t\tCreateAllWeaponFrames()\r\n\t\tend)\r\n\tend)\r\nend\r\n--\r\n\r\nfunction CreateAbilityFrame(posX,PosY,texture,chargesCount,player) -- позиция 1 - 12\r\n\tlocal NextPoint=0.039\r\n\tif not texture then\r\n\t\ttexture=\"ReplaceableTextures\\\\CommandButtons\\\\BTNSelectHeroOn\"\r\n\tend\r\n\tlocal SelfFrame = BlzCreateFrame(\"GlueWText\", BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0), 0, 0)\r\n\r\n\tBlzFrameSetVisible(SelfFrame,false)\r\n\tBlzFrameSetVisible(SelfFrame,GetLocalPlayer()==player)\r\n\tBlzFrameSetTexture(BlzFrameGetChild(SelfFrame, 0), texture, 0, true)\r\n\tBlzFrameSetText(BlzFrameGetChild(SelfFrame, 1), \"\")\r\n\tBlzFrameSetSize(SelfFrame,NextPoint,NextPoint)\r\n\tBlzFrameSetAbsPoint(SelfFrame,FRAMEPOINT_CENTER,posX,PosY)\r\n\r\n\tlocal ChargeContent=BlzCreateFrame(\"GlueWText\", SelfFrame, 0, 0)\r\n\tlocal chargesBox=BlzFrameGetChild(ChargeContent, 0)-- рамка\r\n\tlocal chargesText=BlzFrameGetChild(ChargeContent, 1)-- текст заряда\r\n\r\n\tBlzFrameSetText(chargesText, chargesCount)\r\n\tBlzFrameSetTexture(chargesBox, \"UI\\\\Widgets\\\\Console\\\\Human\\\\CommandButton\\\\human-button-lvls-overlay\", 0, true)\r\n\tBlzFrameSetSize(ChargeContent,NextPoint/1.5,NextPoint/3)\r\n\tBlzFrameSetScale(chargesText,0.6)\r\n\tBlzFrameSetPoint(ChargeContent, FRAMEPOINT_BOTTOMRIGHT, SelfFrame, FRAMEPOINT_BOTTOMRIGHT, 0.001,0.)\r\n\r\n\t--print(BlzFrameGetChildrenCount(SelfFrame))\r\n\r\n\tif true then -- События кликов по кнопке\r\n\t\tprint(\"создана ативная кнопка\")\r\n\t\tlocal  ClickTrig = CreateTrigger()\r\n\t\tBlzFrameSetEnable(BlzGetTriggerFrame(), false)\r\n\t\tBlzFrameSetEnable(BlzGetTriggerFrame(), true)\r\n\t\tBlzTriggerRegisterFrameEvent(ClickTrig, SelfFrame, FRAMEEVENT_CONTROL_CLICK)\r\n\t\tBlzTriggerRegisterFrameEvent(ClickTrig, ChargeContent, FRAMEEVENT_CONTROL_CLICK)\r\n\t\tTriggerAddAction(ClickTrig, function ()\r\n\t\t\tprint(\"Нажата кнопка \")\r\n\t\t\tBlzFrameSetEnable(BlzGetTriggerFrame(), false)\r\n\t\t\tBlzFrameSetEnable(BlzGetTriggerFrame(), true)\r\n\t\tend)\r\n\tend\r\n\tlocal  TrigMOUSE_ENTER = CreateTrigger()\r\n\tBlzTriggerRegisterFrameEvent( TrigMOUSE_ENTER, SelfFrame, FRAMEEVENT_MOUSE_ENTER)\r\n\tBlzTriggerRegisterFrameEvent( TrigMOUSE_ENTER, ChargeContent, FRAMEEVENT_MOUSE_ENTER)\r\n\tTriggerAddAction( TrigMOUSE_ENTER, function ()\r\n\t\tprint(\"показать подсказку\")\r\n\tend)\r\n\tlocal  TrigMOUSE_LEAVE = CreateTrigger()\r\n\tBlzTriggerRegisterFrameEvent( TrigMOUSE_LEAVE, SelfFrame, FRAMEEVENT_MOUSE_LEAVE)\r\n\tBlzTriggerRegisterFrameEvent( TrigMOUSE_LEAVE, ChargeContent, FRAMEEVENT_MOUSE_LEAVE)\r\n\tTriggerAddAction( TrigMOUSE_LEAVE, function ()\r\n\t\tprint(\"убрать подсказку\")\r\n\tend)\r\n\treturn SelfFrame,chargesText\r\nend\r\n\r\nfunction CreateAllWeaponFrames()\r\n\tlocal texture={\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNDwarvenLongRifle.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNHumanMissileUpThree.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNClusterRockets.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNFireBolt.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNFireRocks.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNBarrel.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNChainLightning.blp\",\r\n\t\t\"ReplaceableTextures\\\\PassiveButtons\\\\PASBTNUpgradeMoonGlaive.blp\",\r\n\t\t\"ReplaceableTextures\\\\CommandButtons\\\\BTNUnstableConcoction.blp\",\r\n\t}\r\n\tlocal weaponName= {\r\n\t\t\"[1] Носовое ордие\",\r\n\t\t\"[2] Бортовые пушки\",\r\n\t\t\"[3] Ракетница\",\r\n\t\t\"[4] Огнемёт\",\r\n\t\t\"[5] Вертикальный залп\",\r\n\t\t\"[6] Бочка\",\r\n\t\t\"[7] Молнии\",\r\n\t\t\"[8] Пилы\",\r\n\t\t\"[9] Нефтяное пятно\"\r\n\t}\r\n\tlocal description={\r\n\t\t\"Одиночный выстрел [RMB]\",\r\n\t\t\"Несколько выстрелов с борта [RMB] [LMB]\",\r\n\t\t\"Самоновадящаяся ракета [RMB] на цель\",\r\n\t\t\"Огнемёт из бортовых орудий. Удерживайте [RMB] [LMB] \",\r\n\t\t\"Стреляет в указанную точку навесом [RMB]\",\r\n\t\t\"Спускает на воду бочку [RMB]\",\r\n\t\t\"Бьёт молнией в указанную цель [RMB]\",\r\n\t\t\"Урон касанием, перемещает пилу по корпусу [RMB]\",\r\n\t\t\"Оставляет позади себя нефтяное пятно, можно поджечь [RMB]\"\r\n\t}\r\n\r\n\r\n\t--NewButton()\r\n\tlocal next=0.039\r\n\tlocal qerf=0\r\n\tfor i = 0, 8 do\r\n\t\tlocal x,y=next+next+next*i, next*0.8\r\n\t\tlocal SelfFrame,new_FrameChargesText=CreateAbilityFrame(x,y,texture[i+1],9999,Player(0))\r\n\r\n\t\tlocal hot=BlzCreateFrameByType(\"BACKDROP\", \"Face\", SelfFrame, \"\", 0)\r\n\t\tBlzFrameSetTexture(hot, \"DDSSymbols\\\\\"..(i+1)..\".dds\", 0, true)\r\n\t\tBlzFrameSetSize(hot, 0.02, 0.02)\r\n\t\tBlzFrameSetPoint(hot, FRAMEPOINT_TOPLEFT, SelfFrame, FRAMEPOINT_TOPLEFT, -0.003,0.)\r\n\t\t--Создаём переключающиеся рамки\r\n\t\tlocal buttonsprite = BlzCreateFrameByType(\"SPRITE\", \"justAName\", SelfFrame, \"WarCraftIIILogo\", 0)\r\n\t\tBlzFrameSetPoint(buttonsprite, FRAMEPOINT_BOTTOMLEFT, SelfFrame, FRAMEPOINT_BOTTOMLEFT, 0.02, 0.02)\r\n\t\tBlzFrameSetSize(buttonsprite, 1., 1.)\r\n\t\tBlzFrameSetScale(buttonsprite, 1.)\r\n\t\tBlzFrameSetModel(buttonsprite, \"selecter1.mdx\", 0)\r\n\t\t---создаём индикацию кулдауна\r\n\t    CreateCooldownIndicator(SelfFrame,x,y) --болванчик со сменной текстурой\r\n\t\tFrameSelecter[i+1]=buttonsprite\r\n\t\tVisualCharges[i+1]=new_FrameChargesText\r\n\t\tHERO[0].SelfFrame[i+1]=SelfFrame\r\n\r\n\t\tqerf=next+next+next*i\r\n\t\tif i>= 1 then\r\n\t\t\tBlzFrameSetVisible(buttonsprite,false)\r\n\t\tend\r\n\r\n\r\n\tend\r\n\r\n\r\n\tfor i=1,4 do\r\n\t\tlocal SkillButton=BlzCreateFrameByType(\"BACKDROP\", \"Face\", BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0), \"\", 0)\r\n\t\tBlzFrameSetTexture(SkillButton, \"ChargesTexture.blp\", 0, true)\r\n\t\tBlzFrameSetSize(SkillButton, 0.04, 0.04)\r\n\t\tBlzFrameSetAbsPoint(SkillButton, FRAMEPOINT_TOPLEFT, qerf+next*i, next*1.3)\r\n\r\n\t\tlocal hot=BlzCreateFrameByType(\"BACKDROP\", \"Face\", SkillButton, \"\", 0)\r\n\t\tif i==1 then\r\n\t\t\tBlzFrameSetTexture(hot, \"DDSSymbols\\\\q.dds\", 0, true)\r\n\t\telseif i==2 then\r\n\t\t\tBlzFrameSetTexture(hot, \"DDSSymbols\\\\e.dds\", 0, true)\r\n\t\telseif i==3 then\r\n\t\t\tBlzFrameSetTexture(hot, \"DDSSymbols\\\\r.dds\", 0, true)\r\n\t\telseif i==4 then\r\n\t\t\tBlzFrameSetTexture(hot, \"DDSSymbols\\\\f.dds\", 0, true)\r\n\t\tend\r\n\t\tBlzFrameSetSize(hot, 0.03, 0.03)\r\n\t\tBlzFrameSetPoint(hot, FRAMEPOINT_CENTER, SkillButton, FRAMEPOINT_CENTER, 0.,0.)\r\n\t\tlocal t = CreateTrigger()\r\n\t\tBlzTriggerRegisterFrameEvent(t, hot, FRAMEEVENT_CONTROL_CLICK)\r\n\t\tTriggerAddAction(t,function()\r\n\t\t\tprint(\"click \"..i) -- вот тут не работает\r\n\t\tend)\r\n\r\n\tend\r\nend\r\n\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 08.03.2020 12:10\r\n---\r\nif(_G[\"WM\"] == nil) then WM = (function(m,h) h(nil,(function() end), (function(e) _G[m] = e end)) end) end -- WLPM MM fallback\r\n\r\n-- Warcraft 3 Geometry module by ScorpioT1000 / 2020\r\n-- Thanks to DGUI by Ashujon / 2009\r\nWM(\"wGeometry\", function(import, export, exportDefault)\r\n\tlocal Functions = nil\r\n\tlocal Vector3 = nil\r\n\tlocal Matrix3 = nil\r\n\tlocal Matrix4 = nil\r\n\tlocal Camera = nil\r\n\tlocal zTesterLocation = Location(0,0)\r\n\r\n\tlocal getTerrainZ = function(x,y)\r\n\t\tMoveLocation(zTesterLocation, x, y)\r\n\t\treturn GetLocationZ(zTesterLocation)\r\n\tend\r\n\r\n\tlocal _GetUnitZ = function(u)\r\n\t\treturn GetUnitFlyHeight(u) + getTerrainZ(GetUnitX(u), GetUnitY(u))\r\n\tend\r\n\r\n\tlocal _SetUnitZ = function(u, z)\r\n\t\tSetUnitFlyHeight(u, z - getTerrainZ(GetUnitX(u), GetUnitY(u)), 0)\r\n\tend\r\n\r\n\tlocal _GetItemZ = function(i)\r\n\t\treturn getTerrainZ(GetItemX(u), GetItemY(u))\r\n\tend\r\n\r\n\tlocal _GetDestructableZ = function(d)\r\n\t\treturn getTerrainZ(GetDestructableX(d), GetDestructableY(d))\r\n\tend\r\n\r\n\t-- Must be called for each non-air unit before manipulating Z coordinate\r\n\t-- @param u Unit\r\n\tlocal unlockUnitZ = function(u)\r\n\t\tUnitAddAbility(u , 'Aave')\r\n\t\tUnitRemoveAbility(u , 'Aave')\r\n\tend\r\n\r\n\r\n\t-- Math functions\r\n\tFunctions = {\r\n\t\t-- 1D clamp\r\n\t\tclamp = function(value, _min, _max)\r\n\t\t\tif value > _max then\r\n\t\t\t\tvalue = _max\r\n\t\t\tend\r\n\t\t\tif value < _min then\r\n\t\t\t\tvalue = _min\r\n\t\t\tend\r\n\t\t\treturn value\r\n\t\tend,\r\n\r\n\t\t-- 1D distance\r\n\t\tdistance = function(value1, value2)\r\n\t\t\treturn math.abs(value1 - value2)\r\n\t\tend,\r\n\r\n\t\t-- 1D linear spline interpolation between 2 points\r\n\t\tlerp = function(value1, value2, amount)\r\n\t\t\treturn value1 + (value2 - value1) * amount\r\n\t\tend,\r\n\r\n\t\t-- 1D hermite spline interpolation between 2 points\r\n\t\thermite = function(value1, tangent1, value2, tangent2, amount)\r\n\t\t\tlocal v1 = value1\r\n\t\t\tlocal v2 = value2\r\n\t\t\tlocal t1 = tangent1\r\n\t\t\tlocal t2 = tangent2\r\n\t\t\tlocal s = amount\r\n\t\t\tlocal result = 0.\r\n\t\t\tlocal sCubed = s * s * s\r\n\t\t\tlocal sSquared = s * s\r\n\r\n\t\t\tif (amount == 0.) then\r\n\t\t\t\tresult = value1\r\n\t\t\telseif (amount == 1.) then\r\n\t\t\t\tresult = value2\r\n\t\t\telse\r\n\t\t\t\tresult = (2 * v1 - 2 * v2 + t2 + t1) * sCubed +\r\n\t\t\t\t\t\t(3 * v2 - 3 * v1 - 2 * t1 - t2) * sSquared +\r\n\t\t\t\t\t\tt1 * s +\r\n\t\t\t\t\t\tv1\r\n\t\t\tend\r\n\t\t\treturn result\r\n\t\tend,\r\n\r\n\t\t-- 1D bezier spline interpolation between 3 points\r\n\t\tbezier = function(p0, p1, p2, amount)\r\n\t\t\tlocal amountInv = 1-amount\r\n\t\t\treturn amountInv*amountInv*p0\r\n\t\t\t\t\t+ 2*amount*amountInv*p1\r\n\t\t\t\t\t+ amount*amount*p2\r\n\t\tend\r\n\t}\r\n\r\n\r\n\r\n\t-- 3D Vector ====================\r\n\tVector3 = {\r\n\t\t-- x, y, z\r\n\r\n\t\t-- Create a new vector from coords. Skip the coords to create a zero vector\r\n\t\tnew = function(self, x, y, z)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.x = x or 0.\r\n\t\t\to.y = y or 0.\r\n\t\t\to.z = z or 0.\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Copy vector from another\r\n\t\tcopyFrom = function(self, that)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.x = that.x\r\n\t\t\to.y = that.y\r\n\t\t\to.z = that.z\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Copy vector from Unit X/Y/Z\r\n\t\t-- @param u Unit\r\n\t\tcopyFromUnit = function(self, u)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.x = GetUnitX(u)\r\n\t\t\to.y = GetUnitY(u)\r\n\t\t\to.z = _GetUnitZ(u)\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Copy vector from Location X/Y/Z\r\n\t\t-- @param loc Location\r\n\t\tcopyFromLocation = function(self, loc)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.x = GetLocationX(loc)\r\n\t\t\to.y = GetLocationY(loc)\r\n\t\t\to.z = GetLocationZ(loc)\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Copy vector from Item X/Y/Z\r\n\t\t-- @param i Item\r\n\t\tcopyFromItem = function(self, i)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.x = GetItemX(i)\r\n\t\t\to.y = GetItemY(i)\r\n\t\t\to.z = _GetItemZ(i)\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Copy vector from Destructable X/Y/Z\r\n\t\t-- @param d Destructable\r\n\t\tcopyFromDestructable = function(self, d)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.x = GetDestructableX(d)\r\n\t\t\to.y = GetDestructableX(d)\r\n\t\t\to.z = _GetDestructableZ(d)\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Create a new X-oriented unit vector\r\n\t\tnewRight = function(self)\r\n\t\t\treturn Vector3:new(1.,0.,0.)\r\n\t\tend,\r\n\r\n\t\t-- Create a new Y-oriented unit vector\r\n\t\tnewForward = function(self)\r\n\t\t\treturn Vector3:new(0.,1.,0.)\r\n\t\tend,\r\n\r\n\t\t-- Create a new Z-oriented unit vector\r\n\t\tnewUp = function(self)\r\n\t\t\treturn Vector3:new(0.,0.,1.)\r\n\t\tend,\r\n\r\n\t\tlength = function(self)\r\n\t\t\treturn math.sqrt(self.x*self.x+self.y*self.y+self.z*self.z)\r\n\t\tend,\r\n\r\n\t\tlengthSquared = function(self)\r\n\t\t\treturn self.x*self.x+self.y*self.y+self.z*self.z\r\n\t\tend,\r\n\r\n\t\tlength2d = function(self)\r\n\t\t\treturn math.sqrt(self.x*self.x+self.y*self.y)\r\n\t\tend,\r\n\r\n\t\tnormalize = function(self)\r\n\t\t\tlocal len = math.sqrt(self.x*self.x+self.y*self.y+self.z*self.z)\r\n\t\t\treturn Vector3:new(self.x/len, self.y/len, self.z/len)\r\n\t\tend,\r\n\r\n\t\tdistance = function(self, that)\r\n\t\t\treturn math.sqrt(\r\n\t\t\t\t\t(self.x-that.x)*(self.x-that.x) +\r\n\t\t\t\t\t\t\t(self.y-that.y)*(self.y-that.y) +\r\n\t\t\t\t\t\t\t(self.z-that.z)*(self.z-that.z)\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\tdistanceSquared = function(self, that)\r\n\t\t\treturn\r\n\t\t\t(self.x-that.x)*(self.x-that.x) +\r\n\t\t\t\t\t(self.y-that.y)*(self.y-that.y) +\r\n\t\t\t\t\t(self.z-that.z)*(self.z-that.z)\r\n\t\tend,\r\n\r\n\t\t__eq = function(self, that)\r\n\t\t\treturn self.x == that.x and self.y == that.y and self.z == that.z\r\n\t\tend,\r\n\r\n\t\t__add = function(self, that)\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\tself.x + that.x,\r\n\t\t\t\t\tself.y + that.y,\r\n\t\t\t\t\tself.z + that.z\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t__sub = function(self, that)\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\tself.x - that.x,\r\n\t\t\t\t\tself.y - that.y,\r\n\t\t\t\t\tself.z - that.z\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t__unm = function(self, that)\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\t-self.x,\r\n\t\t\t\t\t-self.y,\r\n\t\t\t\t\t-self.z\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Uses cross product (!)\r\n\t\t-- @see https://en.wikipedia.org/wiki/Cross_product\r\n\t\t__mul = function(self, that)\r\n\t\t\treturn self:crossProduct(that)\r\n\t\tend,\r\n\r\n\t\t-- Division by a number (!)\r\n\t\t__div = function(self, aNumber)\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\tself.x / aNumber,\r\n\t\t\t\t\tself.y / aNumber,\r\n\t\t\t\t\tself.z / aNumber\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- @param that Vector3\r\n\t\t-- @return number\r\n\t\t-- @see https://en.wikipedia.org/wiki/Dot_product\r\n\t\tdotProduct = function(self, that)\r\n\t\t\treturn self.x*that.x + self.y*that.y + self.z*that.z\r\n\t\tend,\r\n\r\n\t\t-- @param that Vector3\r\n\t\t-- @return Vector3\r\n\t\t-- @see https://en.wikipedia.org/wiki/Cross_product\r\n\t\tcrossProduct = function(self, that)\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\tself.y * that.z - self.z * that.y,\r\n\t\t\t\t\tself.z * that.x - self.x * that.z,\r\n\t\t\t\t\tself.x * that.y - self.y * that.x\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\tscale = function(self, aNumber)\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\tself.x * aNumber,\r\n\t\t\t\t\tself.y * aNumber,\r\n\t\t\t\t\tself.z * aNumber\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Spheric coordinates offset\r\n\t\t-- @param distance number in game units\r\n\t\t-- @param yaw number (angle in radians)\r\n\t\t-- @param pitch number (angle in radians)\r\n\t\t-- @return Vector3 result point\r\n\t\t-- @see https://en.wikipedia.org/wiki/Aircraft_principal_axes\r\n\t\tyawPitchOffset = function(self, distance, yaw, pitch)\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\tdistance * math.cos(yaw) * math.cos(pitch),\r\n\t\t\t\t\tdistance * math.sin(yaw) * math.cos(pitch),\r\n\t\t\t\t\tdistance * math.cos(pitch)\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Transforms the vector by 3x3 matrix transformation components\r\n\t\t-- @param Matrix3 m\r\n\t\t-- @return Vector3\r\n\t\t-- @see https://en.wikipedia.org/wiki/Transformation_matrix\r\n\t\ttransform3 = function(self, m)\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\tself.x*m.m11+self.y*m.m21+self.z*m.m31,\r\n\t\t\t\t\tself.x*m.m12+self.y*m.m22+self.z*m.m32,\r\n\t\t\t\t\tself.x*m.m13+self.y*m.m23+self.z*m.m33\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Transforms the vector by 4x4 matrix transformation components\r\n\t\t-- @param Matrix4 m\r\n\t\t-- @return Vector3\r\n\t\t-- @see https://en.wikipedia.org/wiki/Transformation_matrix\r\n\t\ttransform4 = function(self, m)\r\n\t\t\tlocal w = self.x*m.m14+self.y*m.m24+self.z*m.m34+m.m44\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\t(self.x*m.m11+self.y*m.m21+self.z*m.m31+m.m41)/w,\r\n\t\t\t\t\t(self.x*m.m12+self.y*m.m22+self.z*m.m32+m.m42)/w,\r\n\t\t\t\t\t(self.x*m.m13+self.y*m.m23+self.z*m.m33+m.m43)/w\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Applies linear interpolation\r\n\t\t-- @param that Vector3\r\n\t\t-- @param amount current animation state, number between 0 and 1\r\n\t\t-- @return Vector3 result\r\n\t\tlerp = function(self, that, amount)\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\tFunctions.lerp(self.x, that.x, amount),\r\n\t\t\t\t\tFunctions.lerp(self.y, that.y, amount),\r\n\t\t\t\t\tFunctions.lerp(self.z, that.z, amount)\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Applies hermite spline interpolation\r\n\t\t-- @param that Vector3\r\n\t\t-- @param amount current animation state, number between 0 and 1\r\n\t\t-- @param tangent1 (optional)\r\n\t\t-- @param tangent2 (optional)\r\n\t\t-- @return Vector3 result\r\n\t\thermite = function(self, that, amount, tangent1, tangent2)\r\n\t\t\tif(tangent1 == nil) then\r\n\t\t\t\ttangent1 = 0.\r\n\t\t\tend\r\n\t\t\tif(tangent2 == nil) then\r\n\t\t\t\ttangent2 = 0.\r\n\t\t\tend\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\tFunctions.hermite(self.x, tangent1, that.x, tangent2, amount),\r\n\t\t\t\t\tFunctions.hermite(self.y, tangent1, that.y, tangent2, amount),\r\n\t\t\t\t\tFunctions.hermite(self.z, tangent1, that.z, tangent2, amount)\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Applies bezier spline interpolation\r\n\t\t-- @param p2 Vector3 point 2\r\n\t\t-- @param p3 Vector3 point 3\r\n\t\t-- @param amount current animation state, number between 0 and 1\r\n\t\t-- @return Vector3 result\r\n\t\tbezier = function(self, p2, p3, amount)\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\tFunctions.bezier(self.x, p2.x, p3.x, amount),\r\n\t\t\t\t\tFunctions.bezier(self.y, p2.y, p3.y, amount),\r\n\t\t\t\t\tFunctions.bezier(self.z, p2.z, p3.z, amount)\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Checks if the point is in a sphere\r\n\t\t-- @param c Vector3 sphere center\r\n\t\t-- @param r number sphere radius\r\n\t\t-- @return boolean\r\n\t\tisInSphere = function(self, c, r)\r\n\t\t\treturn self:distanceSquared(c) < (r*r)\r\n\t\tend,\r\n\r\n\t\t-- Checks if the point is inside axis-aligned bounding box (AABB)\r\n\t\t-- @param vMin\r\n\t\t-- @param vMax\r\n\t\t-- @return boolean\r\n\t\tisInAABB = function(self, vMin, vMax)\r\n\t\t\treturn (self.x >= vMin.x and self.x <= vMax.x) and\r\n\t\t\t\t\t(self.y >= vMin.y and self.y <= vMax.y) and\r\n\t\t\t\t\t(self.z >= vMin.z and self.z <= vMax.z)\r\n\t\tend,\r\n\r\n\t\tapplyToLocation = function(self, loc)\r\n\t\t\tMoveLocation(loc, self.x, self.y)\r\n\t\tend,\r\n\r\n\t\tapplyToUnit = function(self, u)\r\n\t\t\tSetUnitX(u, self,x)\r\n\t\t\tSetUnitY(u, self.y)\r\n\t\t\t_SetUnitZ(u, self.z)\r\n\t\tend,\r\n\r\n\t\t__tostring = function(self)\r\n\t\t\treturn \"{ \" .. tostring(self.x) .. \", \" .. tostring(self.y) .. \", \" .. tostring(self.z) .. \" }\"\r\n\t\tend,\r\n\t}\r\n\tVector3.__index = Vector3\r\n\r\n\r\n\r\n\r\n\t-- 3x3 Matrix ====================\r\n\tMatrix3 = {\r\n\t\t-- m11, m12, m13\r\n\t\t-- m21, m22, m23\r\n\t\t-- m31, m32, m33\r\n\r\n\t\t-- Create a new matrix from coords. Skip coords to create a zero matrix\r\n\t\t-- @return Matrix3\r\n\t\tnew = function(self, m11, m12, m13, m21, m22, m23, m31, m32, m33)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.m11 = m11 or 0.\r\n\t\t\to.m12 = m12 or 0.\r\n\t\t\to.m13 = m13 or 0.\r\n\t\t\to.m21 = m21 or 0.\r\n\t\t\to.m22 = m22 or 0.\r\n\t\t\to.m23 = m23 or 0.\r\n\t\t\to.m31 = m31 or 0.\r\n\t\t\to.m32 = m32 or 0.\r\n\t\t\to.m33 = m33 or 0.\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Copy matrix from another\r\n\t\t-- @return Matrix3\r\n\t\tcopyFrom = function(self, that)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.m11 = that.m11\r\n\t\t\to.m12 = that.m12\r\n\t\t\to.m13 = that.m13\r\n\t\t\to.m21 = that.m21\r\n\t\t\to.m22 = that.m22\r\n\t\t\to.m23 = that.m23\r\n\t\t\to.m31 = that.m31\r\n\t\t\to.m32 = that.m32\r\n\t\t\to.m33 = that.m33\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Create a new identity matrix\r\n\t\t-- @return Matrix3\r\n\t\tnewIdentity = function(self)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.m11 = 1.\r\n\t\t\to.m12 = 0.\r\n\t\t\to.m13 = 0.\r\n\t\t\to.m21 = 0.\r\n\t\t\to.m22 = 1.\r\n\t\t\to.m23 = 0.\r\n\t\t\to.m31 = 0.\r\n\t\t\to.m32 = 0.\r\n\t\t\to.m33 = 1.\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Create a new scaling matrix\r\n\t\t-- @return Matrix3\r\n\t\tnewScaling = function(self, scaleX, scaleY, scaleZ)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.m11 = scaleX or 1.\r\n\t\t\to.m12 = 0.\r\n\t\t\to.m13 = 0.\r\n\t\t\to.m21 = 0.\r\n\t\t\to.m22 = scaleY or 1.\r\n\t\t\to.m23 = 0.\r\n\t\t\to.m31 = 0.\r\n\t\t\to.m32 = 0.\r\n\t\t\to.m33 = scaleZ or 1.\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Create a new scaling matrix\r\n\t\t-- @return Matrix3\r\n\t\t-- @see https://en.wikipedia.org/wiki/Scaling_(geometry)\r\n\t\tnewScaling = function(self, scaleX, scaleY, scaleZ)\r\n\t\t\treturn Matrix3:new(\r\n\t\t\t\t\tscaleX or 1., 0., 0.,\r\n\t\t\t\t\t0., scaleY or 1., 0.,\r\n\t\t\t\t\t0., 0., scaleZ or 1.\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Create a new rotation X matrix from the angle (in radians)\r\n\t\t-- @return Matrix3\r\n\t\t-- @see https://en.wikipedia.org/wiki/Rotation_matrix\r\n\t\tnewRotationX = function(self, a)\r\n\t\t\treturn Matrix3:new(\r\n\t\t\t\t\t1., 0., 0.,\r\n\t\t\t\t\t0., math.cos(a), -math.sin(a),\r\n\t\t\t\t\t0., math.sin(a), math.cos(a)\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Create a new rotation Y matrix from the angle (in radians)\r\n\t\t-- @return Matrix3\r\n\t\t-- @see https://en.wikipedia.org/wiki/Rotation_matrix\r\n\t\tnewRotationY = function(self, a)\r\n\t\t\treturn Matrix3:new(\r\n\t\t\t\t\tmath.cos(a), 0., math.sin(a),\r\n\t\t\t\t\t0., 1., 0.,\r\n\t\t\t\t\t-math.sin(a), 0., math.cos(a)\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Create a new rotation Z matrix from the angle (in radians)\r\n\t\t-- @return Matrix3\r\n\t\t-- @see https://en.wikipedia.org/wiki/Rotation_matrix\r\n\t\tnewRotationZ = function(self, a)\r\n\t\t\treturn Matrix3:new(\r\n\t\t\t\t\tmath.cos(a), -math.sin(a), 0.,\r\n\t\t\t\t\tmath.sin(a), math.cos(a), 0.,\r\n\t\t\t\t\t0., 0., 1.\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Create a new axis rotation matrix from the vector and angle (in radians)\r\n\t\t-- @param v Vector3\r\n\t\t-- @param a number\r\n\t\t-- @return Matrix3\r\n\t\t-- @see\r\n\t\tnewRotationAxis = function(self, v, a)\r\n\t\t\tlocal cosa = math.cos(a)\r\n\t\t\tlocal sina = math.sin(a)\r\n\t\t\treturn Matrix3:new(\r\n\t\t\t\t\tcosa+(1.-cosa)*v.x*v.x,\r\n\t\t\t\t\t(1.-cosa)*v.x*v.y-sina*v.z,\r\n\t\t\t\t\t(1.-cosa)*v.x*v.z+sina*v.y,\r\n\r\n\t\t\t\t\t(1.-cosa)*v.y*v.x+sina*v.z,\r\n\t\t\t\t\tcosa+(1.-cosa)*v.y*v.y,\r\n\t\t\t\t\t(1.-cosa)*v.y*v.z-sina*v.x,\r\n\r\n\t\t\t\t\t(1.-cosa)*v.z*v.x-sina*v.y,\r\n\t\t\t\t\t(1.-cosa)*v.z*v.y+sina*v.x,\r\n\t\t\t\t\tcosa+(1.-cosa)*v.z*v.z\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Create a new rotation matrix from the yaw-pitch-roll vector\r\n\t\t-- @param v Vector3 where x = yaw, y = pitch, z = roll\r\n\t\t-- @return Matrix3\r\n\t\t-- @see https://en.wikipedia.org/wiki/Aircraft_principal_axes\r\n\t\tnewRotationYawPitchRoll = function(self, v)\r\n\t\t\tlocal cosa = math.cos(v.x)\r\n\t\t\tlocal sina = math.sin(v.x)\r\n\t\t\tlocal cosb = math.cos(v.y)\r\n\t\t\tlocal sinb = math.sin(v.y)\r\n\t\t\tlocal cosy = math.cos(v.z)\r\n\t\t\tlocal siny = math.sin(v.z)\r\n\t\t\treturn Matrix3:new(\r\n\t\t\t\t\tcosa*cosb,\r\n\t\t\t\t\tcosa*sinb*siny-sina*cosy,\r\n\t\t\t\t\tcosa*sinb*cosy+sina*siny,\r\n\r\n\t\t\t\t\tsina*cosb,\r\n\t\t\t\t\tsina*sinb*siny+cosa*cosy,\r\n\t\t\t\t\tsina*sinb*cosy-cosa*siny,\r\n\r\n\t\t\t\t\t-sinb,\r\n\t\t\t\t\tcosb*siny,\r\n\t\t\t\t\tcosb*cosy\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t__eq = function(self, that)\r\n\t\t\treturn self.m11 == that.m11 and self.m12 == that.m12 and self.m13 == that.m13\r\n\t\t\t\t\tand self.m21 == that.m21 and self.m22 == that.m22 and self.m23 == that.m23\r\n\t\t\t\t\tand self.m31 == that.m31 and self.m32 == that.m32 and self.m33 == that.m33\r\n\t\tend,\r\n\r\n\t\t-- Matrix multiplication\r\n\t\t__mul = function(self, that)\r\n\t\t\treturn Matrix3:new(\r\n\t\t\t\t\tself.m11*that.m11+self.m21*that.m12+self.m31*that.m13,\r\n\t\t\t\t\tself.m12*that.m11+self.m22*that.m12+self.m32*that.m13,\r\n\t\t\t\t\tself.m13*that.m11+self.m23*that.m12+self.m33*that.m13,\r\n\r\n\t\t\t\t\tself.m11*that.m21+self.m21*that.m22+self.m31*that.m23,\r\n\t\t\t\t\tself.m12*that.m21+self.m22*that.m22+self.m32*that.m23,\r\n\t\t\t\t\tself.m13*that.m21+self.m23*that.m22+self.m33*that.m23,\r\n\r\n\t\t\t\t\tself.m11*that.m31+self.m21*that.m32+self.m31*that.m33,\r\n\t\t\t\t\tself.m12*that.m31+self.m22*that.m32+self.m32*that.m33,\r\n\t\t\t\t\tself.m13*that.m31+self.m23*that.m32+self.m33*that.m33\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t__tostring = function(self)\r\n\t\t\treturn \"{ \\n  \" .. tostring(self.m11) .. \", \" .. tostring(self.m12) .. \", \" .. tostring(self.m13) .. \"\\n\"\r\n\t\t\t\t\t.. \"  \" .. tostring(self.m21) .. \", \" .. tostring(self.m22) .. \", \" .. tostring(self.m23) .. \"\\n\"\r\n\t\t\t\t\t.. \"  \" .. tostring(self.m31) .. \", \" .. tostring(self.m32) .. \", \" .. tostring(self.m33) .. \"\\n}\"\r\n\t\tend,\r\n\t}\r\n\tMatrix3.__index = Matrix3\r\n\r\n\r\n\r\n\r\n\t-- 4x4 Matrix ====================\r\n\tMatrix4 = {\r\n\t\t-- m11, m12, m13, m14\r\n\t\t-- m21, m22, m23, m24\r\n\t\t-- m31, m32, m33, m34\r\n\t\t-- m41, m42, m43, m44\r\n\r\n\t\t-- Create a new matrix from coords. Skip coords to create a zero matrix\r\n\t\t-- @return Matrix4\r\n\t\tnew = function(self,\r\n\t\t               m11, m12, m13, m14,\r\n\t\t               m21, m22, m23, m24,\r\n\t\t               m31, m32, m33, m34,\r\n\t\t               m41, m42, m43, m44\r\n\t\t)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.m11 = m11 or 0.\r\n\t\t\to.m12 = m12 or 0.\r\n\t\t\to.m13 = m13 or 0.\r\n\t\t\to.m14 = m14 or 0.\r\n\t\t\to.m21 = m21 or 0.\r\n\t\t\to.m22 = m22 or 0.\r\n\t\t\to.m23 = m23 or 0.\r\n\t\t\to.m24 = m24 or 0.\r\n\t\t\to.m31 = m31 or 0.\r\n\t\t\to.m32 = m32 or 0.\r\n\t\t\to.m33 = m33 or 0.\r\n\t\t\to.m34 = m34 or 0.\r\n\t\t\to.m41 = m41 or 0.\r\n\t\t\to.m42 = m42 or 0.\r\n\t\t\to.m43 = m43 or 0.\r\n\t\t\to.m44 = m44 or 0.\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Copy matrix from another 4x4 matrix\r\n\t\t-- @param Matrix4 that\r\n\t\t-- @return Matrix4\r\n\t\tcopyFrom = function(self, that)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.m11 = that.m11\r\n\t\t\to.m12 = that.m12\r\n\t\t\to.m13 = that.m13\r\n\t\t\to.m14 = that.m14\r\n\t\t\to.m21 = that.m21\r\n\t\t\to.m22 = that.m22\r\n\t\t\to.m23 = that.m23\r\n\t\t\to.m24 = that.m24\r\n\t\t\to.m31 = that.m31\r\n\t\t\to.m32 = that.m32\r\n\t\t\to.m33 = that.m33\r\n\t\t\to.m34 = that.m34\r\n\t\t\to.m41 = that.m41\r\n\t\t\to.m42 = that.m42\r\n\t\t\to.m43 = that.m43\r\n\t\t\to.m44 = that.m44\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Creates a 4x4 matrix from 3x3 matrix\r\n\t\t-- @param Matrix3 that\r\n\t\t-- @return Matrix4\r\n\t\tcopyFrom3 = function(self, that)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.m11 = that.m11\r\n\t\t\to.m12 = that.m12\r\n\t\t\to.m13 = that.m13\r\n\t\t\to.m14 = 0.\r\n\t\t\to.m21 = that.m21\r\n\t\t\to.m22 = that.m22\r\n\t\t\to.m23 = that.m23\r\n\t\t\to.m24 = 0.\r\n\t\t\to.m31 = that.m31\r\n\t\t\to.m32 = that.m32\r\n\t\t\to.m33 = that.m33\r\n\t\t\to.m34 = 0.\r\n\t\t\to.m41 = 0.\r\n\t\t\to.m42 = 0.\r\n\t\t\to.m43 = 0.\r\n\t\t\to.m44 = 1.\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Create a new identity matrix\r\n\t\t-- @return Matrix4\r\n\t\tnewIdentity = function(self)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.m11 = 1.\r\n\t\t\to.m12 = 0.\r\n\t\t\to.m13 = 0.\r\n\t\t\to.m14 = 0.\r\n\t\t\to.m21 = 0.\r\n\t\t\to.m22 = 1.\r\n\t\t\to.m23 = 0.\r\n\t\t\to.m24 = 0.\r\n\t\t\to.m31 = 0.\r\n\t\t\to.m32 = 0.\r\n\t\t\to.m33 = 1.\r\n\t\t\to.m34 = 0.\r\n\t\t\to.m41 = 0.\r\n\t\t\to.m42 = 0.\r\n\t\t\to.m43 = 0.\r\n\t\t\to.m44 = 1.\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\r\n\t\t__eq = function(self, that)\r\n\t\t\treturn self.m11 == that.m11 and self.m12 == that.m12 and self.m13 == that.m13 and self.m14 == that.m14\r\n\t\t\t\t\tand self.m21 == that.m21 and self.m22 == that.m22 and self.m23 == that.m23 and self.m24 == that.m24\r\n\t\t\t\t\tand self.m31 == that.m31 and self.m32 == that.m32 and self.m33 == that.m33 and self.m34 == that.m34\r\n\t\t\t\t\tand self.m41 == that.m41 and self.m42 == that.m42 and self.m43 == that.m43 and self.m44 == that.m44\r\n\t\tend,\r\n\r\n\t\t-- Matrix multiplication\r\n\t\t__mul = function(self, that)\r\n\t\t\treturn Matrix4:new(\r\n\t\t\t\t\tself.m11*that.m11+self.m21*that.m12+self.m31*that.m13+self.m41*that.m14,\r\n\t\t\t\t\tself.m12*that.m11+self.m22*that.m12+self.m32*that.m13+self.m42*that.m14,\r\n\t\t\t\t\tself.m13*that.m11+self.m23*that.m12+self.m33*that.m13+self.m43*that.m14,\r\n\t\t\t\t\tself.m14*that.m11+self.m24*that.m12+self.m34*that.m13+self.m44*that.m14,\r\n\r\n\t\t\t\t\tself.m11*that.m21+self.m21*that.m22+self.m31*that.m23+self.m41*that.m24,\r\n\t\t\t\t\tself.m12*that.m21+self.m22*that.m22+self.m32*that.m23+self.m42*that.m24,\r\n\t\t\t\t\tself.m13*that.m21+self.m23*that.m22+self.m33*that.m23+self.m43*that.m24,\r\n\t\t\t\t\tself.m14*that.m21+self.m24*that.m22+self.m34*that.m23+self.m44*that.m24,\r\n\r\n\t\t\t\t\tself.m11*that.m31+self.m21*that.m32+self.m31*that.m33+self.m41*that.m34,\r\n\t\t\t\t\tself.m12*that.m31+self.m22*that.m32+self.m32*that.m33+self.m42*that.m34,\r\n\t\t\t\t\tself.m13*that.m31+self.m23*that.m32+self.m33*that.m33+self.m43*that.m34,\r\n\t\t\t\t\tself.m14*that.m31+self.m24*that.m32+self.m34*that.m33+self.m44*that.m34,\r\n\r\n\t\t\t\t\tself.m11*that.m41+self.m21*that.m42+self.m31*that.m43+self.m41*that.m44,\r\n\t\t\t\t\tself.m12*that.m41+self.m22*that.m42+self.m32*that.m43+self.m42*that.m44,\r\n\t\t\t\t\tself.m13*that.m41+self.m23*that.m42+self.m33*that.m43+self.m43*that.m44,\r\n\t\t\t\t\tself.m14*that.m41+self.m24*that.m42+self.m34*that.m43+self.m44*that.m44\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t__tostring = function(self)\r\n\t\t\treturn \"{ \\n  \"..tostring(self.m11)..\", \"..tostring(self.m12)..\", \"..tostring(self.m13)..\", \"..tostring(self.m14)..\"\\n\"\r\n\t\t\t\t\t..\"  \"..tostring(self.m21)..\", \"..tostring(self.m22)..\", \"..tostring(self.m23)..\", \"..tostring(self.m24)..\"\\n\"\r\n\t\t\t\t\t..\"  \"..tostring(self.m31)..\", \"..tostring(self.m32)..\", \"..tostring(self.m33)..\", \"..tostring(self.m34)..\"\\n\"\r\n\t\t\t\t\t..\"  \"..tostring(self.m41)..\", \"..tostring(self.m42)..\", \"..tostring(self.m43)..\", \"..tostring(self.m44)..\"\\n}\"\r\n\t\tend,\r\n\t}\r\n\tMatrix4.__index = Matrix4\r\n\r\n\r\n\r\n\r\n\t-- Projections ====================\r\n\t-- Screen aspect ratio\r\n\tlocal screenWidth = 0.544\r\n\tlocal screenHeight = 0.302\r\n\tlocal radToDeg = 180.0 / math.pi\r\n\tlocal degToRad = math.pi / 180.0\r\n\r\n\t-- Builds a perspective projection matrix based on a field of view.\r\n\t-- @return Matrix4\r\n\t-- @see https://docs.microsoft.com/en-us/windows/win32/direct3d9/d3dxmatrixperspectivefovlh\r\n\tlocal matrix4perspective1 = function(fovy, Aspect, zn, zf)\r\n\t\treturn Matrix4:new(2*zn/fovy,0,0,0,0,2*zn/Aspect,0,0,0,0,zf/(zf-zn),1,0,0,zn*zf/(zn-zf),0)\r\n\tend\r\n\r\n\t-- Builds a customized perspective projection matrix\r\n\t-- @return Matrix4\r\n\t-- @see https://docs.microsoft.com/en-us/windows/win32/direct3d9/d3dxmatrixperspectiveoffcenterlh\r\n\tlocal matrix4Perspective2 = function(n, f, r, l, t, b)\r\n\t\treturn Matrix4:new(2*n/(r-l), 0, (r+l)/(r-l), 0, 0, 2*n/(t-b), (t+b)/(t-b), 0, 0, 0, -(f+n)/(f-n), -2*f*n/(f-n), 0, 0, -1, 0)\r\n\tend\r\n\r\n\t-- Builds a look-at matrix\r\n\t-- @param PosCamera Vector3\r\n\t-- @param AxisX Vector3\r\n\t-- @param AxisY Vector3\r\n\t-- @param AxisZ Vector3\r\n\t-- @return Matrix4\r\n\t-- @see https://docs.microsoft.com/en-us/windows/win32/direct3d9/d3dxmatrixlookatlh\r\n\tlocal matrix4Look = function(PosCamera, AxisX, AxisY, AxisZ)\r\n\t\treturn Matrix4:new(AxisX.x,AxisY.x,AxisZ.x,0,AxisX.y,AxisY.y,AxisZ.y,0,AxisX.z,AxisY.z,AxisZ.z,0,-AxisX:dotProduct(PosCamera),-AxisY:dotProduct(PosCamera),-AxisZ:dotProduct(PosCamera),1)\r\n\tend\r\n\r\n\r\n\r\n\t-- Camera ====================\r\n\t-- Game camera projection state with eye and target\r\n\t-- @see https://knowledge.autodesk.com/support/3ds-max/learn-explore/caas/CloudHelp/cloudhelp/2017/ENU/3DSMax/files/GUID-B1F4F126-65AC-4CB6-BDC3-02799A0BAEF3-htm.html\r\n\tCamera = {\r\n\r\n\t\t-- Creates a new camera\r\n\t\t-- @param initialZ initial z-offset (optional), can be retrieved from GetCameraTargetPositionZ()\r\n\t\tnew = function(self, initialZ)\r\n\t\t\tlocal o = {}\r\n\t\t\tsetmetatable(o,self)\r\n\t\t\to.changed = false\r\n\t\t\to.initialZ = initialZ or 0.\r\n\t\t\to.eye = Vector3:new(0.0, -922.668, o.initialZ+1367.912)\r\n\t\t\to.target = Vector3:new(0, 0, o.initialZ)\r\n\t\t\to.distance = 0.\r\n\t\t\to.yaw = 0.\r\n\t\t\to.pitch = 0.\r\n\t\t\to.roll = 0.\r\n\t\t\to.axisX = Vector3:new()\r\n\t\t\to.axisY = Vector3:new()\r\n\t\t\to.axisZ = Vector3:new()\r\n\t\t\to.view = Matrix4:new()\r\n\t\t\to.projection = matrix4Perspective2(0.5, 10000, -screenWidth/2, screenWidth/2, -screenHeight/2, screenHeight/2)\r\n\t\t\to:_updateDistanceYawPitch()\r\n\t\t\to:_updateAxisMatrix()\r\n\r\n\t\t\treturn o\r\n\t\tend,\r\n\r\n\t\t-- Converts window coordinate to world coordinate\r\n\t\t-- @param v Vector3 where x and y - window coords and z - overlay range\r\n\t\t-- @return Vector3\r\n\t\twindowToWorld = function(self, v)\r\n\t\t\treturn Vector3:new(\r\n\t\t\t\t\tself.eye.x+self.axisZ.x*v.z+v.x*self.axisX.x*screenWidth*v.z+v.y*self.axisY.x*screenHeight*v.z,\r\n\t\t\t\t\tself.eye.y+self.axisZ.y*v.z+v.x*self.axisX.y*screenWidth*v.z+v.y*self.axisY.y*screenHeight*v.z,\r\n\t\t\t\t\tself.eye.z+self.axisZ.z*v.z+v.x*self.axisX.z*screenWidth*v.z+v.y*self.axisY.z*screenHeight*v.z\r\n\t\t\t)\r\n\t\tend,\r\n\r\n\t\t-- Converts world coordinate to window coordinate\r\n\t\t-- @param v Vector3\r\n\t\t-- @return Vector3\r\n\t\tworldToWindow = function(self, v)\r\n\t\t\tv = v:transform4(self.view):transform4(self.projection)\r\n\t\t\tv.z = math.abs(v.z)\r\n\t\t\treturn v\r\n\t\tend,\r\n\r\n\t\t-- @param v Vector3\r\n\t\tsetPosition = function(self, v)\r\n\t\t\tself.eye = self.eye + (v - self.target)\r\n\t\t\tself.target = Vector3:newFrom(v)\r\n\t\t\tself.changed = true\r\n\t\tend,\r\n\r\n\t\t-- @param eye Vector3\r\n\t\t-- @param target Vector3\r\n\t\tsetEyeAndTarget = function(self, eye, target)\r\n\t\t\tself.eye = Vector3:newFrom(eye)\r\n\t\t\tself.target = Vector3:newFrom(target)\r\n\t\t\tself:_updateDistanceYawPitch()\r\n\t\t\tself:_updateAxisMatrix()\r\n\t\t\tself.changed = true\r\n\t\tend,\r\n\r\n\t\t-- @param v Vector3 where x = yaw, y = pitch, z = roll\r\n\t\t-- @param eyeLock boolean - move target instead of eye\r\n\t\tsetYawPitchRoll = function(self, v, eyeLock)\r\n\t\t\tlocal XY = self.distance*math.cos(v.y)\r\n\t\t\tlocal modifier = Vector3:new(\r\n\t\t\t\t\tXY*math.cos(v.x),\r\n\t\t\t\t\tXY*math.sin(v.x),\r\n\t\t\t\t\tself.distance*math.sin(v.y)\r\n\t\t\t)\r\n\t\t\tself.yaw = v.x\r\n\t\t\tself.pitch = v.y\r\n\t\t\tself.roll = v.z\r\n\t\t\tif(eyeLock) then\r\n\t\t\t\tself.target = self.eye + modifier\r\n\t\t\telse\r\n\t\t\t\tself.eye = self.target - modifier\r\n\t\t\tend\r\n\t\t\tself:_updateAxisMatrix()\r\n\t\t\tself.changed = true\r\n\t\tend,\r\n\r\n\t\t-- uses warcraft native functions\r\n\t\t-- @param thePlayer Player\r\n\t\t-- @param skipChangedFlag boolean. Set to true to deny .changed flag unsetting\r\n\t\tapplyCameraToPlayer = function(self, thePlayer, skipChangedFlag)\r\n\t\t\tif(GetLocalPlayer() == thePlayer) then\r\n\t\t\t\tSetCameraField(CAMERA_FIELD_ROTATION, self.yaw*radToDeg, 0)\r\n\t\t\t\tSetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK, self.pitch*radToDeg, 0)\r\n\t\t\t\tSetCameraField(CAMERA_FIELD_ROLL, self.roll*radToDeg, 0)\r\n\t\t\t\tSetCameraField(CAMERA_FIELD_TARGET_DISTANCE, self.distance, 0)\r\n\t\t\t\t-- call SetCameraTargetController(AtUnit, self.target.x, self.target.y, false)\r\n\t\t\t\tSetCameraField(CAMERA_FIELD_ZOFFSET, self.target.z-self.initialZ, 0)\r\n\t\t\tend\r\n\t\t\tif(not skipChangedFlag) then\r\n\t\t\t\tself.changed = false\r\n\t\t\tend\r\n\t\tend,\r\n\r\n\t\t-- internal use methods\r\n\t\t_updateDistanceYawPitch = function(self)\r\n\t\t\tlocal delta = (self.target - self.eye)\r\n\t\t\tself.distance = delta:length()\r\n\t\t\tself.yaw = Atan2(delta.y, delta.x)\r\n\t\t\tself.pitch = Atan2(delta.z, delta:length2d())\r\n\t\tend,\r\n\r\n\t\t_updateAxisMatrix = function(self)\r\n\t\t\tself.axisZ = (self.target - self.eye):normalize()\r\n\t\t\tlocal mRotation = Matrix3:newRotationAxis(self.axisZ, -self.roll)\r\n\t\t\tself.axisX = self.axisZ:crossProduct(Vector3:newUp()):normalize()\r\n\t\t\tself.axisY = self.axisX:crossProduct(self.axisZ):transform3(mRotation)\r\n\t\t\tself.axisX = self.axisX:transform3(mRotation)\r\n\t\t\tself.view = matrix4Look(self.eye, self.axisX, self.axisY, self.axisZ)\r\n\t\tend\r\n\t}\r\n\tCamera.__index = Camera\r\n\r\n\tlocal wGeometry = {\r\n\t\tFunctions = Functions,\r\n\t\tVector3 = Vector3,\r\n\t\tMatrix3 = Matrix3,\r\n\t\tMatrix4 = Matrix4,\r\n\t\tmatrix4perspective1 = matrix4perspective1,\r\n\t\tmatrix4Perspective2 = matrix4Perspective2,\r\n\t\tmatrix4Look = matrix4Look,\r\n\t\tCamera = Camera,\r\n\t\tunlockUnitZ = unlockUnitZ\r\n\t}\r\n\texportDefault(wGeometry)\r\n\texport(wGeometry)\r\nend)\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 22.02.2020 19:51\r\n---\r\nfunction StartMainTheme()\r\n\t--print(\"играй музыка1\")\r\n\tTimerStart(CreateTimer(), 1, false, function()\r\n\t\t--print(\"играй музыка2\")\r\n\t\t--PlayThematicMusicBJ(\"NewMusic/Brandberg - Anubis.mp3;NewMusic/Deficio - Egyptica.mp3\")\r\n\t\t--PlayMusicBJ(\"NewMusic/Brandberg - Anubis.mp3;NewMusic/Deficio - Egyptica.mp3\")\r\n\t\t--PlayThematicMusicBJ(\"NewMusic/Deficio - Egyptica.mp3\")--работает\r\n\tend)\r\nend\r\n\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 21.02.2020 23:45\r\n---\r\n\r\nSawDiskModel=\"Chakram_02.mdl\"--\"Abilities\\\\Weapons\\\\SentinelMissile\\\\SentinelMissile.mdl\"\r\nSawChainModel=\"abilities\\\\weapons\\\\wyvernspear\\\\wyvernspearmissile.mdl\"\r\nfunction CreateRoundSawZ(hero,ChainCount,angle,z)\r\n\tlocal xs,ys=GetUnitXY(hero)\r\n\tlocal saw=AddSpecialEffect(SawDiskModel,xs,ys)\r\n\tlocal chain={}\r\n\tlocal step=60\r\n\tlocal SpeedRandomFactor=GetRandomReal(-1,1)\r\n\tlocal speed=3+SpeedRandomFactor\r\n\tif z==nil then z=GetUnitZ(hero)+30 end\r\n\tif angle==nil then angle=0 end\r\n\tfor i=1,ChainCount do\r\n\t\tchain[i]=AddSpecialEffect(SawChainModel,xs,ys)\r\n\t\t--print(\"создан кусок цепи \"..i)\r\n\tend\r\n\t-- установки\r\n\tBlzSetSpecialEffectScale(saw,0.9)\r\n\r\n\tTimerStart(CreateTimer(), TIMER_PERIOD, true, function()\r\n\t\tlocal x,y=0,0\r\n\t\tfor i=1,ChainCount do\r\n\t\t\tx,y=MoveXY(xs,ys,step*i,angle)\r\n\t\t\tBlzSetSpecialEffectPosition(chain[i],x,y,z)\r\n\t\t\tBlzSetSpecialEffectYaw(chain[i],math.rad(angle))\r\n\t\tend\r\n\t\tlocal nx,ny=MoveXY(xs,ys,step*ChainCount,angle)\r\n\t\tBlzSetSpecialEffectPosition(saw,nx,ny,z)\r\n\t\tUnitDamageArea(hero,20,nx,ny,150,z-90,\"Abilities/Weapons/AncestralGuardianMissile/AncestralGuardianMissile.mdl\")\r\n\t\tangle=angle+speed\r\n\t\tif UnitAlive(hero)==false then\r\n\t\t\tDestroyTimer(GetExpiredTimer()) -- временно вечный таймер\r\n\t\t\tDestroyEffect(saw)\r\n\t\t\tfor i=1,ChainCount do\r\n\t\t\t\tDestroyEffect(chain[i])\r\n\t\t\tend\r\n\t\tend\r\n\tend)\r\nend\r\n\r\nfunction StartAllSaw()\r\n\tlocal e--временный юнит\r\n\tlocal k=0\r\n\tlocal id=FourCC('h001')\r\n\tGroupEnumUnitsInRect(perebor,bj_mapInitialPlayableArea,nil)\r\n\twhile true do\r\n\t\te = FirstOfGroup(perebor)\r\n\t\tif e == nil then break end\r\n\t\tif UnitAlive(e) and GetUnitTypeId(e)==id then\r\n\t\t\tk=k+1\r\n\t\t\tCreateRoundSawZ(e,6,GetRandomInt(0,360))\r\n\t\tend\r\n\t\tGroupRemoveUnit(perebor,e)\r\n\tend\r\n\t--print(\"Запущено пил: \"..k)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 21.02.2020 20:39\r\n\r\nfunction Enter00()\r\n\tlocal trg_InCombatZone = CreateTrigger()\r\n\tTriggerRegisterEnterRectSimple(trg_InCombatZone, gg_rct_Combat0Zone)\r\n\tTriggerAddAction(trg_InCombatZone, function ()\r\n\t\tlocal x,y=GetRectCenterX(gg_rct_Combat0Zone),GetRectCenterY(gg_rct_Combat0Zone)\r\n\t\tlocal temp=CreateGroup()\r\n\t\t--print(\"вошел в зону боя\")\r\n\t\tDisableTrigger(GetTriggeringTrigger())\r\n\t\tfor i=1, 3 do\r\n\t\t\tlocal new=CreateUnit(Player(11), FourCC('u000'), x, y, 0)\r\n\t\t\tStartSheepAI(new)\r\n\t\t\tGroupAddUnit(temp,new)\r\n\t\tend\r\n\t\tTimerStart(CreateTimer(), 1, true, function()\r\n\t\t\tif IsUnitGroupDeadBJ(temp) then\r\n\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t\tDestroyGroup(temp)\r\n\t\t\t\t--print(\"мертвы, открываем ворота\")\r\n\t\t\t\tQuestMessageBJ(GetPlayersAllies(Player(0)), bj_QUESTMESSAGE_UNITAVAILABLE, \"|cffffff00Враги уничтожены:|r путь свободен\")\r\n\t\t\t\tEnumDestructablesInRectAll(gg_rct_Zone02In, function()\r\n\t\t\t\t\tKillDestructable(GetEnumDestructable())\r\n\t\t\t\tend)\r\n\t\t\t\tEnumDestructablesInRectAll(gg_rct_Zone02Out, function()\r\n\t\t\t\t\tKillDestructable(GetEnumDestructable())\r\n\t\t\t\tend)\r\n\t\t\tend\r\n\t\tend)\r\n\tend)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 23.02.2020 20:49\r\n\r\nfunction InMineWay()\r\n\tlocal gg_trg_InMineWay = CreateTrigger()\r\n\tTriggerRegisterEnterRectSimple(gg_trg_InMineWay, gg_rct_Zone03In)\r\n\tTriggerAddAction(gg_trg_InMineWay, function()\r\n\t\tprint(\"баржа отправляется в путь\")\r\n\t\tDisableTrigger(GetTriggeringTrigger())\r\n\t\tlocal barga=FindUnitOfType(FourCC('o001'),1000,GetUnitXY(GetTriggerUnit()))\r\n\t\tUnitAddAbility(barga,FourCC('Avul'))\r\n\t\tlocal xs,ys=GetUnitXY(barga)\r\n\t\tlocal x,y=GetRectCenterX(gg_rct_Zone03Out),GetRectCenterY(gg_rct_Zone03Out)\r\n\t\tIssuePointOrder(barga,\"move\",x,y)\r\n\t\tTimerStart(CreateTimer(), 1, true, function()\r\n\t\t\tif GetUnitCurrentOrder(barga)==0 then\r\n\t\t\t\tIssuePointOrder(barga,\"move\",x,y)\r\n\t\t\tend\r\n\t\t\tif GetUnitCurrentOrder(barga)~=String2OrderIdBJ(\"move\") then\r\n\t\t\t\t--print(\"остановка \"..GetUnitCurrentOrder(barga)..OrderId2String(GetUnitCurrentOrder(barga)))\r\n\t\t\tend\r\n\t\t\t--print(\"Созданамина\")\r\n\t\t\tCreateBarrel(barga,GetUnitFacing(barga)-180,100)\r\n\t\t\tif IsUnitInRangeXY(barga,x,y,250)  then\r\n\t\t\t\tif GetDestructableLife(gg_dest_B000_0131) <= 0 then\r\n\t\t\t\t\t--print(\"конец\")\r\n\t\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t\tend\r\n\t\t\t\tIssuePointOrder(barga,\"move\",xs,ys)\r\n\t\t\t\t--print(\"назад\")\r\n\t\t\tend\r\n\t\t\tif IsUnitInRangeXY(barga,xs,ys,200) then\r\n\t\t\t\t--print(\"вперёд\")\r\n\t\t\t\tIssuePointOrder(barga,\"move\",x,y)\r\n\t\t\tend\r\n\t\tend)\r\n\tend)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 16.02.2020 18:42\r\n---\r\nfunction InitZone0()\r\n\tlocal x,y=GetRectCenterX(gg_rct_SingleTorrentZone),GetRectCenterY(gg_rct_SingleTorrentZone)\r\n\tTimerStart(CreateTimer(), 5, true, function()\r\n\t\tCreateTorrent(x,y,4,500)\r\n\tend)\r\n\tlocal WaterBirth =AddSpecialEffect(\"Whirlpool\",x,y)\r\n\tBlzPlaySpecialEffect(WaterBirth,ANIM_TYPE_BIRTH)\r\n\t--перечисляем все регистрации\r\n\tEnter00()\r\n\tStartAllSaw()\r\n\tActivatedAllTower()\r\n\tInMineWay()\r\n\tInitZone1()--- временно потом перенести в другое место\r\n\tInitZone2()\r\n\tInitZone3()\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 23.02.2020 20:49\r\n\r\nfunction DeeperShip()\r\n\tlocal ThisTrigger = CreateTrigger()\r\n\tTriggerRegisterEnterRectSimple(ThisTrigger, gg_rct_DeapZone1)\r\n\tTriggerAddAction(ThisTrigger, function()\r\n\t\t--print(\"Создаём перевернутые корабли\")\r\n\t\tDisableTrigger(GetTriggeringTrigger())\r\n\t\tlocal x,y\r\n\t\tfor i=1, 5 do\r\n\t\t\tx,y=GetRandomReal(GetRectMinX(gg_rct_DeapZone1), GetRectMaxX(gg_rct_DeapZone1)), GetRandomReal(GetRectMinY(gg_rct_DeapZone1), GetRectMaxY(gg_rct_DeapZone1))\r\n\t\t\tlocal new=CreateUnit(Player(11), FourCC('u001'), x, y, 0)\r\n\t\t\tMakeShipDeep(new)\r\n\t\tend\r\n\r\n\tend)\r\nend\r\n\r\n\r\nfunction MakeShipDeep(hero)\r\n\tSetUnitAnimation(hero,\"Death\")\r\n\tSetUnitTimeScale(hero,10)\r\n\tTimerStart(CreateTimer(), 2.1/10, false, function()\r\n\t\tSetUnitTimeScale(hero,0)\r\n\t\tTimerStart(CreateTimer(), 3.7, false, function()\r\n\t\t\tStartSheepAIDeepAggressor(hero)\r\n\t\tend)\r\n\tend)\r\nend\r\n\r\nfunction StartSheepAIDeepAggressor(hero)\r\n\tif UnitAI[GetHandleId(hero)]==nil then\r\n\t\t--\tprint(\"Запущен первый прототип ИИ\")\r\n\telse\r\n\t\t--print(\"ОШИБКА, НЕВОЗМОЖНО ИЗМЕНИТЬ ТИП ИИ или добавить повторно\")\r\n\t\treturn\r\n\tend\r\n\tUnitAI[GetHandleId(hero)]={\r\n\t\tIsMove=true,\r\n\t\tIsAttack=false,\r\n\t\t--IsEscape=false,\r\n\t\tRandomTimeFactor=GetRandomReal(-.5,.5),\r\n\t\txai=GetUnitX(hero),\r\n\t\tyai=GetUnitY(hero),\r\n\t\tenemy=nil\r\n\t}\r\n\tlocal data=UnitAI[GetHandleId(hero)]\r\n\tTimerStart(CreateTimer(), ReactionAI+data.RandomTimeFactor, true, function()--поиск врага 1 секунда по умлочанию\r\n\t\tlocal e=nil\r\n\t\tlocal x,y=GetUnitXY(hero)\r\n\t\tlocal enemy=nil\r\n\t\t--local HasTarget=false\r\n\t\tGroupEnumUnitsInRange(perebor,x,y,600,nil)\r\n\t\twhile true do\r\n\t\t\te = FirstOfGroup(perebor)\r\n\t\t\tif e == nil then break end\r\n\t\t\tif UnitAlive(e) and IsUnitEnemy(e,GetOwningPlayer(hero)) and IsUnitType(e,UNIT_TYPE_HERO) and not data.enemy and IsUnitVisible(e,GetOwningPlayer(hero)) then--\r\n\t\t\t\t\tenemy=e\r\n\t\t\t\t\t--print(\"поиск всех целей под условиями\")\r\n\t\t\t\tif data.IsAttack==false then\r\n\r\n\t\t\t\t\tSetUnitTimeScale(hero,-0.5)\r\n\t\t\t\t\tSetUnitAnimation(hero,\"Death\")\r\n\t\t\t\t\t--\r\n\t\t\t\t\tdata.enemy=enemy\r\n\t\t\t\tend\r\n\t\t\t\tdata.IsAttack=true\r\n\r\n\t\t\tend\r\n\t\t\tGroupRemoveUnit(perebor,e)\r\n\t\tend\r\n\r\n\t\tif data.enemy~=nil then\r\n\t\t\t--print(GetUnitName(data.enemy)..\" цель атаки\")\r\n\t\t\tif IsUnitInRange(hero,data.enemy,1000)==false then\r\n\t\t\t\tdata.enemy=nil\r\n\t\t\tend\r\n\t\t\t--local xe,ye=GetUnitXY(enemy)\r\n\t\t\t--IssuePointOrder(hero,\"move\",xe,ye)\r\n\t\t\tif IsUnitInRange(hero,data.enemy,300) then\r\n\t\t\t\tSetUnitFacing(hero,-180+AngleBetweenXY(x,y,GetUnitX(data.enemy),GetUnitY(data.enemy))/bj_DEGTORAD)\r\n\t\t\telse\r\n\t\t\t\tIssueTargetOrder(hero,\"move\",data.enemy)\r\n\t\t\tend\r\n\t\t\tSingleCannon(hero)\r\n\t\telse\r\n\r\n\t\t\tif data.IsAttack and data.enemy==nil then\r\n\t\t\t\tdata.IsAttack=false\r\n\t\t\t\tMakeShipDeep(hero)\r\n\t\t\tend\r\n\r\n\t\tend\r\n\t\tif UnitAlive(hero)==false then\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tSetUnitTimeScale(hero,1)\r\n\t\t\tSetUnitAnimation(hero,\"Death\")\r\n\t\t\t--\tprint(\"умираю....\")\r\n\t\t\tTimerStart(CreateTimer(), 60, false, function()\r\n\t\t\t\tlocal new=CreateUnit(Player(11), FourCC('u001'), data.xai, data.yai, 0)\r\n\t\t\t\tMakeShipDeep(new)\r\n\t\t\tend)\r\n\t\tend\r\n\tend)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 07.03.2020 0:35\r\n---\r\n\r\nfunction MineReplacer()--ужасно, больше так не буду делать, мозголомание бредовое\r\n\tlocal e=nil\r\n\tlocal k=0\r\n\tlocal id=FourCC('e004')--!!!!!\r\n\t\tGroupEnumUnitsInRect(perebor,bj_mapInitialPlayableArea,nil)\r\n\t\twhile true do\r\n\t\t\te = FirstOfGroup(perebor)\r\n\t\t\tif e == nil then break end\r\n\t\t\tif UnitAlive(e) and GetUnitTypeId(e)==id then\r\n\t\t\t\tlocal x,y=GetUnitXY(e)\r\n\t\t\t\tKillUnit(e)\r\n\t\t\t\tk=k+1\r\n\t\t\t\tCreateDeepMine(x,y)\r\n\t\t\tend\r\n\t\t\tGroupRemoveUnit(perebor,e)\r\n\t\tend\r\n\t\t--print(\"Запущено юнитов мин: \"..k)\r\nend\r\n\r\nfunction CreateDeepMine(x,y)\r\n\tlocal eff=AddSpecialEffect(\"Water Mine\",x,y)\r\n\tBlzSetSpecialEffectZ(eff,-200)\r\n\tTimerStart(CreateTimer(), 0.3, true, function()\r\n\t\tlocal IsContent, hero=PointContentUnit(x,y,100)\r\n\t\tif IsContent and IsUnitZCollision(hero,-90) then\r\n\t\t\t--UnitDamageArea(hero,100,x,y,100,-90)\r\n\t\t\tUnitDamageTarget( hero, hero, 100, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_NORMAL, WEAPON_TYPE_WHOKNOWS )\r\n\t\t\tExplodeEffect(eff,3)\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tTimerStart(CreateTimer(), 60, false, function()\r\n\t\t\t\tCreateDeepMine(x,y)\r\n\t\t\tend)\r\n\t\tend\r\n\tend)\r\nend\r\n\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 11.03.2020 1:03\r\nFirstEnterBoss=false\r\n\r\nfunction BossZoneInit()\r\n\tThisTriggerBoss1 = CreateTrigger()\r\n\tTriggerRegisterEnterRectSimple(ThisTriggerBoss1, gg_rct_BossZone1)\r\n\t--local FirstEnter=false\r\n\tTriggerAddAction(ThisTriggerBoss1, function()\r\n\t\tlocal hero=GetTriggerUnit()\r\n\t\tif IsUnitType(hero,UNIT_TYPE_HERO) then\r\n\t\t\t--print(\"Запускаем Триггер\")\r\n\t\t\tlocal boss=Kraken--FindUnitOfType(FourCC('n004')) -- определение босса\r\n\t\t\tCreateFogModifierRectBJ(true, GetOwningPlayer(hero), FOG_OF_WAR_VISIBLE, gg_rct_BossZone1)\r\n\t\t\tBlzSetUnitMaxHP(boss,10000)\r\n\t\t\tHealUnit(boss,10000)\r\n\t\t\t--DisableTrigger(GetTriggeringTrigger())\r\n\t\t\tEnumDestructablesInRectAll(gg_rct_Boss1Gate, function()\tDestructableRestoreLife(GetEnumDestructable(), GetDestructableMaxLife(GetEnumDestructable()), true) end)\r\n\t\t\tif not FirstEnterBoss then\r\n\t\t\t\tFirstEnterBoss=true\r\n\t\t\t\tStartTentacleBossAI(boss)\r\n\t\t\t--\tprint(\"Запускаем ИИ босса\")\r\n\t\t\tend\r\n\t\tend\r\n\tend)\r\nend\r\nfaze=0\r\nfunction StartTentacleBossAI(hero)\r\n\t--local faze=0\r\n\tlocal bossX,bossY=GetUnitXY(hero)\r\n\tlocal p=GetOwningPlayer(hero)\r\n\r\n\r\n\r\n\tTimerStart(CreateTimer(), 10, true, function()\r\n\t\tfaze=faze+1\r\n\t\t--print(\"Фаза \"..faze)\r\n\t\tif not AnyHeroContainInRect(gg_rct_BossZone1) then\r\n\t\t\t--print(\"Все герои вышли из зоны, восстановление зоны\")\r\n\t\t\tFirstEnterBoss=false\r\n\t\t\tfaze=0\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tEnumDestructablesInRectAll(gg_rct_Boss1Gate, function()\tKillDestructable(GetEnumDestructable())\tend)\r\n\t\t\tCreateFogModifierRectBJ(false, GetOwningPlayer(HERO[0].UnitHero), FOG_OF_WAR_VISIBLE, rect)\r\n\r\n\t\tend\r\n\t\tif faze==1 then -- тентакли из воды\r\n\t\t\tTimerStart(CreateTimer(), 2, true, function()\r\n\t\t\t\t--print(\"Маркер оплетения точки\")\r\n\t\t\t\tlocal e=nil\r\n\t\t\t\tGroupEnumUnitsInRange(perebor, bossX, bossY,1200,nil)\r\n\t\t\t\twhile true do\r\n\t\t\t\t\te = FirstOfGroup(perebor)\r\n\t\t\t\t\tif e == nil then break end\r\n\t\t\t\t\tif UnitAlive(e) and IsUnitEnemy(e,p) then\r\n\t\t\t\t\t\tlocal nx,ny=0,0\r\n\t\t\t\t\t\tfor i=0,5 do\r\n\t\t\t\t\t\t\tnx,ny=MoveXY(GetUnitX(e),GetUnitY(e),200,60*i)\r\n\t\t\t\t\t\t\tCreateTorrent(nx,ny,2)\r\n\t\t\t\t\t\t\tCreateTentacle(hero,nx,ny,5,1)\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\tend\r\n\t\t\t\t\tGroupRemoveUnit(perebor,e)\r\n\t\t\t\tend\r\n\t\t\t\tif faze~=1 or not UnitAlive(hero)  then\r\n\t\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t\tend\r\n\t\t\tend)\r\n\t\telseif faze==2 then\r\n\t\t\tTimerStart(CreateTimer(), 1, true, function()\r\n\t\t\t\t--print(\"Попытки притянуть героев\")\r\n\t\t\t\tlocal e=nil\r\n\t\t\t\tGroupEnumUnitsInRange(perebor, bossX, bossY,1300,nil)\r\n\t\t\t\twhile true do\r\n\t\t\t\t\te = FirstOfGroup(perebor)\r\n\t\t\t\t\tif e == nil then break end\r\n\t\t\t\t\tif UnitAlive(e) and IsUnitEnemy(e,p) then\r\n\t\t\t\t\t\tlocal angle=-180+AngleBetweenXY(GetUnitX(hero),GetUnitY(hero),GetUnitX(e),GetUnitY(e))/bj_DEGTORAD\r\n\t\t\t\t\t\tUnitAddVectorForce(e,angle,5,DistanceBetweenXY(GetUnitX(hero),GetUnitY(hero),GetUnitX(e),GetUnitY(e)))\r\n\t\t\t\t\tend\r\n\t\t\t\t\tGroupRemoveUnit(perebor,e)\r\n\t\t\t\tend\r\n\t\t\t\tif faze~=2  then -- тут так задумано or not UnitAlive(hero)\r\n\t\t\t\t--\tprint(\"конец фазы притягивания\")\r\n\t\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t\tend\r\n\t\t\tend)\r\n\t\telseif faze==3 then --большая шупальца\r\n\t\t\t--Units\\Creeps\\ForgottenOne\\ForgottenOneTent\r\n\t\t\tlocal big=AddSpecialEffect(\"Units\\\\Creeps\\\\ForgottenOne\\\\ForgottenOneTent\",bossX,bossY)\r\n\t\t\tBlzSetSpecialEffectScale(big,1.7)\r\n\t\t\tBlzPlaySpecialEffect(big,ANIM_TYPE_ATTACK)\r\n\t\t\tlocal k=GetRandomInt(0,11)\r\n\t\t\tTimerStart(CreateTimer(), 0.7, false, function()--задержка\r\n\t\t\t\tTimerStart(CreateTimer(), 1, true, function()-- анимация ударов\r\n\t\t\t\t\t--print(\"play\")\r\n\t\t\t\t\tBlzPlaySpecialEffect(big,ANIM_TYPE_ATTACK)\r\n\t\t\t\t\tif faze~=3 or not UnitAlive(hero)  then\r\n\t\t\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t\t\t\tDestroyEffect(big)\r\n\t\t\t\t\tend\r\n\t\t\t\tend)\r\n\t\t\tend)\r\n\t\t\tTimerStart(CreateTimer(), 1, true, function()--удары\r\n\t\t\t\tBlzSetSpecialEffectYaw(big,math.rad(k*30))\r\n\t\t\t\tlocal ax,ay=MoveXY(bossX,bossY,330,k*30)\r\n\t\t\t\tCreateTorrent(ax,ay,3)\r\n\t\t\t\tUnitDamageArea(hero,250,ax,ay,150)\r\n\r\n\t\t\t\t--BlzPlaySpecialEffect(big,ANIM_TYPE_ATTACK)\r\n\r\n\t\t\t\tk=k+1\r\n\t\t\t\t--print(k)\r\n\t\t\t\tif faze~=3 or not UnitAlive(hero)  then\r\n\t\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t\t\tDestroyEffect(big)\r\n\t\t\t\tend\r\n\t\t\tend)\r\n\t\telseif faze==4 then-- буллет хелл\r\n\t\t\tfaze=0\r\n\t\t\tTimerStart(CreateTimer(), 1, true, function()\r\n\t\t\t\t--local angle=GetRandomInt(0,360)\r\n\t\t\t\tlocal factor= GetRandomInt(30,50)\r\n\t\t\t\tfor i=1,12 do\r\n\t\t\t\t\tSingleCannon(hero,factor*i,\"Abilities\\\\Weapons\\\\FireBallMissile\\\\FireBallMissile.mdl\")\r\n\t\t\t\tend\r\n\t\t\t\tif faze~=0 or not UnitAlive(hero)  then\r\n\t\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t\tend\r\n\t\t\tend)\r\n\t\tend\r\n\t\tif not UnitAlive(hero) then\r\n\t\t\tprint(\"Босс умер\")\r\n\t\t\tfaze=0\r\n\t\t\tlocal new=CreateUnit(GetOwningPlayer(boss), FourCC('o000'),bossX ,bossY , GetRandomInt(0,360))\r\n\t\t\tSetUnitTimeScale(new,-1)\r\n\t\t\tSetUnitAnimation(new,\"Death\")\r\n\t\t\tDestroyTrigger(ThisTriggerBoss1)\r\n\t\t\tEnumDestructablesInRectAll(gg_rct_Boss1Gate, function()\tKillDestructable(GetEnumDestructable())\tend)\r\n\t\t\tEnumDestructablesInRectAll(gg_rct_Boss1Gate1, function() KillDestructable(GetEnumDestructable()) end)\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\r\n\t\tend\r\n\tend)\r\nend\r\n\r\nfunction CreateTentacle(boss,x,y,time, delay)\r\n\tlocal new\r\n\tTimerStart(CreateTimer(), delay, false, function()\r\n\t\tnew=CreateUnit(GetOwningPlayer(boss), FourCC('nfgt'), x ,y, GetRandomInt(0,360))\r\n\t\tSetUnitAnimation(new,\"birth\")\r\n\t\tUnitApplyTimedLife(new,GetUnitTypeId(new),time)\r\n\tend)\r\n\r\n\treturn new\r\nend\r\n\r\n\r\nfunction AnyHeroContainInRect(rect)\r\n\tlocal contain=false\r\n\tlocal PIG=1--Player In Game\r\n\tfor i=0,PIG-1 do\r\n\t\tif  RectContainsUnit(rect,HERO[i].UnitHero) then\r\n\t\t\tcontain=true\r\n\t\telse\r\n\t\t\tCreateFogModifierRectBJ(false, GetOwningPlayer(HERO[i].UnitHero), FOG_OF_WAR_VISIBLE, rect)\r\n\t\t\tCreateFogModifierRectBJ(true, GetOwningPlayer(HERO[i].UnitHero), FOG_OF_WAR_MASKED, rect)\r\n\t\t\tCreateFogModifierRectBJ(true, GetOwningPlayer(HERO[i].UnitHero), FOG_OF_WAR_FOGGED, rect)\r\n\t\tend\r\n\tend\r\n\treturn contain\r\nend\r\n\r\nfunction TentacleInFog()\r\n\tTimerStart(CreateTimer(), 10,true, function()\r\n\t\t--print(\"период\")\r\n\t\tif not UnitAlive(Kraken) then\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\tend\r\n\t\tfor i=0,0 do -- 1 раз\r\n\t\t\tlocal hero=HERO[i].UnitHero\r\n\t\t\t--print(\"i=\"..i..GetUnitName(hero))\r\n\t\t\tif not Kraken then print(\"Кракен не определён\") end\r\n\t\t\tif IsUnitInRange(Kraken,hero,2800) or RectContainsCoords(gg_rct_TestFog,GetUnitXY(hero)) then\r\n\t\t\t\t--print(\"призыв\")\r\n\t\t\t\tCreateTorrent(GetUnitXY(hero))\r\n\t\t\t\tCreateTentacle(Kraken,GetUnitX(hero),GetUnitY(hero),10,0.5)\r\n\t\t\tend\r\n\t\tend\r\n\tend)\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 16.02.2020 18:42\r\n---\r\nfunction InitZone1()\r\n\tTimerStart(CreateTimer(), 10, true, function()\r\n\t\t--CreateZombies()\r\n\t\tInitZombies()\r\n\t\t--gg_rct_TestFog\r\n\r\n\tend)\r\n\t--print(\"0\")\r\n\tCreateFogInRect(gg_rct_TestFog)\r\n\tMineReplacer()\r\n\tDeeperShip()\r\n\tKraken=FindUnitOfType(FourCC('n004'))\r\n\tBossZoneInit()\r\n\tTentacleInFog()\r\n\t--Открыть ворота к боссу\r\nend\r\n\r\nfunction CreateFogInRect(rect)\r\n\t--print(\"1\")\r\n\tlocal xMax,yMax=GetRectMaxX(rect),GetRectMaxY(rect)\r\n\tlocal xMin,yMin=GetRectMinX(rect),GetRectMinY(rect)\r\n\tlocal step=70\r\n\tlocal Wide=R2I(math.abs(xMax-xMin)/step)\r\n\tlocal Height=R2I(math.abs(yMax-yMin)/step)\r\n\tlocal xPos,yPos=xMax,yMax\r\n\tlocal fog={}\r\n\t--print(\"x=\"..Wide..\" y=\"..Height)\r\n\tfor i=0,Wide do\r\n\t\txPos=MoveX(xMax,-step*i,0)\r\n\t\t--print(\"Создан туман по х=\"..i)\r\n\t\tfor k=0,Height do\r\n\t\t\tyPos=MoveY(yMax,-step*k,90)\r\n\t\t\t--fog[i]=\r\n\t\t\t--print(\"Создан туман по y=\"..k)\r\n\t\t\tlocal eff =AddSpecialEffect(\"bluegas4\",xPos,yPos) --WaterOrb --bluegas\r\n\t\t\tSetEffectAlphaNearHero(eff)\r\n\t\tend\r\n\tend\r\nend\r\n\r\nfunction SetEffectAlphaNearHero(eff)\r\n\tlocal x,y=BlzGetLocalSpecialEffectX(eff),BlzGetLocalSpecialEffectY(eff)\r\n\tlocal t=CreateTimer()\r\n\tTimerStart(t,0.3, true, function()\r\n\t\tlocal IsContent, hero=PointContentUnit(x,y,450)\r\n\r\n\t\tif IsContent then\r\n\t\t\tlocal xh,yh=GetUnitXY(hero)\r\n\t\t\tlocal xe,ye=BlzGetLocalSpecialEffectX(eff),BlzGetLocalSpecialEffectY(eff)\r\n\t\t\tlocal angle=(AngleBetweenXY(xe,ye,xh,yh)/bj_DEGTORAD)-180\r\n\t\t\t--EffectAddForce(eff,angle,30,500,t)\r\n\r\n\t\t\t--print(angle)\r\n\t\t\tBlzSetSpecialEffectAlpha(eff,80)\r\n\t\t\t--print(\"alpha\")\r\n\t\t\tBlzPlaySpecialEffect(eff,ANIM_TYPE_DEATH)\r\n\t\t\t--DestroyEffect(eff)\r\n\t\t\t--BlzSetSpecialEffectPosition(eff,xn,yn,0)\r\n\t\t\t--DestroyTimer(GetExpiredTimer())\r\n\t\t\t--BlzSetSpecialEffectTime(eff,2300)\r\n\t\t\t--BlzSetSpecialEffectPosition(eff,4000,4000,0)\r\n\t\telse\r\n\t\t\tBlzSetSpecialEffectAlpha(eff,20)\r\n\t\t\tBlzPlaySpecialEffect(eff,ANIM_TYPE_STAND)\r\n\t\t\t--BlzSetSpecialEffectPosition(eff,x,y,0)\r\n\t\tend\r\n\t\tif not eff then\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tprint(\"ссылка таймера уничтожена\")\r\n\t\tend\r\n\r\n\tend)\r\nend\r\n\r\n\r\nfunction EffectAddForce(eff,angle,speed,distance,t)\r\n\tlocal currentdistance=0\r\n\tTimerStart(CreateTimer(), TIMER_PERIOD, true, function()\r\n\t\tcurrentdistance=currentdistance+speed\r\n\t\tlocal x,y=BlzGetLocalSpecialEffectX(eff),BlzGetLocalSpecialEffectY(eff)\r\n\t\tlocal newX,newY=MoveX(x,speed,angle),MoveY(y,speed,angle)\r\n\t\tBlzSetSpecialEffectPosition(eff,newX,newY,0)\r\n\t\t--print(\"forceeff\"..currentdistance)\r\n\t\tif currentdistance>=distance   then\r\n\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\tDestroyTimer(t)\r\n\t\t\tDestroyEffect(eff)\r\n\t\tend\r\n\tend)\r\nend\r\n\r\n\r\n\r\n\r\nfunction InitZombies()--ужасно, больше так не буду делать, мозголомание бредовое\r\n\tlocal e=nil\r\n\tlocal k=0\r\n\tlocal id=FourCC('n003')\r\n\tif OrcSkeletonPool[4]<=OrcSkeletonPool[5]*3 then\r\n\t\tGroupEnumUnitsInRect(perebor,bj_mapInitialPlayableArea,nil)\r\n\t\twhile true do\r\n\t\t\te = FirstOfGroup(perebor)\r\n\t\t\tif e == nil then break end\r\n\t\t\tif UnitAlive(e) and GetUnitTypeId(e)==id then\r\n\t\t\t\tlocal r=GetRandomInt(1,3)\r\n\t\t\t\tk=k+1\r\n\t\t\t\tif OrcSkeletonPool[5+k]==nil then\r\n\t\t\t\t\tOrcSkeletonPool[5+k]=e\r\n\t\t\t\tend\r\n\r\n\t\t\t\tif OrcSkeletonPool[4]<OrcSkeletonPool[5]*3 then\r\n\t\t\t\t\tif GetUnitUserData(e)<3 then\r\n\t\t\t\t\t\tlocal orc=CreateUnit(GetOwningPlayer(e), OrcSkeletonPool[r],GetUnitX(e),GetUnitY(e),0)\r\n\t\t\t\t\t\tOrcSkeletonPool[4]=OrcSkeletonPool[4]+1\r\n\t\t\t\t\t\tGroupAddUnit(OrcSkeletonPoolG,orc)\r\n\t\t\t\t\t\tSetUnitUserData(orc,GetHandleId(e))\r\n\t\t\t\t\t\tSetUnitUserData(e,GetUnitUserData(e)+1)\r\n\t\t\t\t\t\t--print(\"создан скелет\"..GetUnitUserData(e))\r\n\t\t\t\t\tend\r\n\t\t\t\telse\r\n\r\n\t\t\t\tend\r\n\r\n\r\n\r\n\t\t\tend\r\n\t\t\tGroupRemoveUnit(perebor,e)\r\n\t\tend\r\n\t\t--print(\"Запущено юнитов: \"..k)\r\n\t\tOrcSkeletonPool[5]=k\r\n\tend\r\nend\r\n\r\nOrcSkeletonPoolG=CreateGroup()\r\nOrcSkeletonPool={\r\n\tFourCC('n000'),\r\n\tFourCC('n001'),\r\n\tFourCC('n002'),\r\n\t0,--число скелетов\r\n\t4,--число обелисков\r\n\tnil,\r\n\tnil,\r\n\tnil,\r\n\tnil,\r\n}\r\n\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 16.02.2020 18:42\r\n---\r\nfunction InitZone2()\r\n\r\n\tEnterArrow1()\r\nend\r\n\r\n\r\n\r\nfunction EnterArrow1()\r\n\tlocal ThisTrigger = CreateTrigger()\r\n\tlocal button=gg_dest_DTfx_1224\r\n\tTriggerRegisterEnterRectSimple(ThisTrigger, gg_rct_ActivateArrow1)\r\n\tTriggerAddAction(ThisTrigger, function()\r\n\t\t--print(\"смерть\")\r\n\t\t--CreateArrow()\r\n\t\tKillDestructable(button)\r\n\t\tTimerStart(CreateTimer(),2,true, function ()\r\n\t\t\tDestructableRestoreLife(button, GetDestructableMaxLife(button), true)\r\n\t\t\tif PointContentUnit(GetDestructableX(button),GetDestructableY(button),200) then\r\n\t\t\t\t--print(\"Юнит втутри \")\r\n\t\t\t\tKillDestructable(button)\r\n\t\t\t\t--CreateArrow()\r\n\t\t\telse\r\n\t\t\t\tDestroyTimer(GetExpiredTimer())\r\n\t\t\t\t--print(\"Разрушение таймера \")\r\n\t\t\tend\r\n\t\tend)\r\n\tend)\r\nend\r\n\r\nfunction CreateArrow()\r\n\tprint(\"Выпускаем стрелу\")\r\nend\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 07.03.2020 0:35\r\n---\r\n\r\nfunction TorrentReplacer()\r\n\tlocal e=nil\r\n\tlocal k=0\r\n\tlocal id=FourCC('e00C')--!!!!!--Глифы торрентовdddc\r\n\t\tGroupEnumUnitsInRect(perebor,bj_mapInitialPlayableArea,nil)\r\n\t\twhile true do\r\n\t\t\te = FirstOfGroup(perebor)\r\n\t\t\tif e == nil then break end\r\n\t\t\tif UnitAlive(e) and GetUnitTypeId(e)==id then\r\n\t\t\t\tlocal x,y=GetUnitXY(e)\r\n\t\t\t\tKillUnit(e)\r\n\t\t\t\tk=k+1\r\n\t\t\t\tCreateWhirlpool(x,y)\r\n\t\t\tend\r\n\t\t\tGroupRemoveUnit(perebor,e)\r\n\t\tend\r\n\t\t--print(\"Заменено существ: \"..k)\r\nend\r\n\r\nfunction CreateWhirlpool(x,y)\r\n\tlocal eff =AddSpecialEffect(\"Whirlpool\",x,y)\r\n\tBlzSetSpecialEffectZ(eff,-190)\r\n\tBlzPlaySpecialEffect(eff,ANIM_TYPE_BIRTH)\r\n\tTimerStart(CreateTimer(), 5, true, function()\r\n\t\tCreateTorrent(x,y,4,500)\r\n\tend)\r\nend\r\n\r\n---\r\n--- Generated by EmmyLua(https://github.com/EmmyLua)\r\n--- Created by Bergi.\r\n--- DateTime: 16.02.2020 18:42\r\n---\r\nfunction InitZone3()\r\n\r\n\tTorrentReplacer()\r\nend\r\n\r\n\r\n--CUSTOM_CODE\r\nfunction Trig_ResArrowBotton_Actions()\r\n        CreateArrow()\r\n    TriggerSleepAction(2)\r\n    DestructableRestoreLife(GetDyingDestructable(), GetDestructableMaxLife(GetLastCreatedDestructable()), true)\r\nend\r\n\r\nfunction InitTrig_ResArrowBotton()\r\n    gg_trg_ResArrowBotton = CreateTrigger()\r\n    TriggerRegisterDeathEvent(gg_trg_ResArrowBotton, gg_dest_DTfx_1224)\r\n    TriggerAddAction(gg_trg_ResArrowBotton, Trig_ResArrowBotton_Actions)\r\nend\r\n\r\nfunction Trig_Button3IsDead_Func001A()\r\n    KillDestructable(GetEnumDestructable())\r\nend\r\n\r\nfunction Trig_Button3IsDead_Actions()\r\n    EnumDestructablesInRectAll(gg_rct_Zone04In, Trig_Button3IsDead_Func001A)\r\nend\r\n\r\nfunction InitTrig_Button3IsDead()\r\n    gg_trg_Button3IsDead = CreateTrigger()\r\n    TriggerRegisterDeathEvent(gg_trg_Button3IsDead, gg_dest_B000_0963)\r\n    TriggerAddAction(gg_trg_Button3IsDead, Trig_Button3IsDead_Actions)\r\nend\r\n\r\nfunction Trig_InitZone0_Func001A()\r\n    KillDestructable(GetEnumDestructable())\r\nend\r\n\r\nfunction Trig_InitZone0_Actions()\r\n    EnumDestructablesInRectAll(gg_rct_Zone02In, Trig_InitZone0_Func001A)\r\nend\r\n\r\nfunction InitTrig_InitZone0()\r\n    gg_trg_InitZone0 = CreateTrigger()\r\n    TriggerAddAction(gg_trg_InitZone0, Trig_InitZone0_Actions)\r\nend\r\n\r\nfunction Trig_Button0IsDead_Func001A()\r\n    KillDestructable(GetEnumDestructable())\r\nend\r\n\r\nfunction Trig_Button0IsDead_Actions()\r\n    EnumDestructablesInRectAll(gg_rct_Zone0, Trig_Button0IsDead_Func001A)\r\nend\r\n\r\nfunction InitTrig_Button0IsDead()\r\n    gg_trg_Button0IsDead = CreateTrigger()\r\n    TriggerRegisterDeathEvent(gg_trg_Button0IsDead, gg_dest_B000_0118)\r\n    TriggerAddAction(gg_trg_Button0IsDead, Trig_Button0IsDead_Actions)\r\nend\r\n\r\nfunction Trig_Button12IsDead_Func001C()\r\n    if (not (IsDestructableAliveBJ(gg_dest_B000_0273) == false)) then\r\n        return false\r\n    end\r\n    if (not (IsDestructableAliveBJ(gg_dest_B000_0275) == false)) then\r\n        return false\r\n    end\r\n    return true\r\nend\r\n\r\nfunction Trig_Button12IsDead_Conditions()\r\n    if (not Trig_Button12IsDead_Func001C()) then\r\n        return false\r\n    end\r\n    return true\r\nend\r\n\r\nfunction Trig_Button12IsDead_Func002A()\r\n    KillDestructable(GetEnumDestructable())\r\nend\r\n\r\nfunction Trig_Button12IsDead_Actions()\r\n    EnumDestructablesInRectAll(gg_rct_ZoneLaserGate0, Trig_Button12IsDead_Func002A)\r\nend\r\n\r\nfunction InitTrig_Button12IsDead()\r\n    gg_trg_Button12IsDead = CreateTrigger()\r\n    TriggerRegisterDeathEvent(gg_trg_Button12IsDead, gg_dest_B000_0273)\r\n    TriggerRegisterDeathEvent(gg_trg_Button12IsDead, gg_dest_B000_0275)\r\n    TriggerAddCondition(gg_trg_Button12IsDead, Condition(Trig_Button12IsDead_Conditions))\r\n    TriggerAddAction(gg_trg_Button12IsDead, Trig_Button12IsDead_Actions)\r\nend\r\n\r\nfunction Trig_ResLeft_Func002C()\r\n    if (not (IsDestructableAliveBJ(gg_dest_B006_0274) == true)) then\r\n        return false\r\n    end\r\n    return true\r\nend\r\n\r\nfunction Trig_ResLeft_Actions()\r\n    TriggerSleepAction(2)\r\n    if (Trig_ResLeft_Func002C()) then\r\n        DestructableRestoreLife(GetDyingDestructable(), GetDestructableMaxLife(GetLastCreatedDestructable()), true)\r\n    else\r\n    end\r\nend\r\n\r\nfunction InitTrig_ResLeft()\r\n    gg_trg_ResLeft = CreateTrigger()\r\n    TriggerRegisterDeathEvent(gg_trg_ResLeft, gg_dest_B000_0273)\r\n    TriggerAddAction(gg_trg_ResLeft, Trig_ResLeft_Actions)\r\nend\r\n\r\nfunction Trig_ResRight_Func002C()\r\n    if (not (IsDestructableAliveBJ(gg_dest_B006_0274) == true)) then\r\n        return false\r\n    end\r\n    return true\r\nend\r\n\r\nfunction Trig_ResRight_Actions()\r\n    TriggerSleepAction(2)\r\n    if (Trig_ResRight_Func002C()) then\r\n        DestructableRestoreLife(GetDyingDestructable(), GetDestructableMaxLife(GetLastCreatedDestructable()), true)\r\n    else\r\n    end\r\nend\r\n\r\nfunction InitTrig_ResRight()\r\n    gg_trg_ResRight = CreateTrigger()\r\n    TriggerRegisterDeathEvent(gg_trg_ResRight, gg_dest_B000_0275)\r\n    TriggerAddAction(gg_trg_ResRight, Trig_ResRight_Actions)\r\nend\r\n\r\nfunction Trig_InCombatZone_Func001A()\r\n    DestructableRestoreLife(GetEnumDestructable(), GetDestructableMaxLife(GetEnumDestructable()), true)\r\nend\r\n\r\nfunction Trig_InCombatZone_Actions()\r\n    EnumDestructablesInRectAll(gg_rct_Zone02In, Trig_InCombatZone_Func001A)\r\n    DisableTrigger(GetTriggeringTrigger())\r\nend\r\n\r\nfunction InitTrig_InCombatZone()\r\n    gg_trg_InCombatZone = CreateTrigger()\r\n    TriggerRegisterEnterRectSimple(gg_trg_InCombatZone, gg_rct_Combat0Zone)\r\n    TriggerAddAction(gg_trg_InCombatZone, Trig_InCombatZone_Actions)\r\nend\r\n\r\nfunction Trig_Button0to1_Func001A()\r\n    KillDestructable(GetEnumDestructable())\r\nend\r\n\r\nfunction Trig_Button0to1_Actions()\r\n    EnumDestructablesInRectAll(gg_rct_Region_010, Trig_Button0to1_Func001A)\r\nend\r\n\r\nfunction InitTrig_Button0to1()\r\n    gg_trg_Button0to1 = CreateTrigger()\r\n    TriggerRegisterDeathEvent(gg_trg_Button0to1, gg_dest_B000_0131)\r\n    TriggerAddAction(gg_trg_Button0to1, Trig_Button0to1_Actions)\r\nend\r\n\r\nfunction Trig_Visiblepoint_Actions()\r\n    DisableTrigger(GetTriggeringTrigger())\r\n    CreateFogModifierRectBJ(true, GetOwningPlayer(GetTriggerUnit()), FOG_OF_WAR_VISIBLE, gg_rct_VisiblePoint0)\r\nend\r\n\r\nfunction InitTrig_Visiblepoint()\r\n    gg_trg_Visiblepoint = CreateTrigger()\r\n    TriggerRegisterEnterRectSimple(gg_trg_Visiblepoint, gg_rct_Zone03Out)\r\n    TriggerAddAction(gg_trg_Visiblepoint, Trig_Visiblepoint_Actions)\r\nend\r\n\r\nfunction Trig_InitZone1BossOpenGate_Func001A()\r\n    KillDestructable(GetEnumDestructable())\r\nend\r\n\r\nfunction Trig_InitZone1BossOpenGate_Actions()\r\n    EnumDestructablesInRectAll(gg_rct_Boss1Gate, Trig_InitZone1BossOpenGate_Func001A)\r\nend\r\n\r\nfunction InitTrig_InitZone1BossOpenGate()\r\n    gg_trg_InitZone1BossOpenGate = CreateTrigger()\r\n    TriggerAddAction(gg_trg_InitZone1BossOpenGate, Trig_InitZone1BossOpenGate_Actions)\r\nend\r\n\r\nfunction Trig_Button10IsDead_Func001A()\r\n    KillDestructable(GetEnumDestructable())\r\nend\r\n\r\nfunction Trig_Button10IsDead_Actions()\r\n    EnumDestructablesInRectAll(gg_rct_Sercret1, Trig_Button10IsDead_Func001A)\r\nend\r\n\r\nfunction InitTrig_Button10IsDead()\r\n    gg_trg_Button10IsDead = CreateTrigger()\r\n    TriggerRegisterDeathEvent(gg_trg_Button10IsDead, gg_dest_B000_0906)\r\n    TriggerAddAction(gg_trg_Button10IsDead, Trig_Button10IsDead_Actions)\r\nend\r\n\r\nfunction Trig_EVENTMMB_Conditions()\r\n    if (not (BlzGetTriggerPlayerMouseButton() == MOUSE_BUTTON_TYPE_MIDDLE)) then\r\n        return false\r\n    end\r\n    return true\r\nend\r\n\r\nfunction Trig_EVENTMMB_Actions()\r\n    DisplayTextToForce(GetPlayersAll(), \"TRIGSTR_011\")\r\nend\r\n\r\nfunction InitTrig_EVENTMMB()\r\n    gg_trg_EVENTMMB = CreateTrigger()\r\n    TriggerRegisterPlayerMouseEventBJ(gg_trg_EVENTMMB, Player(0), bj_MOUSEEVENTTYPE_DOWN)\r\n    TriggerAddCondition(gg_trg_EVENTMMB, Condition(Trig_EVENTMMB_Conditions))\r\n    TriggerAddAction(gg_trg_EVENTMMB, Trig_EVENTMMB_Actions)\r\nend\r\n\r\nfunction Trig_NonAttack_Func004C()\r\n    if (not (GetIssuedOrderIdBJ() == String2OrderIdBJ(\"move\"))) then\r\n        return false\r\n    end\r\n    if (not (IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) == true)) then\r\n        return false\r\n    end\r\n    return true\r\nend\r\n\r\nfunction Trig_NonAttack_Conditions()\r\n    if (not Trig_NonAttack_Func004C()) then\r\n        return false\r\n    end\r\n    return true\r\nend\r\n\r\nfunction Trig_NonAttack_Actions()\r\n    PauseUnitBJ(true, GetTriggerUnit())\r\n    IssueImmediateOrderBJ(GetTriggerUnit(), \"stop\")\r\n    PauseUnitBJ(false, GetTriggerUnit())\r\nend\r\n\r\nfunction InitTrig_NonAttack()\r\n    gg_trg_NonAttack = CreateTrigger()\r\n    TriggerRegisterAnyUnitEventBJ(gg_trg_NonAttack, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)\r\n    TriggerRegisterAnyUnitEventBJ(gg_trg_NonAttack, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)\r\n    TriggerAddCondition(gg_trg_NonAttack, Condition(Trig_NonAttack_Conditions))\r\n    TriggerAddAction(gg_trg_NonAttack, Trig_NonAttack_Actions)\r\nend\r\n\r\nfunction Trig_sec1_Actions()\r\n    PlaySoundAtPointBJ(gg_snd_AAA, 100, GetUnitLoc(gg_unit_h002_0023), 0)\r\nend\r\n\r\nfunction InitTrig_sec1()\r\n    gg_trg_sec1 = CreateTrigger()\r\n    TriggerAddAction(gg_trg_sec1, Trig_sec1_Actions)\r\nend\r\n\r\nfunction InitCustomTriggers()\r\n    InitTrig_ResArrowBotton()\r\n    InitTrig_Button3IsDead()\r\n    InitTrig_InitZone0()\r\n    InitTrig_Button0IsDead()\r\n    InitTrig_Button12IsDead()\r\n    InitTrig_ResLeft()\r\n    InitTrig_ResRight()\r\n    InitTrig_InCombatZone()\r\n    InitTrig_Button0to1()\r\n    InitTrig_Visiblepoint()\r\n    InitTrig_InitZone1BossOpenGate()\r\n    InitTrig_Button10IsDead()\r\n    InitTrig_EVENTMMB()\r\n    InitTrig_NonAttack()\r\n    InitTrig_sec1()\r\nend\r\n\r\nfunction RunInitializationTriggers()\r\n    ConditionalTriggerExecute(gg_trg_InitZone0)\r\n    ConditionalTriggerExecute(gg_trg_InitZone1BossOpenGate)\r\nend\r\n\r\nfunction InitCustomPlayerSlots()\r\n    SetPlayerStartLocation(Player(0), 0)\r\n    ForcePlayerStartLocation(Player(0), 0)\r\n    SetPlayerColor(Player(0), ConvertPlayerColor(0))\r\n    SetPlayerRacePreference(Player(0), RACE_PREF_ORC)\r\n    SetPlayerRaceSelectable(Player(0), false)\r\n    SetPlayerController(Player(0), MAP_CONTROL_USER)\r\nend\r\n\r\nfunction InitCustomTeams()\r\n    SetPlayerTeam(Player(0), 0)\r\nend\r\n\r\nfunction main()\r\n    SetCameraBounds(-11520.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), -11776.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM), 11520.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), 11264.0 - GetCameraMargin(CAMERA_MARGIN_TOP), -11520.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), 11264.0 - GetCameraMargin(CAMERA_MARGIN_TOP), 11520.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), -11776.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM))\r\n    SetDayNightModels(\"Environment\\\\DNC\\\\DNCLordaeron\\\\DNCLordaeronTerrain\\\\DNCLordaeronTerrain.mdl\", \"Environment\\\\DNC\\\\DNCLordaeron\\\\DNCLordaeronUnit\\\\DNCLordaeronUnit.mdl\")\r\n    NewSoundEnvironment(\"Default\")\r\n    SetAmbientDaySound(\"SunkenRuinsDay\")\r\n    SetAmbientNightSound(\"SunkenRuinsNight\")\r\n    SetMapMusic(\"Music\", true, 0)\r\n    InitSounds()\r\n    CreateRegions()\r\n    CreateCameras()\r\n    CreateAllDestructables()\r\n    CreateAllUnits()\r\n    InitBlizzard()\r\n    InitGlobals()\r\n    InitCustomTriggers()\r\n    RunInitializationTriggers()\r\nend\r\n\r\nfunction config()\r\n    SetMapName(\"TRIGSTR_001\")\r\n    SetMapDescription(\"TRIGSTR_003\")\r\n    SetPlayers(1)\r\n    SetTeams(1)\r\n    SetGamePlacement(MAP_PLACEMENT_USE_MAP_SETTINGS)\r\n    DefineStartLocation(0, -2752.0, -3072.0)\r\n    InitCustomPlayerSlots()\r\n    InitCustomTeams()\r\nend\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- map.w3x/war3map.lua	(revision b71969cd35453eae92c2328cd13481063eda9654)
+++ map.w3x/war3map.lua	(date 1602953129098)
@@ -1841,7 +1841,7 @@
 			IsAttackReadyR={true,true,true,true,true,true,true,true,true}, --9
 			IsAttackReadyL={true,true,true,true,true,true,true,true,true},
 			AttackCD=0.5,
-			AttackCDWeapon={0.5,
+			AttackCDWeapon={0.2,
 			          1,
 			          2,
 			          3,
@@ -3204,7 +3204,7 @@
 	--print(BlzFrameGetChildrenCount(SelfFrame))
 
 	if true then -- События кликов по кнопке
-		print("создана ативная кнопка")
+		--print("создана ативная кнопка")
 		local  ClickTrig = CreateTrigger()
 		BlzFrameSetEnable(BlzGetTriggerFrame(), false)
 		BlzFrameSetEnable(BlzGetTriggerFrame(), true)
