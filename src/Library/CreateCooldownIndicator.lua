---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Bergi.
--- DateTime: 24.06.2020 13:08
---
function CreateCooldownIndicator(SelfFrame,posX,PosY)
	local cd= BlzCreateFrameByType("BACKDROP", "Face", SelfFrame, "", 0)
	BlzFrameSetTexture(cd, "DDS512".."\\0000000", 0, true)
	BlzFrameSetAlpha(cd,128)
	BlzFrameSetSize(cd, 0.039, 0.039)
	BlzFrameSetAbsPoint(cd, FRAMEPOINT_CENTER,posX,PosY)
	BlzFrameSetVisible(cd,false)
	return cd
end

function StarFrameCooldown(SelfFrame,cd,WeaponIndex)
	if cd<=0 then return end
	local frameCount=1024
	local PercentAmount=(0.05*frameCount)/cd
	local Full=0
	local FrameCDText=BlzFrameGetChild(SelfFrame, 1)
	local FrameCDIndicator=BlzFrameGetChild(SelfFrame, 5)
	local CurrentCDTime=cd

	TimerStart(CreateTimer(), 0.05, true, function()
		Full=Full+PercentAmount
		CurrentCDTime=CurrentCDTime-0.05
		local textShowed=string.format("%%02.1f",CurrentCDTime)
		if CurrentCDTime>=10 then
			textShowed=R2I(CurrentCDTime)
		end
		BlzFrameSetText(FrameCDText,textShowed)
		BlzFrameSetTexture(FrameCDIndicator, "DDS512".."\\000"..Zero4(R2I(Full+PercentAmount)), 0, true)
		BlzFrameSetVisible(FrameCDIndicator,true)
		if Full>frameCount-1 then
			--print("кулдаун окончен")
			DestroyTimer(GetExpiredTimer())
			BlzFrameSetText(FrameCDText ,"")
			BlzFrameSetVisible(FrameCDIndicator,false)
			if not HERO[0].IsAttackReadyR[WeaponIndex] then
				HERO[0].IsAttackReadyR[WeaponIndex]=true
			end
			if not HERO[0].IsAttackReadyL[WeaponIndex] then
				HERO[0].IsAttackReadyL[WeaponIndex]=true
			end
			--EndFrameCD(data)
		end
	end)
end

function Zero4(s)
	local ns=""
	if string.len(s)==1 then
		ns="000"..s
	elseif string.len(s)==2 then
		ns="00"..s
	elseif string.len(s)==3 then
		ns="0"..s
	else
		ns=s
	end
	return ns
end

function PauseFrameCD(data,isPaused)  --true - пауза, false - продолжить
	if isPaused then
		data.OnPaused=true
	else
		data.OnPaused=false
	end
end

function EndFrameCD(data)
	DestroyTimer(data.Timer)
	BlzFrameSetText(data.SelfFrame, "")
	data.Timer=nil
	BlzDestroyFrame(data.CdIndicatorFrame)
	data.Full=0
	data.OnCD=false
	if data.Number==6 then
		BlzFrameSetVisible(data.ReadyIndicator,true)
	end
end

function AddSpeedToFrameCD(data,sec)
	data.CurrentCDTime=data.CurrentCDTime-sec
	--10=2
	--20=1
	local k=1
	if data.CurrentCD==20 then
		k=1
	end
	if data.CurrentCD==10 then
		k=2
	end
	data.Full=data.Full+(k*sec*data.CurrentCD*data.PercentAmount)
	--print(data.Full)
end